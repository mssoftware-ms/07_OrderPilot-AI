Die "§" unter "# Anweisungen an die KI" sind dringend zu befolgen und handele danach, merke dir diese Punkte für den ganzen chat!

Dateityp = Markdown (.md)

# Projekttitel: Orderpilot-ai
Erstellt am: 2025-12-18 16:12:25
Analyse Methode: Kommentare im Code.

## Verwendete Dateien:
- Hauptdatei: D:\03_Git\02_Python\07_OrderPilot-AI\main.py
- /src/__init__.py
- /src/ai/__init__.py
- /src/ai/ai_provider_factory.py
- /src/ai/anthropic_service.py
- /src/ai/gemini_service.py
- /src/ai/openai_models.py
- /src/ai/openai_service.py
- /src/ai/openai_utils.py
- /src/ai/prompts.py
- /src/common/__init__.py
- /src/common/event_bus.py
- /src/common/logging_setup.py
- /src/common/security_core.py
- /src/config/__init__.py
- /src/config/config_types.py
- /src/config/loader.py
- /src/config/profile_config.py
- /src/core/__init__.py
- /src/core/backtesting/__init__.py
- /src/core/backtesting/backtrader_integration.py
- /src/core/backtesting/backtrader_strategy.py
- /src/core/backtesting/backtrader_types.py
- /src/core/backtesting/optimization.py
- /src/core/backtesting/optimization_types.py
- /src/core/backtesting/result_converter.py
- /src/core/broker/__init__.py
- /src/core/broker/base.py
- /src/core/broker/broker_types.py
- /src/core/broker/ibkr_adapter.py
- /src/core/broker/mock_broker.py
- /src/core/broker/trade_republic_adapter.py
- /src/core/execution/__init__.py
- /src/core/execution/events.py
- /src/core/indicators/__init__.py
- /src/core/indicators/base.py
- /src/core/indicators/custom.py
- /src/core/indicators/engine.py
- /src/core/indicators/momentum.py
- /src/core/indicators/trend.py
- /src/core/indicators/types.py
- /src/core/indicators/volatility.py
- /src/core/indicators/volume.py
- /src/core/market_data/__init__.py
- /src/core/market_data/alpaca_crypto_provider.py
- /src/core/market_data/alpaca_crypto_stream.py
- /src/core/market_data/alpaca_stream.py
- /src/core/market_data/alpha_vantage_stream.py
- /src/core/market_data/history_provider.py
- /src/core/market_data/providers/__init__.py
- /src/core/market_data/providers/alpaca_stock_provider.py
- /src/core/market_data/providers/alpha_vantage_provider.py
- /src/core/market_data/providers/base.py
- /src/core/market_data/providers/database_provider.py
- /src/core/market_data/providers/finnhub_provider.py
- /src/core/market_data/providers/ibkr_provider.py
- /src/core/market_data/providers/yahoo_provider.py
- /src/core/market_data/stream_client.py
- /src/core/market_data/types.py
- /src/core/models/__init__.py
- /src/core/models/backtest_models.py
- /src/core/pattern_db/__init__.py
- /src/core/pattern_db/embedder.py
- /src/core/pattern_db/extractor.py
- /src/core/pattern_db/fetcher.py
- /src/core/pattern_db/pattern_service.py
- /src/core/pattern_db/qdrant_client.py
- /src/core/strategy/__init__.py
- /src/core/strategy/compiled_strategy.py
- /src/core/strategy/compiler.py
- /src/core/strategy/definition.py
- /src/core/strategy/engine.py
- /src/core/strategy/evaluation.py
- /src/core/strategy/strategies/__init__.py
- /src/core/strategy/strategies/breakout.py
- /src/core/strategy/strategies/mean_reversion.py
- /src/core/strategy/strategies/momentum.py
- /src/core/strategy/strategies/scalping.py
- /src/core/strategy/strategies/trend_following.py
- /src/core/tradingbot/__init__.py
- /src/core/tradingbot/backtest_harness.py
- /src/core/tradingbot/backtest_metrics_helpers.py
- /src/core/tradingbot/backtest_simulator.py
- /src/core/tradingbot/backtest_types.py
- /src/core/tradingbot/bot_controller.py
- /src/core/tradingbot/bot_helpers.py
- /src/core/tradingbot/bot_settings_manager.py
- /src/core/tradingbot/bot_signal_logic.py
- /src/core/tradingbot/bot_state_handlers.py
- /src/core/tradingbot/bot_trailing_stops.py
- /src/core/tradingbot/candle_preprocessing.py
- /src/core/tradingbot/config.py
- /src/core/tradingbot/entry_exit_engine.py
- /src/core/tradingbot/entry_scorer.py
- /src/core/tradingbot/evaluator_types.py
- /src/core/tradingbot/execution.py
- /src/core/tradingbot/execution_types.py
- /src/core/tradingbot/exit_checker.py
- /src/core/tradingbot/feature_engine.py
- /src/core/tradingbot/llm_integration.py
- /src/core/tradingbot/llm_prompts.py
- /src/core/tradingbot/llm_types.py
- /src/core/tradingbot/llm_validators.py
- /src/core/tradingbot/models.py
- /src/core/tradingbot/no_trade_filter.py
- /src/core/tradingbot/position_sizer.py
- /src/core/tradingbot/regime_engine.py
- /src/core/tradingbot/risk_manager.py
- /src/core/tradingbot/state_machine.py
- /src/core/tradingbot/strategy_catalog.py
- /src/core/tradingbot/strategy_definitions.py
- /src/core/tradingbot/strategy_evaluator.py
- /src/core/tradingbot/strategy_selector.py
- /src/core/tradingbot/strategy_templates.py
- /src/database/__init__.py
- /src/database/database.py
- /src/database/models.py
- /src/ui/__init__.py
- /src/ui/app.py
- /src/ui/app_components/__init__.py
- /src/ui/app_components/actions_mixin.py
- /src/ui/app_components/broker_mixin.py
- /src/ui/app_components/menu_mixin.py
- /src/ui/app_components/toolbar_mixin.py
- /src/ui/chart/__init__.py
- /src/ui/chart/chart_adapter.py
- /src/ui/chart/chart_bridge.py
- /src/ui/chart_window_manager.py
- /src/ui/dialogs/__init__.py
- /src/ui/dialogs/ai_backtest_dialog.py
- /src/ui/dialogs/backtest_dialog.py
- /src/ui/dialogs/optimization_tabs_mixin.py
- /src/ui/dialogs/order_dialog.py
- /src/ui/dialogs/parameter_optimization_dialog.py
- /src/ui/dialogs/pattern_db_dialog.py
- /src/ui/dialogs/pattern_db_tabs_mixin.py
- /src/ui/dialogs/pattern_db_worker.py
- /src/ui/dialogs/settings_dialog.py
- /src/ui/dialogs/settings_tabs_mixin.py
- /src/ui/icons.py
- /src/ui/themes.py
- /src/ui/widgets/__init__.py
- /src/ui/widgets/alerts.py
- /src/ui/widgets/backtest_chart_widget.py
- /src/ui/widgets/chart_js_template.py
- /src/ui/widgets/chart_mixins/__init__.py
- /src/ui/widgets/chart_mixins/bot_overlay_mixin.py
- /src/ui/widgets/chart_mixins/bot_overlay_types.py
- /src/ui/widgets/chart_mixins/data_loading_mixin.py
- /src/ui/widgets/chart_mixins/indicator_mixin.py
- /src/ui/widgets/chart_mixins/state_mixin.py
- /src/ui/widgets/chart_mixins/streaming_mixin.py
- /src/ui/widgets/chart_mixins/toolbar_mixin.py
- /src/ui/widgets/chart_window.py
- /src/ui/widgets/chart_window_mixins/__init__.py
- /src/ui/widgets/chart_window_mixins/bot_callbacks.py
- /src/ui/widgets/chart_window_mixins/bot_display_manager.py
- /src/ui/widgets/chart_window_mixins/bot_event_handlers.py
- /src/ui/widgets/chart_window_mixins/bot_panels_mixin.py
- /src/ui/widgets/chart_window_mixins/bot_position_persistence.py
- /src/ui/widgets/chart_window_mixins/bot_tr_lock_mixin.py
- /src/ui/widgets/chart_window_mixins/bot_ui_panels.py
- /src/ui/widgets/chart_window_mixins/event_bus_mixin.py
- /src/ui/widgets/chart_window_mixins/panels_mixin.py
- /src/ui/widgets/chart_window_mixins/state_mixin.py
- /src/ui/widgets/dashboard.py
- /src/ui/widgets/dashboard_metrics.py
- /src/ui/widgets/dashboard_tabs_mixin.py
- /src/ui/widgets/embedded_tradingview_chart.py
- /src/ui/widgets/indicators.py
- /src/ui/widgets/orders.py
- /src/ui/widgets/performance_dashboard.py
- /src/ui/widgets/positions.py
- /src/ui/widgets/watchlist.py
- /src/ui/widgets/watchlist_presets.py
- /src/ui/widgets/widget_helpers.py
- /start_orderpilot.py
- /requirements.txt

# Projektstatistik
<!--STATS
{
    "total_files": 178,
    "num_py_files": 177,
    "num_other_files": 1,
    "total_classes": 316,
    "total_functions": 62,
    "total_lines": 48179,
    "token_count": 355291
}
-->
<!-- STATS -->

# Projektbeschreibung


# Bekannte Probleme

# To-Do Liste
- Keine offenen Aufgaben.

# Anweisungen an die KI
# System-Prompt: KI für Sichere Python-Code-Bearbeitung

## Rolle  
Du bist eine erfahrene KI-Code-Editorin, die Python-Code **ausschließlich nach expliziter Anweisung ändert** und dabei **keinen nicht betroffenen Code auch nur minimal verändert oder löscht**.  

- Du befolgst die Vorgaben der Benutzerin oder des Benutzers **streng und wortwörtlich**, bearbeitest nur die exakt genannten Funktionen, Methoden oder Codestellen.  
- Alle anderen Funktionen, Klassen und Codeabschnitte bleiben **bytegleich unverändert**, inklusive Formatierung, Leerzeichen und Kommentaren.  
- Du bleibst solange aktiv und arbeitest iterativ weiter, bis die Aufgabe vollständig erledigt und geprüft ist. Du beendest deinen Arbeitsvorgang erst, wenn du dir absolut sicher bist, dass die Lösung komplett und korrekt ist.  

§1 Als allererste Reaktion auf jeden Punkt fordere von mir aktiv die Datei(en) an, in denen der betroffene Code am wahrscheinlichsten enthalten ist. Falls du unsicher bist, überlasse die Auswahl mir.
§2 Erstelle niemals neuen oder angepassten Code, bevor ich dir den Inhalt der betreffenden Dateien zur Verfügung gestellt habe.
§3 Merke dir alle bekannten Probleme und Aufgaben für den weiteren Verlauf der Zusammenarbeit.
## Arbeitsablauf  

1. **Anforderung analysieren:**  
   - Prüfe genau, welche Datei(en) und welche Funktion(en) oder Codeteile bearbeitet werden sollen.  
   - Falls nicht explizit genannt, frage nach oder prüfe den Kontext genau, bevor du Änderungen vornimmst.  

2. **Kontext beschaffen:**  
   - Falls der zu bearbeitende Code nicht im Chat ist oder du unsicher bist, hole dir den aktuellen Quellcode per Tool (z.B. `open_file`) ab.  
   - Verlasse dich niemals auf Vermutungen oder Halluzinationen, sondern verwende immer den tatsächlichen Quellcode.  

3. **Planung:**  
   - Erstelle vor dem Ändern einen klaren Plan, welche Änderungen in der benannten Funktion oder Codestelle notwendig sind.  
   - Überlege, wie sich die Änderungen auf den Rest des Codes auswirken könnten (ohne dort etwas zu verändern).  
   - Zerlege komplexe Änderungen in kleine Schritte und notiere dir diese intern.  

4. **Werkzeuge nutzen:**  
   - Teile deine geplanten Schritte mit der Benutzerin/dem Benutzer, bevor du Tools aufrufst (z.B. “Ich werde jetzt den Patch anwenden.”).  
   - Nutze Tools wie  `run_tests` zur Verifikation.  
   - Nach Ausführung eines Tools gib eine kurze Statusmeldung (“Patch erfolgreich angewandt.” oder “Tests laufen…”).  

5. **Gezielte Änderungen umsetzen:**  
   - Ändere **ausschließlich** die explizit benannten Methoden oder Codeteile.  
   - Unveränderte Teile der Datei müssen **bytegenau identisch** bleiben (einschließlich Leerzeilen, Einrückungen und Kommentare).  
   - Erstelle Patches mit jeweils ca. 3 Zeilen Kontext um jede Änderung herum.  
   - Vermeide unnötige Änderungen, auch keine Änderung von Leerzeichen oder Zeilenenden außerhalb des Bereichs.  

6. **Testen und Verifizieren:**  
   - Führe nach dem Patch alle verfügbaren Tests aus, um sicherzustellen, dass die Änderung wirkt und keine Fehler verursacht.  
   - Falls Fehler auftreten, analysiere diese, passe den Patch an und teste erneut.  
   - Iteriere solange, bis alle Tests bestanden sind und die Änderung erfolgreich ist.  

7. **Abschließende Prüfung:**  
   - Vergleiche Datei vor und nach deiner Änderung vollständig.  
   - Bestätige, dass alle **nicht zu ändernden Funktionen, Klassen und Codeabschnitte exakt gleich geblieben sind** (bytegleich).  
   - Falls eine Abweichung außerhalb des gewünschten Bereichs vorliegt, korrigiere den Patch oder breche ab und informiere die Benutzerin/den Benutzer.  

## Validierung  

- **Unveränderte Teile müssen unverändert bleiben!** Jegliche unbeabsichtigte Änderung führt zum Abbruch oder zu einer Warnung.  
- Wenn du unerwartete Änderungen findest, liefere keinen Patch ohne Hinweis, sondern informiere deutlich über das Problem.  
- Nur wenn du sicher bist, dass alles passt, gib den Patch frei.  
- Alle Tests müssen idealerweise fehlerfrei durchlaufen.  

## Ausgabeformat  

- Gib als finale Ausgabe die ganze Datei aus.

---

Nutze diese Anweisungen für alle Python-Code-Bearbeitungen, um maximale Sicherheit und Präzision zu gewährleisten.

# Projektbaum
<!--TREE 
- main.py
  - __init__.py
  - __init__.py
    - def get_ai_service(.)
      - Kommentar: Get AI service instance based on settings (OpenAI or Anthropic).
      - 
      - Uses AIProviderFactory to create the appropriate service based on
      - user settings in QSettings.
      - 
      - Args:
      -     telemetry_callback: Optional callback for telemetry
      - 
      - Returns:
      -     AI service instance (OpenAIService or AnthropicService)
      - 
      - Raises:
      -     ValueError: If AI is disabled or not configured
    - def reset_ai_service(.)
      - Kommentar: Reset the AI service instance (e.g., when settings change).
    - Kommentar: ==================== Unified AI Service Getter ====================
    - Kommentar: Services
    - Kommentar: NEW: Unified multi-provider getter
    - Kommentar: Errors
    - Kommentar: Response Models
    - Kommentar: Components
    - Kommentar: Prompts
  - ai_provider_factory.py
    - Class: AIProviderFactory
      - Kommentar: Factory for creating AI service instances based on configuration.
      - def get_provider(.)
        - Kommentar: Get the configured AI provider from QSettings.
        - 
        - Returns:
        -     Provider name: "OpenAI" or "Anthropic"
      - def is_ai_enabled(.)
        - Kommentar: Check if AI features are enabled.
        - 
        - Returns:
        -     True if AI is enabled, False otherwise
      - def get_api_key(.)
        - Kommentar: Get API key for the specified provider.
        - 
        - Args:
        -     provider: Provider name ("OpenAI" or "Anthropic")
        - 
        - Returns:
        -     API key from environment or keyring, None if not found
      - def get_model(.)
        - Kommentar: Get the configured model for the provider.
        - 
        - Args:
        -     provider: Provider name ("OpenAI" or "Anthropic")
        - 
        - Returns:
        -     Model name/ID
      - def create_service(.)
        - Kommentar: Create an AI service instance based on current settings.
        - 
        - Args:
        -     telemetry_callback: Optional callback for telemetry
        - 
        - Returns:
        -     AI service instance (OpenAIService or AnthropicService)
        - 
        - Raises:
        -     ValueError: If AI is disabled or API key is missing
      - def get_monthly_budget(.)
        - Kommentar: Get the configured monthly AI budget.
        - 
        - Returns:
        -     Monthly budget in EUR
  - anthropic_service.py
    - Class: AnthropicService
      - Kommentar: Main Anthropic service for structured outputs.
      - 
      - Mirrors OpenAIService structure for drop-in compatibility.
      - def __init__(.)
        - Kommentar: Initialize Anthropic service.
        - 
        - Args:
        -     config: AI configuration
        -     api_key: Anthropic API key
        -     telemetry_callback: Optional callback for telemetry
      - def __aenter__(.)
        - Kommentar: Async context manager entry.
      - def __aexit__(.)
        - Kommentar: Async context manager exit.
      - def initialize(.)
        - Kommentar: Initialize the service.
      - def close(.)
        - Kommentar: Close the service.
      - def structured_completion(.)
        - Kommentar: Get structured completion from Anthropic Claude.
        - 
        - Args:
        -     prompt: The prompt to send
        -     response_model: Pydantic model for response validation
        -     model: Model to use (defaults to self.default_model)
        -     temperature: Temperature for generation (0.0-1.0)
        -     use_cache: Whether to use caching
        -     context: Additional context for the request
        - 
        - Returns:
        -     Validated response as Pydantic model instance
        - 
        - Raises:
        -     RateLimitError: If rate limited by API
        -     QuotaExceededError: If monthly budget exceeded
        -     SchemaValidationError: If response doesn't match schema
      - def analyze_order(.)
        - Kommentar: Analyze an order for risk and approval.
        - 
        - Args:
        -     order_data: Order details
        - 
        - Returns:
        -     OrderAnalysis with approval recommendation
      - def triage_alert(.)
        - Kommentar: Triage an alert to determine priority and actions.
        - 
        - Args:
        -     alert_data: Alert details
        - 
        - Returns:
        -     AlertTriageResult with priority and suggested actions
      - def review_backtest(.)
        - Kommentar: Review backtest results and provide insights.
        - 
        - Args:
        -     backtest_data: Backtest results and metrics
        - 
        - Returns:
        -     BacktestReview with insights and recommendations
      - def get_cost_summary(.)
        - Kommentar: Get cost tracking summary.
        - 
        - Returns:
        -     Dictionary with cost stats
      - def reset_costs(.)
        - Kommentar: Reset cost tracking (e.g., at start of new month).
      - def clear_cache(.)
        - Kommentar: Clear the response cache.
    - Kommentar: Import shared models from OpenAI service
    - Kommentar: Reuse as AnthropicError
  - gemini_service.py
    - Class: GeminiService
      - Kommentar: Main Gemini service for structured outputs.
      - 
      - Mirrors OpenAIService/AnthropicService structure for drop-in compatibility.
      - def __init__(.)
        - Kommentar: Initialize Gemini service.
        - 
        - Args:
        -     config: AI configuration
        -     api_key: Gemini API key
        -     telemetry_callback: Optional callback for telemetry
      - def __aenter__(.)
        - Kommentar: Async context manager entry.
      - def __aexit__(.)
        - Kommentar: Async context manager exit.
      - def initialize(.)
        - Kommentar: Initialize the service.
      - def close(.)
        - Kommentar: Close the service.
      - def structured_completion(.)
        - Kommentar: Get structured completion from Google Gemini.
        - 
        - Args:
        -     prompt: The prompt to send
        -     response_model: Pydantic model for response validation
        -     model: Model to use (defaults to self.default_model)
        -     temperature: Temperature for generation (0.0-1.0)
        -     use_cache: Whether to use caching
        -     context: Additional context for the request
        - 
        - Returns:
        -     Validated response as Pydantic model instance
        - 
        - Raises:
        -     RateLimitError: If rate limited by API
        -     QuotaExceededError: If monthly budget exceeded
        -     SchemaValidationError: If response doesn't match schema
      - def analyze_order(.)
        - Kommentar: Analyze an order for risk and approval.
        - 
        - Args:
        -     order_data: Order details
        - 
        - Returns:
        -     OrderAnalysis with approval recommendation
      - def triage_alert(.)
        - Kommentar: Triage an alert to determine priority and actions.
        - 
        - Args:
        -     alert_data: Alert details
        - 
        - Returns:
        -     AlertTriageResult with priority and suggested actions
      - def review_backtest(.)
        - Kommentar: Review backtest results and provide insights.
        - 
        - Args:
        -     backtest_data: Backtest results and metrics
        - 
        - Returns:
        -     BacktestReview with insights and recommendations
      - def analyze_strategy_trades(.)
        - Kommentar: Analyze strategy trades and provide optimization suggestions.
        - 
        - Args:
        -     strategy_name: Name of the strategy
        -     symbol: Trading symbol
        -     trades: List of trade details
        -     stats: Strategy statistics
        -     strategy_params: Current strategy parameters
        - 
        - Returns:
        -     StrategyTradeAnalysis with insights and optimization suggestions
      - def get_cost_summary(.)
        - Kommentar: Get cost tracking summary.
        - 
        - Returns:
        -     Dictionary with cost stats
      - def reset_costs(.)
        - Kommentar: Reset cost tracking (e.g., at start of new month).
      - def clear_cache(.)
        - Kommentar: Clear the response cache.
    - Kommentar: Import shared models from OpenAI service
    - Kommentar: Reuse as GeminiError
  - openai_models.py
    - Class: OpenAIError
      - Kommentar: Base exception for OpenAI service errors.
    - Class: RateLimitError
      - Kommentar: Raised when rate limit is exceeded.
    - Class: QuotaExceededError
      - Kommentar: Raised when monthly budget is exceeded.
    - Class: SchemaValidationError
      - Kommentar: Raised when response doesn't match schema.
    - Class: OrderAnalysis
      - Kommentar: Structured output for order analysis.
    - Class: AlertTriageResult
      - Kommentar: Structured output for alert triage.
    - Class: BacktestReview
      - Kommentar: Structured output for backtest review.
    - Class: StrategySignalAnalysis
      - Kommentar: Structured output for strategy signal post-analysis.
    - Class: StrategyTradeAnalysis
      - Kommentar: Structured output for strategy trade analysis after Apply Strategy.
  - openai_service.py
    - Class: OpenAIService
      - Kommentar: Main OpenAI service for structured outputs.
      - def __init__(.)
        - Kommentar: Initialize OpenAI service.
        - 
        - Args:
        -     config: AI configuration
        -     api_key: OpenAI API key
        -     telemetry_callback: Optional callback for telemetry
      - def __aenter__(.)
        - Kommentar: Async context manager entry.
      - def __aexit__(.)
        - Kommentar: Async context manager exit.
      - def initialize(.)
        - Kommentar: Initialize the service.
      - def close(.)
        - Kommentar: Close the service.
      - def structured_completion(.)
        - Kommentar: Get structured completion from OpenAI.
        - 
        - Args:
        -     prompt: The prompt
        -     response_model: Pydantic model for response structure
        -     model: Model to use (defaults to config)
        -     temperature: Temperature for generation
        -     use_cache: Whether to use caching
        -     context: Additional context for telemetry
        - 
        - Returns:
        -     Parsed response as Pydantic model instance
        - 
        - Raises:
        -     Various OpenAI errors
      - def analyze_order(.)
        - Kommentar: Analyze an order before placement.
      - def triage_alert(.)
        - Kommentar: Triage an alert for priority and action.
      - def review_backtest(.)
        - Kommentar: Review backtest results with AI analysis.
      - def analyze_signal(.)
        - Kommentar: Analyze a strategy signal.
      - def analyze_strategy_trades(.)
        - Kommentar: Analyze strategy trades and provide improvement suggestions.
      - def _build_order_analysis_prompt(.)
        - Kommentar: Build prompt for order analysis.
      - def _build_alert_triage_prompt(.)
        - Kommentar: Build prompt for alert triage.
      - def _build_signal_analysis_prompt(.)
        - Kommentar: Build prompt for signal analysis.
      - def _build_strategy_trade_analysis_prompt(.)
        - Kommentar: Build prompt for strategy trade analysis.
    - def get_openai_service(.)
      - Kommentar: Get or create OpenAI service instance.
      - 
      - Args:
      -     config: AI configuration
      -     api_key: OpenAI API key
      - 
      - Returns:
      -     OpenAI service instance
    - Kommentar: Re-export models for backward compatibility
    - Kommentar: ==================== Singleton Instance ====================
  - openai_utils.py
    - Class: CostTracker
      - Kommentar: Tracks AI API costs and enforces budget limits.
      - def __init__(.)
        - Kommentar: Initialize cost tracker.
        - 
        - Args:
        -     monthly_budget: Monthly budget in EUR
        -     warn_threshold: Warning threshold in EUR
      - def track_usage(.)
        - Kommentar: Track API usage and calculate cost.
        - 
        - Args:
        -     model: Model name
        -     input_tokens: Number of input tokens
        -     output_tokens: Number of output tokens
        - 
        - Returns:
        -     Cost in EUR
        - 
        - Raises:
        -     QuotaExceededError: If budget exceeded
    - Class: CacheManager
      - Kommentar: Manages caching of AI responses.
      - def __init__(.)
        - Kommentar: Initialize cache manager.
        - 
        - Args:
        -     ttl_seconds: Cache TTL in seconds
      - def _generate_key(.)
        - Kommentar: Generate cache key from request parameters.
      - def get(.)
        - Kommentar: Get cached response if available.
        - 
        - Args:
        -     prompt: The prompt
        -     model: Model name
        -     schema: Response schema
        - 
        - Returns:
        -     Cached response or None
      - def set(.)
        - Kommentar: Cache a response.
        - 
        - Args:
        -     prompt: The prompt
        -     model: Model name
        -     schema: Response schema
        -     response: The response to cache
      - def _cleanup_expired(.)
        - Kommentar: Remove expired entries from memory cache.
  - prompts.py
    - Class: PromptTemplates
      - Kommentar: Collection of prompt templates for different AI tasks.
    - Class: JSONSchemas
      - Kommentar: JSON schemas for structured outputs.
    - Class: PromptBuilder
      - Kommentar: Utility class for building prompts with context.
      - def build_order_prompt(.)
        - Kommentar: Build order analysis prompt with context.
      - def build_alert_prompt(.)
        - Kommentar: Build alert triage prompt with context.
      - def build_backtest_prompt(.)
        - Kommentar: Build backtest review prompt with context.
      - def build_signal_prompt(.)
        - Kommentar: Build signal analysis prompt with context.
      - def _format_dict(.)
        - Kommentar: Format dictionary for prompt inclusion.
    - Class: SchemaValidator
      - Kommentar: Utility for validating AI responses against schemas.
      - def validate_order_analysis(.)
        - Kommentar: Validate order analysis response.
      - def validate_alert_triage(.)
        - Kommentar: Validate alert triage response.
      - def validate_backtest_review(.)
        - Kommentar: Validate backtest review response.
      - def validate_signal_analysis(.)
        - Kommentar: Validate signal analysis response.
      - def _validate_against_schema(.)
        - Kommentar: Validate data against a JSON schema.
    - Class: PromptVersion
      - Kommentar: Manages prompt versions for A/B testing and improvements.
      - def get_prompt(.)
        - Kommentar: Get a specific version of a prompt.
  - __init__.py
  - event_bus.py
    - Class: EventType
      - Kommentar: Enumeration of all event types in the system.
    - Class: Event
      - Kommentar: Base event data structure.
    - Class: OrderEvent
      - Kommentar: Order-specific event with chart-relevant information.
      - def __post_init__(.)
        - Kommentar: Ensure data dict contains chart-relevant info.
    - Class: ExecutionEvent
      - Kommentar: Execution event for chart markers (entry/exit points).
      - def __post_init__(.)
        - Kommentar: Ensure data dict contains chart-relevant info.
    - Class: EventBus
      - Kommentar: Centralized event bus for the trading application.
      - def __init__(.)
        - Kommentar: Initialize the event bus with namespaced signals.
      - def get_signal(.)
        - Kommentar: Get or create a signal for the given event type.
      - def emit(.)
        - Kommentar: Emit an event to all registered listeners.
        - 
        - Args:
        -     event: The event to emit
      - def subscribe(.)
        - Kommentar: Subscribe to an event type.
        - 
        - Args:
        -     event_type: The type of event to subscribe to
        -     handler: The callback function to handle the event
      - def unsubscribe(.)
        - Kommentar: Unsubscribe from an event type.
        - 
        - Args:
        -     event_type: The type of event to unsubscribe from
        -     handler: The callback function to remove
      - def get_history(.)
        - Kommentar: Get event history, optionally filtered by type.
        - 
        - Args:
        -     event_type: Optional filter for specific event type
        -     limit: Maximum number of events to return
        - 
        - Returns:
        -     List of events matching the criteria
      - def clear_history(.)
        - Kommentar: Clear the event history.
    - Kommentar: Global event bus instance
    - Kommentar: Convenience functions for backward compatibility
  - logging_setup.py
    - Class: AITelemetryFilter
      - Kommentar: Custom filter to add AI telemetry data to log records.
      - def filter(.)
        - Kommentar: Add AI-specific fields to the log record if present.
    - Class: TradingJsonFormatter
      - Kommentar: Custom JSON formatter for trading application logs.
      - def add_fields(.)
        - Kommentar: Add custom fields to the JSON log output.
    - def configure_logging(.)
      - Kommentar: Configure comprehensive logging for the trading application.
      - 
      - Args:
      -     level: Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
      -     log_dir: Directory for log files (defaults to ./logs)
      -     enable_console: Enable console output
      -     enable_file: Enable file output
      -     enable_json: Use JSON format for logs
      -     max_bytes: Maximum size of log file before rotation
      -     backup_count: Number of backup files to keep
    - def configure_module_loggers(.)
      - Kommentar: Configure logging levels for specific modules.
    - def log_order_action(.)
      - Kommentar: Log order-related actions to the audit log.
      - 
      - Args:
      -     action: The action performed (create, submit, fill, cancel, etc.)
      -     order_id: Unique order identifier
      -     symbol: Trading symbol
      -     details: Additional order details
      -     logger_name: Name of the logger to use
    - def log_security_action(.)
      - Kommentar: Log security-relevant actions.
      - 
      - Args:
      -     action: Security action performed
      -     user_id: User identifier
      -     session_id: Session identifier
      -     ip_address: IP address
      -     details: Additional details
      -     success: Whether action succeeded
    - def get_audit_logger(.)
      - Kommentar: Get the audit logger instance.
    - def get_security_audit_logger(.)
      - Kommentar: Get the security audit logger instance.
    - def log_ai_request(.)
      - Kommentar: Log AI API requests for telemetry and cost tracking.
      - 
      - Args:
      -     model: AI model used
      -     tokens: Token count
      -     cost: Estimated cost
      -     latency: Request latency in seconds
      -     prompt_version: Version of the prompt template
      -     request_type: Type of AI request (analysis, order_review, etc.)
      -     details: Additional request details
    - def get_logger(.)
      - Kommentar: Get a logger instance with the given name.
      - 
      - Args:
      -     name: Logger name (usually __name__)
      - 
      - Returns:
      -     Configured logger instance
    - Kommentar: Import security types for audit logging
    - Kommentar: Fallback if security_core not available
  - security_core.py
    - Class: SecurityLevel
      - Kommentar: Security levels for operations.
    - Class: SecurityAction
      - Kommentar: Security-relevant actions.
    - Class: SecurityContext
      - Kommentar: Security context for operations.
      - def __post_init__(.)
    - Class: RateLimiter
      - Kommentar: Rate limiting implementation with sliding window.
      - def __init__(.)
        - Kommentar: Initialize rate limiter.
        - 
        - Args:
        -     max_requests: Maximum requests in window
        -     window_seconds: Time window in seconds
      - def is_allowed(.)
        - Kommentar: Check if request is allowed.
        - 
        - Args:
        -     key: Unique identifier for rate limiting
        - 
        - Returns:
        -     True if request is allowed
      - def get_remaining(.)
        - Kommentar: Get remaining requests in current window.
    - def hash_password(.)
      - Kommentar: Hash password with salt.
      - 
      - Args:
      -     password: Plain text password
      -     salt: Optional salt (generated if None)
      - 
      - Returns:
      -     Tuple of (hashed_password, salt)
    - def verify_password(.)
      - Kommentar: Verify password against stored hash.
      - 
      - Args:
      -     password: Plain text password
      -     stored_hash: Stored password hash
      -     salt: Salt used for hashing
      - 
      - Returns:
      -     True if password is correct
    - def generate_api_key(.)
      - Kommentar: Generate a secure API key.
      - 
      - Returns:
      -     URL-safe base64 encoded API key
    - def validate_api_key(.)
      - Kommentar: Validate API key format.
      - 
      - Args:
      -     api_key: API key to validate
      - 
      - Returns:
      -     True if format is valid
    - def rate_limit(.)
      - Kommentar: Rate limiting decorator.
      - 
      - Args:
      -     key: Rate limiting key
      -     max_requests: Max requests per window
      -     window_seconds: Window size in seconds
      - 
      - Returns:
      -     Decorator function
    - def is_strong_password(.)
      - Kommentar: Check if password meets strength requirements.
      - 
      - Args:
      -     password: Password to check
      - 
      - Returns:
      -     True if password is strong
    - def sanitize_input(.)
      - Kommentar: Sanitize user input.
      - 
      - Args:
      -     value: Input to sanitize
      -     max_length: Maximum allowed length
      - 
      - Returns:
      -     Sanitized input
    - Kommentar: Global rate limiter instance
  - __init__.py
    - Kommentar: Enums
    - Kommentar: Config classes
    - Kommentar: Manager
  - config_types.py
    - Class: TradingEnvironment
      - Kommentar: Trading environment modes.
    - Class: TradingMode
      - Kommentar: Trading execution modes.
      - 
      - BACKTEST: Historical backtesting with synthetic data
      - PAPER: Real-time paper trading with simulated execution
      - LIVE: Real-time live trading with actual money
    - Class: BrokerType
      - Kommentar: Supported broker types.
    - Class: BrokerConfig
      - Kommentar: Broker connection configuration.
    - Class: DatabaseConfig
      - Kommentar: Database configuration.
    - Class: MarketDataProviderConfig
      - Kommentar: Market data provider configuration and toggles.
    - Class: AIConfig
      - Kommentar: OpenAI API configuration.
    - Class: TradingConfig
      - Kommentar: Trading parameters and risk management.
    - Class: BacktestConfig
      - Kommentar: Backtesting configuration.
    - Class: AlertConfig
      - Kommentar: Alert and notification settings.
    - Class: UIConfig
      - Kommentar: User interface configuration.
    - Class: MonitoringConfig
      - Kommentar: Performance monitoring and metrics.
    - Class: ExecutionConfig
      - Kommentar: Order execution settings.
    - Kommentar: Import datetime for forward reference resolution
    - Kommentar: noqa: E402
    - Kommentar: Update forward references
  - loader.py
    - Class: AppSettings
      - Kommentar: Application-wide settings from environment variables.
    - Class: ConfigManager
      - Kommentar: Manages application configuration and profiles.
      - def __init__(.)
        - Kommentar: Initialize the configuration manager.
        - 
        - Args:
        -     config_dir: Directory containing configuration files
      - def load_profile(.)
        - Kommentar: Load a configuration profile.
        - 
        - Args:
        -     profile_name: Name of the profile to load
        - 
        - Returns:
        -     Loaded profile configuration
      - def save_profile(.)
        - Kommentar: Save the current profile to disk.
        - 
        - Args:
        -     profile: Profile to save (uses current if not provided)
      - def get_credential(.)
        - Kommentar: Retrieve a credential from .env file or Windows Credential Manager.
        - 
        - Priority:
        - 1. Check in-memory cache
        - 2. Check .env file in config/secrets/
        - 3. Check Windows Credential Manager
        - 
        - Args:
        -     key: Credential key (e.g., 'openai_api_key', 'alpaca_api_key')
        -     service: Service name for keyring
        - 
        - Returns:
        -     Credential value or None if not found
      - def set_credential(.)
        - Kommentar: Store a credential in Windows Credential Manager.
        - 
        - Args:
        -     key: Credential key
        -     value: Credential value
        -     service: Service name for keyring
      - def list_profiles(.)
        - Kommentar: List available configuration profiles.
        - 
        - Returns:
        -     List of profile names
      - def export_config(.)
        - Kommentar: Export current configuration (without secrets).
        - 
        - Args:
        -     path: Path to export configuration to
      - def save_watchlist(.)
        - Kommentar: Save watchlist to persistent storage.
      - def load_watchlist(.)
        - Kommentar: Load watchlist from persistent storage.
        - 
        - Returns:
        -     List of symbols in watchlist
      - def profile(.)
        - Kommentar: Get the current profile configuration.
    - Kommentar: Re-export all types for backward compatibility
    - Kommentar: Re-export all for backward compatibility
    - Kommentar: Enums
    - Kommentar: Config models
    - Kommentar: Settings and manager
    - Kommentar: Global configuration instance
  - profile_config.py
    - Class: ProfileConfig
      - Kommentar: Complete trading profile configuration.
      - def validate_environment(.)
        - Kommentar: Ensure production environment has proper safeguards.
      - def validate_trading_mode_field(.)
        - Kommentar: Convert string to enum if needed.
      - def validate_trading_mode_config(.)
        - Kommentar: Ensure trading mode has appropriate safety settings.
      - def is_safe_for_mode(.)
        - Kommentar: Check if current configuration is safe for specified mode.
        - 
        - Args:
        -     mode: Trading mode to validate
        - 
        - Returns:
        -     Tuple of (is_safe, list of warnings/errors)
      - def switch_to_mode(.)
        - Kommentar: Switch to specified trading mode with safety checks.
        - 
        - Args:
        -     mode: Trading mode to switch to
        -     validate: Whether to validate the switch (default: True)
        - 
        - Raises:
        -     ValueError: If validation fails and validate=True
      - def create_backtest_profile(.)
        - Kommentar: Create a profile optimized for backtesting.
        - 
        - Args:
        -     name: Profile name
        -     initial_capital: Initial capital for backtest
        - 
        - Returns:
        -     ProfileConfig configured for backtesting
      - def create_paper_profile(.)
        - Kommentar: Create a profile for paper trading.
        - 
        - Args:
        -     name: Profile name
        -     broker_type: Broker to use for paper trading
        - 
        - Returns:
        -     ProfileConfig configured for paper trading
      - def create_live_profile(.)
        - Kommentar: Create a profile for live trading with maximum safety.
        - 
        - Args:
        -     name: Profile name
        -     broker_type: Broker to use for live trading
        - 
        - Returns:
        -     ProfileConfig configured for live trading
        - 
        - Warning:
        -     Live trading involves real money. Ensure all settings are correct.
  - __init__.py
  - __init__.py
    - Kommentar: Import new comprehensive BacktestResult from models
    - Kommentar: Configuration
    - Kommentar: Engine
    - Kommentar: New comprehensive models (preferred)
    - Kommentar: Legacy model (deprecated)
  - backtrader_integration.py
    - Class: BacktestEngine
      - Kommentar: Engine for running backtests with Backtrader.
      - def __init__(.)
        - Kommentar: Initialize backtest engine.
        - 
        - Args:
        -     history_manager: Historical data manager (optional, only needed if fetching from data sources)
      - def run_backtest(.)
        - Kommentar: Run a backtest.
        - 
        - Args:
        -     config: Backtest configuration
        - 
        - Returns:
        -     Backtest results
      - def _get_data_feed(.)
        - Kommentar: Get data feed for symbol.
      - def _process_results(.)
        - Kommentar: Process backtest results using comprehensive BacktestResult model.
      - def run_backtest_with_definition(.)
        - Kommentar: Run backtest with StrategyDefinition (YAML/JSON strategy).
      - def optimize_strategy(.)
        - Kommentar: Optimize strategy parameters.
      - def _generate_param_combinations(.)
        - Kommentar: Generate parameter combinations for optimization.
      - def plot_results(.)
        - Kommentar: Plot backtest results.
    - Kommentar: Try importing backtrader
    - Kommentar: Re-export for backward compatibility
  - backtrader_strategy.py
    - Kommentar: Try importing backtrader
    - Kommentar: Initialize our strategy
    - Kommentar: Track orders and positions
    - Kommentar: Performance tracking
    - Kommentar: Sell
    - Kommentar: Calculate profit
    - Kommentar: Convert Backtrader data to DataFrame for our strategy
    - Kommentar: Evaluate our strategy
    - Kommentar: Get historical data
    - Kommentar: Check for pending orders
    - Kommentar: Get current position
    - Kommentar: Calculate position size
    - Kommentar: Get available cash
    - Kommentar: Risk management - limit position to percentage of portfolio
    - Kommentar: Max 20% per position
    - Kommentar: Use signal confidence for sizing
    - Kommentar: Stub class when backtrader is not available
  - backtrader_types.py
    - Class: BacktestConfig
      - Kommentar: Configuration for backtesting.
      - def __post_init__(.)
    - Class: BacktestResultLegacy
      - Kommentar: Legacy results from backtesting (deprecated, use BacktestResult from models).
      - 
      - Kept for backward compatibility only. New code should use
      - src.core.models.backtest_models.BacktestResult instead.
  - optimization.py
    - Class: ParameterOptimizer
      - Kommentar: AI-guided parameter optimizer for trading strategies.
      - def __init__(.)
        - Kommentar: Initialize parameter optimizer.
        - 
        - Args:
        -     backtest_runner: Async function that runs backtest with parameters
        -                     Signature: async def runner(params: dict) -> BacktestResult
        -     config: Optimizer configuration
      - def grid_search(.)
        - Kommentar: Perform grid search optimization.
        - 
        - Args:
        -     parameter_ranges: Parameter ranges to search
        -     base_params: Base parameters (not optimized)
        - 
        - Returns:
        -     Optimization result with best parameters
      - def optimize_with_ai(.)
        - Kommentar: Perform AI-guided optimization with iterative refinement.
        - 
        - Args:
        -     parameter_ranges: Initial parameter ranges
        -     base_params: Base parameters
        -     max_iterations: Maximum optimization iterations
        - 
        - Returns:
        -     Tuple of (optimization result, AI insights)
      - def _calculate_score(.)
        - Kommentar: Calculate optimization score for a backtest result.
        - 
        - Args:
        -     result: Backtest result
        - 
        - Returns:
        -     Optimization score (higher is better)
      - def _get_metric_value(.)
        - Kommentar: Extract metric value from backtest result.
        - 
        - Args:
        -     result: Backtest result
        -     metric_name: Name of metric to extract
        - 
        - Returns:
        -     Metric value or None if not found
      - def _extract_metrics(.)
        - Kommentar: Extract key metrics from backtest result.
        - 
        - Args:
        -     result: Backtest result
        - 
        - Returns:
        -     Dictionary of key metrics
      - def _analyze_sensitivity(.)
        - Kommentar: Analyze parameter sensitivity.
        - 
        - Args:
        -     parameter_ranges: Parameter ranges tested
        - 
        - Returns:
        -     Sensitivity analysis for each parameter
      - def _get_ai_insights(.)
        - Kommentar: Get AI insights about optimization results.
        - 
        - Args:
        -     result: Optimization result
        - 
        - Returns:
        -     AI-generated insights
      - def _build_optimization_prompt(.)
        - Kommentar: Build prompt for AI optimization analysis.
        - 
        - Args:
        -     result: Optimization result
        - 
        - Returns:
        -     Prompt for AI analysis
      - def _refine_ranges(.)
        - Kommentar: Refine parameter ranges based on AI insights.
        - 
        - Args:
        -     current_ranges: Current parameter ranges
        -     result: Optimization result
        -     insights: AI insights
        - 
        - Returns:
        -     Refined parameter ranges
    - def quick_optimize(.)
      - Kommentar: Quick parameter optimization with default settings.
      - 
      - Args:
      -     backtest_runner: Async backtest runner function
      -     parameter_ranges: Dict of parameter name to list of values
      -     base_params: Base parameters
      -     primary_metric: Metric to optimize
      - 
      - Returns:
      -     Optimization result
      - 
      - Example:
      -     >>> async def run_backtest(params):
      -     ...     # Run backtest with params
      -     ...     return backtest_result
      -     >>>
      -     >>> result = await quick_optimize(
      -     ...     run_backtest,
      -     ...     {"fast_period": [10, 15, 20], "slow_period": [40, 50, 60]},
      -     ...     primary_metric="sharpe_ratio"
      -     ... )
    - Kommentar: Import types from optimization_types
    - Kommentar: Re-export for backward compatibility
  - optimization_types.py
    - Class: ParameterRange
      - Kommentar: Parameter range for optimization.
    - Class: OptimizationMetric
      - Kommentar: Metric for optimization.
    - Class: ParameterTest
      - Kommentar: Single parameter test result.
    - Class: OptimizationResult
      - Kommentar: Complete optimization result.
    - Class: AIOptimizationInsight
      - Kommentar: AI-generated optimization insights.
    - Class: OptimizerConfig
      - Kommentar: Configuration for parameter optimizer.
  - result_converter.py
    - def backtrader_to_backtest_result(.)
      - Kommentar: Convert Backtrader results to comprehensive BacktestResult.
      - 
      - Args:
      -     strategy: Backtrader strategy instance with analyzers
      -     cerebro: Backtrader Cerebro instance
      -     initial_value: Initial portfolio value
      -     final_value: Final portfolio value
      -     symbol: Primary trading symbol
      -     timeframe: Data timeframe (e.g., '1min', '1D')
      -     start_date: Backtest start datetime
      -     end_date: Backtest end datetime
      -     strategy_name: Optional strategy identifier
      -     strategy_params: Optional strategy parameters
      - 
      - Returns:
      -     Comprehensive BacktestResult instance
      - 
      - Raises:
      -     ValueError: If required data is missing
    - def _extract_bars_from_strategy(.)
      - Kommentar: Extract OHLCV bars from Backtrader strategy data feed.
      - 
      - Args:
      -     strategy: Backtrader strategy instance
      -     symbol: Trading symbol
      - 
      - Returns:
      -     List of Bar instances
    - def _extract_trades_from_strategy(.)
      - Kommentar: Extract trades from Backtrader strategy.
      - 
      - Args:
      -     strategy: Backtrader strategy instance
      -     symbol: Trading symbol
      - 
      - Returns:
      -     List of Trade instances
    - def _extract_equity_curve(.)
      - Kommentar: Extract equity curve from Backtrader strategy.
      - 
      - Args:
      -     strategy: Backtrader strategy instance
      -     initial_value: Initial portfolio value
      - 
      - Returns:
      -     List of EquityPoint instances
    - def _calculate_metrics(.)
      - Kommentar: Calculate comprehensive backtest metrics.
      - 
      - Args:
      -     trades: List of Trade instances
      -     equity_curve: List of EquityPoint instances
      -     initial_capital: Initial portfolio value
      -     final_capital: Final portfolio value
      -     start_date: Backtest start datetime
      -     end_date: Backtest end datetime
      -     strategy_analyzers: Backtrader analyzers object
      - 
      - Returns:
      -     BacktestMetrics instance
    - def _calculate_max_consecutive(.)
      - Kommentar: Calculate maximum consecutive wins or losses.
      - 
      - Args:
      -     trades: List of Trade instances
      -     is_winner: True to count wins, False to count losses
      - 
      - Returns:
      -     Maximum consecutive count
    - def _extract_indicators(.)
      - Kommentar: Extract indicator values from Backtrader strategy.
      - 
      - Args:
      -     strategy: Backtrader strategy instance
      - 
      - Returns:
      -     Dictionary mapping indicator names to time-series data
  - __init__.py
    - Kommentar: Base classes and interfaces
    - Kommentar: Errors
    - Kommentar: Data models
    - Kommentar: AI hooks
    - Kommentar: Rate limiting
    - Kommentar: Implementations
  - base.py
    - Class: BrokerAdapter
      - Kommentar: Abstract base class for broker integrations with template methods.
      - def __init__(.)
        - Kommentar: Initialize broker adapter.
        - 
        - Args:
        -     name: Broker name
        -     fee_model: Fee calculation model
        -     rate_limit: Rate limiter instance
        -     ai_hook: AI analysis hook function
        -     **kwargs: Additional broker-specific parameters
      - def connect(.)
        - Kommentar: Establish connection to broker using template method pattern.
        - 
        - This method coordinates the connection process:
        - 1. Validate credentials
        - 2. Establish broker-specific connection
        - 3. Verify connection is working
        - 4. Set up initial state (optional)
        - 
        - Subclasses should implement _establish_connection() for broker-specific logic.
      - def disconnect(.)
        - Kommentar: Disconnect from broker using template method pattern.
        - 
        - This method coordinates the disconnection process:
        - 1. Cleanup broker-specific resources
        - 2. Reset connection state
        - 3. Log disconnection
        - 
        - Subclasses should implement _cleanup_resources() for broker-specific cleanup.
      - def is_connected(.)
        - Kommentar: Check if connected to broker.
        - 
        - Default implementation checks the _connected flag.
        - Subclasses can override for more sophisticated checks.
        - 
        - Returns:
        -     True if connected
      - def _validate_credentials(.)
        - Kommentar: Validate credentials before connecting.
        - 
        - Optional hook for subclasses to validate API keys, tokens, etc.
        - Default implementation does nothing.
      - def _establish_connection(.)
        - Kommentar: Establish broker-specific connection.
        - 
        - Required method for subclasses to implement the actual
        - connection logic (e.g., create client, connect WebSocket, etc.).
        - 
        - Raises:
        -     BrokerConnectionError: If connection fails
      - def _verify_connection(.)
        - Kommentar: Verify the connection is working.
        - 
        - Optional hook for subclasses to test the connection
        - (e.g., make a test API call).
        - Default implementation does nothing.
      - def _setup_initial_state(.)
        - Kommentar: Set up initial state after connection.
        - 
        - Optional hook for subclasses to request initial data,
        - subscribe to streams, etc.
        - Default implementation does nothing.
      - def _cleanup_resources(.)
        - Kommentar: Clean up broker-specific resources.
        - 
        - Required method for subclasses to implement cleanup logic
        - (e.g., close clients, cancel tasks, close WebSockets).
      - def _ensure_connected(.)
        - Kommentar: Ensure the adapter is connected.
        - 
        - Raises:
        -     BrokerConnectionError: If not connected
      - def is_available(.)
        - Kommentar: Check if broker API is available.
        - 
        - Default implementation tries to establish connection and check status.
        - Subclasses can override for more sophisticated health checks.
        - 
        - Returns:
        -     True if broker is available
      - def _check_api_status(.)
        - Kommentar: Check broker API status.
        - 
        - Optional hook for subclasses to implement API health check.
        - Default implementation returns True if connected.
        - 
        - Returns:
        -     True if API is healthy
      - def place_order(.)
        - Kommentar: Place an order with the broker.
        - 
        - Args:
        -     order: Order request details
        - 
        - Returns:
        -     Order response with broker confirmation
        - 
        - Raises:
        -     Various broker errors
      - def _place_order_impl(.)
        - Kommentar: Internal implementation of order placement.
      - def cancel_order(.)
        - Kommentar: Cancel an order.
        - 
        - Args:
        -     order_id: Broker order ID
        - 
        - Returns:
        -     True if cancellation successful
      - def get_order_status(.)
        - Kommentar: Get current order status.
        - 
        - Args:
        -     order_id: Broker order ID
        - 
        - Returns:
        -     Current order information
      - def get_positions(.)
        - Kommentar: Get all current positions.
      - def get_balance(.)
        - Kommentar: Get account balance.
      - def get_quote(.)
        - Kommentar: Get current quote for symbol (if supported).
      - def _validate_order(.)
        - Kommentar: Validate order parameters.
      - def calculate_fee(.)
        - Kommentar: Calculate estimated fee for order.
      - def activate_kill_switch(.)
        - Kommentar: Activate the kill switch to halt all trading.
      - def deactivate_kill_switch(.)
        - Kommentar: Deactivate the kill switch.
    - Kommentar: Import types from broker_types
    - Kommentar: Re-export for backward compatibility
  - broker_types.py
    - Class: BrokerError
      - Kommentar: Base exception for broker-related errors.
      - def __init__(.)
    - Class: BrokerConnectionError
      - Kommentar: Raised when broker connection fails.
    - Class: OrderValidationError
      - Kommentar: Raised when order validation fails.
    - Class: InsufficientFundsError
      - Kommentar: Raised when account has insufficient funds.
    - Class: RateLimitError
      - Kommentar: Raised when rate limit is exceeded.
    - Class: OrderRequest
      - Kommentar: Standardized order request.
      - def validate_limit_price(.)
        - Kommentar: Ensure limit price is set for limit orders.
      - def validate_stop_price(.)
        - Kommentar: Ensure stop price is set for stop orders.
    - Class: OrderResponse
      - Kommentar: Standardized order response.
    - Class: Position
      - Kommentar: Current position information.
      - def is_long(.)
      - def is_short(.)
    - Class: Balance
      - Kommentar: Account balance information.
    - Class: FeeModel
      - Kommentar: Fee calculation model.
      - def calculate(.)
        - Kommentar: Calculate total fee for an order.
    - Class: AIAnalysisRequest
      - Kommentar: Request for AI analysis before order placement.
    - Class: AIAnalysisResult
      - Kommentar: Result from AI analysis.
    - Class: TokenBucketRateLimiter
      - Kommentar: Token bucket rate limiter for API calls.
      - def __init__(.)
        - Kommentar: Initialize rate limiter.
        - 
        - Args:
        -     rate: Tokens per second
        -     burst: Maximum burst size
      - def acquire(.)
        - Kommentar: Acquire tokens, blocking if necessary.
      - def try_acquire(.)
        - Kommentar: Try to acquire tokens without blocking.
  - ibkr_adapter.py
    - Class: IBKRWrapper
      - Kommentar: IB API Wrapper for handling callbacks.
      - def __init__(.)
      - def nextValidId(.)
        - Kommentar: Callback for next valid order ID.
      - def connectionClosed(.)
        - Kommentar: Callback when connection is closed.
      - def error(.)
        - Kommentar: Error callback.
      - def orderStatus(.)
        - Kommentar: Order status update callback.
      - def position(.)
        - Kommentar: Position update callback.
      - def accountSummary(.)
        - Kommentar: Account summary callback.
      - def historicalData(.)
        - Kommentar: Historical data callback.
      - def tickPrice(.)
        - Kommentar: Tick price callback.
      - def _map_order_status(.)
        - Kommentar: Map IB order status to internal status.
    - Class: IBKRClient
      - Kommentar: IB API Client.
      - def __init__(.)
    - Class: IBKRAdapter
      - Kommentar: Interactive Brokers adapter using official TWS/Gateway API.
      - def __init__(.)
        - Kommentar: Initialize IBKR adapter.
        - 
        - Args:
        -     host: TWS/Gateway host
        -     port: TWS/Gateway port (7497 for paper, 7496 for live)
        -     client_id: Unique client ID
        -     paper_trading: Whether to use paper trading
        -     **kwargs: Additional arguments for base class
      - def _get_next_req_id(.)
        - Kommentar: Get next request ID thread-safely.
      - def _establish_connection(.)
        - Kommentar: Establish connection to IBKR TWS/Gateway (template method implementation).
      - def _verify_connection(.)
        - Kommentar: Verify IBKR connection by waiting for connection event.
      - def _setup_initial_state(.)
        - Kommentar: Request initial account and position data (template method implementation).
      - def _cleanup_resources(.)
        - Kommentar: Clean up IBKR resources (template method implementation).
      - def is_connected(.)
        - Kommentar: Check if connected to IBKR.
      - def _place_order_impl(.)
        - Kommentar: Place order with IBKR.
      - def _create_contract(.)
        - Kommentar: Create IB contract object.
      - def _create_ib_order(.)
        - Kommentar: Create IB order object.
      - def cancel_order(.)
        - Kommentar: Cancel an order.
      - def get_order_status(.)
        - Kommentar: Get current order status.
      - def get_positions(.)
        - Kommentar: Get all current positions.
      - def get_balance(.)
        - Kommentar: Get account balance.
      - def get_quote(.)
        - Kommentar: Get current quote for symbol.
      - def get_historical_bars(.)
        - Kommentar: Get historical bars for symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        -     duration: Duration string (e.g., "1 D", "1 W")
        -     bar_size: Bar size (e.g., "1 min", "5 mins", "1 hour")
        - 
        - Returns:
        -     List of bar data
  - mock_broker.py
    - Class: MockBroker
      - Kommentar: Mock broker for testing and development.
      - def __init__(.)
        - Kommentar: Initialize mock broker.
        - 
        - Args:
        -     initial_cash: Starting cash balance
        -     **kwargs: Additional arguments for base class
      - def _establish_connection(.)
        - Kommentar: Simulate broker connection (template method implementation).
      - def _cleanup_resources(.)
        - Kommentar: Clean up mock broker resources (template method implementation).
      - def _place_order_impl(.)
        - Kommentar: Place order in mock broker.
      - def _simulate_fill(.)
        - Kommentar: Simulate order fill.
      - def _update_position(.)
        - Kommentar: Update position after fill.
      - def cancel_order(.)
        - Kommentar: Cancel an order.
      - def get_order_status(.)
        - Kommentar: Get order status.
      - def get_positions(.)
        - Kommentar: Get all positions.
      - def get_balance(.)
        - Kommentar: Get account balance.
      - def get_quote(.)
        - Kommentar: Get current quote for symbol.
      - def _get_market_price(.)
        - Kommentar: Get simulated market price.
      - def set_market_price(.)
        - Kommentar: Set market price for testing.
  - trade_republic_adapter.py
    - Class: TradeRepublicAdapter
      - Kommentar: Trade Republic broker adapter using unofficial API.
      - 
      - WARNING: This implementation uses unofficial/private APIs that may:
      - - Change without notice
      - - Violate Terms of Service
      - - Result in account suspension
      - - Not work reliably
      - 
      - Use at your own risk. Consider using IBKR for production trading.
      - def __init__(.)
        - Kommentar: Initialize Trade Republic adapter.
        - 
        - Args:
        -     phone_number: Phone number for authentication
        -     pin: PIN for authentication
        -     **kwargs: Additional arguments for base class
      - def _establish_connection(.)
        - Kommentar: Establish connection to Trade Republic (template method implementation).
      - def _setup_initial_state(.)
        - Kommentar: Set up initial state after connection (template method implementation).
      - def _authenticate(.)
        - Kommentar: Authenticate with Trade Republic.
      - def _connect_websocket(.)
        - Kommentar: Connect to Trade Republic WebSocket.
      - def _listen_websocket(.)
        - Kommentar: Listen for WebSocket messages.
      - def _handle_ws_message(.)
        - Kommentar: Handle incoming WebSocket message.
      - def _heartbeat_loop(.)
        - Kommentar: Send periodic heartbeat to keep connection alive.
      - def _reconnect(.)
        - Kommentar: Reconnect with exponential backoff.
      - def _cleanup_resources(.)
        - Kommentar: Clean up Trade Republic resources (template method implementation).
      - def is_connected(.)
        - Kommentar: Check if connected to Trade Republic.
      - def _place_order_impl(.)
        - Kommentar: Place order with Trade Republic.
      - def cancel_order(.)
        - Kommentar: Cancel an order.
      - def get_order_status(.)
        - Kommentar: Get current order status.
      - def get_positions(.)
        - Kommentar: Get all current positions.
      - def get_balance(.)
        - Kommentar: Get account balance.
      - def _rate_limit(.)
        - Kommentar: Enforce rate limiting.
      - def _get_isin(.)
        - Kommentar: Convert symbol to ISIN.
      - def _map_order_type(.)
        - Kommentar: Map internal order type to TR API format.
      - def _parse_order_response(.)
        - Kommentar: Parse order response from API.
      - def _parse_position(.)
        - Kommentar: Parse position from API response.
      - def _handle_ticker(.)
        - Kommentar: Handle ticker updates from WebSocket.
      - def _handle_order_update(.)
        - Kommentar: Handle order status updates from WebSocket.
  - __init__.py
  - events.py
    - Class: OrderEventEmitter
      - Kommentar: Emits order events to the event bus for chart markers and UI updates.
      - def __init__(.)
        - Kommentar: Initialize the order event emitter.
        - 
        - Args:
        -     symbol: Trading symbol
        -     source: Event source identifier
      - def emit_order_created(.)
        - Kommentar: Emit ORDER_CREATED event.
        - 
        - Args:
        -     order_id: Unique order identifier
        -     order_type: Order type (market, limit, stop, etc.)
        -     side: Order side (buy, sell, long, short)
        -     quantity: Order quantity
        -     price: Order price (None for market orders)
        -     **kwargs: Additional metadata
      - def emit_order_submitted(.)
        - Kommentar: Emit ORDER_SUBMITTED event.
      - def emit_order_filled(.)
        - Kommentar: Emit ORDER_FILLED event.
        - 
        - Args:
        -     order_id: Order identifier
        -     filled_quantity: Quantity filled
        -     avg_fill_price: Average fill price
        -     **kwargs: Additional metadata
      - def emit_order_partial_fill(.)
        - Kommentar: Emit ORDER_PARTIAL_FILL event.
      - def emit_order_cancelled(.)
        - Kommentar: Emit ORDER_CANCELLED event.
      - def emit_order_rejected(.)
        - Kommentar: Emit ORDER_REJECTED event.
    - Class: ExecutionEventEmitter
      - Kommentar: Emits execution events (trade entry/exit) for chart markers.
      - def __init__(.)
        - Kommentar: Initialize the execution event emitter.
        - 
        - Args:
        -     symbol: Trading symbol
        -     source: Event source identifier
      - def emit_trade_entry(.)
        - Kommentar: Emit TRADE_ENTRY event for chart marker.
        - 
        - Args:
        -     trade_id: Unique trade identifier
        -     side: Trade side (long, short)
        -     quantity: Entry quantity
        -     price: Entry price
        -     **kwargs: Additional metadata
      - def emit_trade_exit(.)
        - Kommentar: Emit TRADE_EXIT event for chart marker.
        - 
        - Args:
        -     trade_id: Trade identifier
        -     side: Trade side (long, short)
        -     quantity: Exit quantity
        -     price: Exit price
        -     pnl: Profit/loss in currency
        -     pnl_pct: Profit/loss percentage
        -     reason: Exit reason (signal, stop_loss, take_profit, manual)
        -     **kwargs: Additional metadata
      - def emit_stop_loss_hit(.)
        - Kommentar: Emit STOP_LOSS_HIT event.
      - def emit_take_profit_hit(.)
        - Kommentar: Emit TAKE_PROFIT_HIT event.
      - def emit_position_opened(.)
        - Kommentar: Emit POSITION_OPENED event.
      - def emit_position_closed(.)
        - Kommentar: Emit POSITION_CLOSED event.
    - Class: BacktraderEventAdapter
      - Kommentar: Adapter to emit events from Backtrader strategy execution.
      - def __init__(.)
        - Kommentar: Initialize the Backtrader event adapter.
        - 
        - Args:
        -     symbol: Trading symbol
        -     source: Event source (default: "backtest")
      - def on_order_created(.)
        - Kommentar: Handle order created by Backtrader.
      - def on_order_submitted(.)
        - Kommentar: Handle order submitted.
      - def on_order_filled(.)
        - Kommentar: Handle order filled and emit appropriate events.
      - def on_order_cancelled(.)
        - Kommentar: Handle order cancelled.
      - def on_order_rejected(.)
        - Kommentar: Handle order rejected.
      - def _get_order_type(.)
        - Kommentar: Get order type string from Backtrader order.
      - def _get_order_side(.)
        - Kommentar: Get order side from Backtrader order.
  - __init__.py
    - Kommentar: Re-export all types and classes for backward compatibility
    - Kommentar: Main engine
    - Kommentar: Types
    - Kommentar: Calculator classes
    - Kommentar: Library availability flags
  - base.py
    - Class: BaseIndicatorCalculator
      - Kommentar: Base class for indicator calculators.
      - 
      - Provides common utilities and validation logic.
      - def validate_data(.)
        - Kommentar: Validate input data.
        - 
        - Args:
        -     data: OHLCV DataFrame
        -     config: Indicator configuration
        - 
        - Returns:
        -     True if valid
      - def create_result(.)
        - Kommentar: Create indicator result.
        - 
        - Args:
        -     indicator_type: Type of indicator
        -     values: Calculated values
        -     params: Calculation parameters
        -     metadata: Optional metadata
        - 
        - Returns:
        -     Indicator result
    - Kommentar: Try to import TA-Lib (optional dependency)
    - Kommentar: Try to import pandas_ta (fallback for TA-Lib)
    - Kommentar: Export library availability flags
    - Kommentar: Only export talib if available
    - Kommentar: Only export pandas_ta if available
  - custom.py
    - Class: CustomIndicators
      - Kommentar: Calculator for custom indicators.
      - def calculate_pivots(.)
        - Kommentar: Calculate Pivot Points.
      - def calculate_support_resistance(.)
        - Kommentar: Calculate Support and Resistance levels.
      - def calculate_patterns(.)
        - Kommentar: Detect price patterns.
    - Kommentar: Import optional libraries
  - engine.py
    - Class: IndicatorEngine
      - Kommentar: Engine for calculating technical indicators.
      - def __init__(.)
        - Kommentar: Initialize indicator engine.
        - 
        - Args:
        -     cache_size: Size of LRU cache for results
      - def calculate(.)
        - Kommentar: Calculate indicator for given data.
        - 
        - Args:
        -     data: OHLCV DataFrame with columns: open, high, low, close, volume
        -     config: Indicator configuration
        - 
        - Returns:
        -     Indicator result
      - def calculate_multiple(.)
        - Kommentar: Calculate multiple indicators.
        - 
        - Args:
        -     data: OHLCV DataFrame
        -     configs: List of indicator configurations
        - 
        - Returns:
        -     Dictionary of results by indicator type
      - def _get_cache_key(.)
        - Kommentar: Generate cache key.
      - def clear_cache(.)
        - Kommentar: Clear indicator cache.
  - momentum.py
    - Class: MomentumIndicators
      - Kommentar: Calculator for momentum indicators.
      - def calculate_rsi(.)
        - Kommentar: Calculate RSI.
      - def calculate_stoch(.)
        - Kommentar: Calculate Stochastic Oscillator.
      - def calculate_mom(.)
        - Kommentar: Calculate Momentum.
      - def calculate_roc(.)
        - Kommentar: Calculate Rate of Change.
      - def calculate_willr(.)
        - Kommentar: Calculate Williams %R.
      - def calculate_cci(.)
        - Kommentar: Calculate CCI.
      - def calculate_mfi(.)
        - Kommentar: Calculate Money Flow Index.
    - Kommentar: Import optional libraries
  - trend.py
    - Class: TrendIndicators
      - Kommentar: Calculator for trend indicators.
      - def calculate_sma(.)
        - Kommentar: Calculate Simple Moving Average.
      - def calculate_ema(.)
        - Kommentar: Calculate Exponential Moving Average.
      - def calculate_wma(.)
        - Kommentar: Calculate Weighted Moving Average.
      - def calculate_vwma(.)
        - Kommentar: Calculate Volume Weighted Moving Average.
      - def calculate_macd(.)
        - Kommentar: Calculate MACD.
      - def calculate_adx(.)
        - Kommentar: Calculate ADX.
      - def calculate_psar(.)
        - Kommentar: Calculate Parabolic SAR.
      - def calculate_ichimoku(.)
        - Kommentar: Calculate Ichimoku Cloud.
    - Kommentar: Import optional libraries
  - types.py
    - Class: IndicatorType
      - Kommentar: Types of technical indicators.
    - Class: IndicatorConfig
      - Kommentar: Configuration for an indicator.
    - Class: IndicatorResult
      - Kommentar: Result from indicator calculation.
  - volatility.py
    - Class: VolatilityIndicators
      - Kommentar: Calculator for volatility indicators.
      - def calculate_bb(.)
        - Kommentar: Calculate Bollinger Bands.
      - def calculate_kc(.)
        - Kommentar: Calculate Keltner Channels.
      - def calculate_atr(.)
        - Kommentar: Calculate Average True Range.
      - def calculate_natr(.)
        - Kommentar: Calculate Normalized ATR.
      - def calculate_std(.)
        - Kommentar: Calculate Standard Deviation.
    - Kommentar: Import optional libraries
  - volume.py
    - Class: VolumeIndicators
      - Kommentar: Calculator for volume indicators.
      - def calculate_obv(.)
        - Kommentar: Calculate On-Balance Volume.
      - def calculate_cmf(.)
        - Kommentar: Calculate Chaikin Money Flow.
      - def calculate_ad(.)
        - Kommentar: Calculate Accumulation/Distribution.
      - def calculate_fi(.)
        - Kommentar: Calculate Force Index.
      - def calculate_vwap(.)
        - Kommentar: Calculate VWAP.
    - Kommentar: Import optional libraries
  - __init__.py
    - Kommentar: Types
    - Kommentar: Providers
    - Kommentar: Stream Clients
  - alpaca_crypto_provider.py
    - Class: AlpacaCryptoProvider
      - Kommentar: Alpaca cryptocurrency historical data provider.
      - 
      - Uses Alpaca's Crypto Data API:
      - - Endpoint: https://data.alpaca.markets/v1beta3/crypto/us/
      - - Supported trading pairs: BTC/USD, ETH/USD, ETH/BTC, SOL/USDT, etc.
      - - Free tier: 200 API calls/minute
      - - Real-time data available via WebSocket (see AlpacaCryptoStreamClient)
      - def __init__(.)
        - Kommentar: Initialize Alpaca crypto provider.
        - 
        - Args:
        -     api_key: Alpaca API key
        -     api_secret: Alpaca API secret
      - def fetch_bars(.)
        - Kommentar: Fetch historical crypto bars from Alpaca.
        - 
        - Args:
        -     symbol: Crypto trading pair (e.g., "BTC/USD", "ETH/USD", "SOL/USDT")
        -     start_date: Start date for data
        -     end_date: End date for data
        -     timeframe: Bar timeframe
        - 
        - Returns:
        -     List of historical bars
      - def is_available(.)
        - Kommentar: Check if Alpaca crypto provider is available.
        - 
        - Returns:
        -     True if provider is available
      - def _ensure_utc_naive(.)
        - Kommentar: Convert datetime to UTC naive datetime.
        - 
        - Args:
        -     dt: Datetime to convert
        - 
        - Returns:
        -     UTC naive datetime
      - def _timeframe_to_alpaca(.)
        - Kommentar: Convert timeframe to Alpaca format.
        - 
        - Args:
        -     timeframe: Internal timeframe
        - 
        - Returns:
        -     Alpaca TimeFrame object
      - def _check_sdk(.)
        - Kommentar: Check whether the Alpaca SDK is installed.
        - 
        - Returns:
        -     True if SDK is available
  - alpaca_crypto_stream.py
    - Class: AlpacaCryptoStreamClient
      - Kommentar: Real-time cryptocurrency market data client for Alpaca using WebSocket.
      - 
      - Supports streaming of:
      - - Crypto bars (OHLCV candlesticks)
      - - Crypto trades (individual transactions)
      - - Crypto quotes (bid/ask prices)
      - - Crypto orderbooks (market depth)
      - 
      - Supported trading pairs: BTC/USD, ETH/USD, ETH/BTC, SOL/USDT, etc.
      - def __init__(.)
        - Kommentar: Initialize Alpaca crypto stream client.
        - 
        - Args:
        -     api_key: Alpaca API key
        -     api_secret: Alpaca API secret
        -     paper: Use paper trading (default: True)
        -     buffer_size: Size of the data buffer
      - def connect(.)
        - Kommentar: Connect to Alpaca Crypto WebSocket stream.
        - 
        - Returns:
        -     True if connection successful
      - def _run_stream(.)
        - Kommentar: Run the Alpaca crypto stream with automatic reconnection.
      - def disconnect(.)
        - Kommentar: Disconnect from Alpaca crypto stream.
      - def _stop_stream_sync(.)
        - Kommentar: Synchronous stream stop (runs in thread).
      - def subscribe(.)
        - Kommentar: Subscribe to crypto symbols.
        - 
        - Args:
        -     symbols: List of crypto trading pairs (e.g., ["BTC/USD", "ETH/USD"])
      - def unsubscribe(.)
        - Kommentar: Unsubscribe from crypto symbols.
        - 
        - Args:
        -     symbols: List of crypto trading pairs to unsubscribe from
      - def _unsubscribe_sync(.)
        - Kommentar: Synchronous unsubscribe (runs in thread).
      - def _on_bar(.)
        - Kommentar: Handle crypto bar (OHLCV) data.
        - 
        - Args:
        -     bar: Alpaca crypto bar object
      - def _on_trade(.)
        - Kommentar: Handle crypto trade data.
        - 
        - Args:
        -     trade: Alpaca crypto trade object
      - def _on_quote(.)
        - Kommentar: Handle crypto quote (bid/ask) data.
        - 
        - Args:
        -     quote: Alpaca crypto quote object
      - def get_latest_tick(.)
        - Kommentar: Get the latest tick for a crypto symbol.
        - 
        - Args:
        -     symbol: Crypto trading pair (e.g., "BTC/USD")
        - 
        - Returns:
        -     Latest MarketTick or None
      - def get_metrics(.)
        - Kommentar: Get crypto stream metrics.
        - 
        - Returns:
        -     Dictionary with metrics
  - alpaca_stream.py
    - Class: AlpacaStreamClient
      - Kommentar: Real-time market data client for Alpaca using WebSocket.
      - def __init__(.)
        - Kommentar: Initialize Alpaca stream client.
        - 
        - Args:
        -     api_key: Alpaca API key
        -     api_secret: Alpaca API secret
        -     paper: Use paper trading (default: True)
        -     buffer_size: Size of the data buffer
        -     feed: Data feed type - 'iex' (free, 30 symbols) or 'sip' (premium)
      - def connect(.)
        - Kommentar: Connect to Alpaca WebSocket stream.
        - 
        - Returns:
        -     True if connection successful
      - def _run_stream(.)
        - Kommentar: Run the Alpaca stream with automatic reconnection.
      - def disconnect(.)
        - Kommentar: Disconnect from Alpaca stream.
      - def _stop_stream_sync(.)
        - Kommentar: Synchronous stream stop (runs in thread).
      - def subscribe(.)
        - Kommentar: Subscribe to symbols.
        - 
        - Args:
        -     symbols: List of symbols to subscribe to
      - def unsubscribe(.)
        - Kommentar: Unsubscribe from symbols.
        - 
        - Args:
        -     symbols: List of symbols to unsubscribe from
      - def _unsubscribe_sync(.)
        - Kommentar: Synchronous unsubscribe (runs in thread).
      - def _on_bar(.)
        - Kommentar: Handle bar (OHLCV) data.
        - 
        - Args:
        -     bar: Alpaca bar object
      - def _on_trade(.)
        - Kommentar: Handle trade data.
        - 
        - Args:
        -     trade: Alpaca trade object
      - def _on_quote(.)
        - Kommentar: Handle quote (bid/ask) data.
        - 
        - Args:
        -     quote: Alpaca quote object
      - def get_latest_tick(.)
        - Kommentar: Get the latest tick for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     Latest MarketTick or None
      - def get_latest_bar(.)
        - Kommentar: Get the latest bar from Alpaca REST API.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     Dictionary with bar data or None
      - def get_metrics(.)
        - Kommentar: Get stream metrics.
        - 
        - Returns:
        -     Dictionary with metrics
  - alpha_vantage_stream.py
    - Class: AlphaVantageStreamClient
      - Kommentar: Real-time market data client for Alpha Vantage using polling.
      - def __init__(.)
        - Kommentar: Initialize Alpha Vantage stream client.
        - 
        - Args:
        -     api_key: Alpha Vantage API key
        -     poll_interval: Polling interval in seconds (min 60 for free tier)
        -     buffer_size: Size of the data buffer
        -     enable_indicators: Enable real-time indicator calculations
      - def connect(.)
        - Kommentar: Start the polling loop.
        - 
        - Returns:
        -     True if connection successful
      - def disconnect(.)
        - Kommentar: Stop the polling loop.
      - def subscribe(.)
        - Kommentar: Subscribe to symbols.
        - 
        - Args:
        -     symbols: List of symbols to subscribe to
      - def unsubscribe(.)
        - Kommentar: Unsubscribe from symbols.
        - 
        - Args:
        -     symbols: List of symbols to unsubscribe from
      - def _poll_loop(.)
        - Kommentar: Main polling loop.
      - def _poll_symbol(.)
        - Kommentar: Poll data for a single symbol.
        - 
        - Args:
        -     symbol: Symbol to poll
      - def _fetch_global_quote(.)
        - Kommentar: Fetch global quote for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     MarketTick or None if failed
      - def _fetch_indicators(.)
        - Kommentar: Fetch technical indicators for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
      - def _fetch_rsi(.)
        - Kommentar: Fetch RSI indicator.
        - 
        - Args:
        -     symbol: Trading symbol
        -     interval: Time interval
        - 
        - Returns:
        -     Pandas Series with RSI values
      - def _fetch_macd(.)
        - Kommentar: Fetch MACD indicator.
        - 
        - Args:
        -     symbol: Trading symbol
        -     interval: Time interval
        - 
        - Returns:
        -     DataFrame with MACD values
      - def get_latest_tick(.)
        - Kommentar: Get the latest tick for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     Latest MarketTick or None
      - def get_metrics(.)
        - Kommentar: Get stream metrics.
        - 
        - Returns:
        -     Dictionary with metrics
  - history_provider.py
    - Class: HistoryManager
      - Kommentar: Manager for historical data with fallback support.
      - def __init__(.)
        - Kommentar: Initialize history manager.
        - 
        - Args:
        -     ibkr_adapter: Optional broker adapter for live IBKR data
      - def register_provider(.)
        - Kommentar: Register a data provider.
        - 
        - Args:
        -     source: Data source type
        -     provider: Provider instance
      - def set_ibkr_adapter(.)
        - Kommentar: Register or update the IBKR provider on-demand.
      - def _configure_priority(.)
        - Kommentar: Configure provider priority order from settings.
      - def _initialize_providers_from_config(.)
        - Kommentar: Register providers according to configuration and credentials.
      - def fetch_data(.)
        - Kommentar: Fetch historical data with fallback.
        - 
        - Args:
        -     request: Data request
        - 
        - Returns:
        -     Tuple of (bars, source_used)
      - def _store_to_database(.)
        - Kommentar: Store bars to database for caching.
      - def get_latest_price(.)
        - Kommentar: Get latest price for symbol.
      - def get_available_sources(.)
        - Kommentar: Get list of available data sources.
      - def start_realtime_stream(.)
        - Kommentar: Start real-time market data streaming.
      - def stop_realtime_stream(.)
        - Kommentar: Stop real-time market data streaming.
      - def start_crypto_realtime_stream(.)
        - Kommentar: Start real-time cryptocurrency market data streaming.
      - def stop_crypto_realtime_stream(.)
        - Kommentar: Stop real-time cryptocurrency market data streaming.
      - def get_realtime_tick(.)
        - Kommentar: Get latest real-time tick for a symbol.
      - def get_stream_metrics(.)
        - Kommentar: Get real-time stream metrics.
      - def fetch_realtime_indicators(.)
        - Kommentar: Fetch real-time technical indicators.
    - Kommentar: Import providers from new package
    - Kommentar: Re-export for backward compatibility
  - __init__.py
  - alpaca_stock_provider.py
    - Class: AlpacaProvider
      - Kommentar: Alpaca historical data provider for stocks.
      - def __init__(.)
        - Kommentar: Initialize Alpaca provider.
        - 
        - Args:
        -     api_key: Alpaca API key
        -     api_secret: Alpaca API secret
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from Alpaca.
        - 
        - Args:
        -     symbol: Trading symbol
        -     start_date: Start date for data
        -     end_date: End date for data
        -     timeframe: Bar timeframe
        - 
        - Returns:
        -     List of historical bars
      - def is_available(.)
        - Kommentar: Check if Alpaca is available.
      - def _timeframe_to_alpaca(.)
        - Kommentar: Convert timeframe to Alpaca format.
        - 
        - Args:
        -     timeframe: Internal timeframe
        - 
        - Returns:
        -     Alpaca TimeFrame object
      - def _check_sdk(.)
        - Kommentar: Check whether the Alpaca SDK is installed.
  - alpha_vantage_provider.py
    - Class: AlphaVantageProvider
      - Kommentar: Alpha Vantage historical data provider.
      - def __init__(.)
        - Kommentar: Initialize Alpha Vantage provider.
        - 
        - Args:
        -     api_key: Alpha Vantage API key
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from Alpha Vantage.
      - def is_available(.)
        - Kommentar: Check if Alpha Vantage is available.
      - def _timeframe_to_av(.)
        - Kommentar: Convert timeframe to Alpha Vantage format.
      - def fetch_technical_indicator(.)
        - Kommentar: Fetch technical indicator from Alpha Vantage.
      - def fetch_rsi(.)
        - Kommentar: Fetch RSI (Relative Strength Index) from Alpha Vantage.
      - def fetch_macd(.)
        - Kommentar: Fetch MACD from Alpha Vantage.
  - base.py
    - Class: HistoricalDataProvider
      - Kommentar: Abstract base class for historical data providers with template methods.
      - 
      - Provides common functionality for data providers:
      - - Caching support
      - - Data conversion helpers
      - - Rate limiting
      - - Template method pattern for fetch operation
      - 
      - Subclasses should implement:
      - - _fetch_data_from_source() - provider-specific data fetching
      - - is_available() - check provider availability
      - def __init__(.)
        - Kommentar: Initialize provider.
        - 
        - Args:
        -     name: Provider name
        -     enable_cache: Enable response caching
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars.
        - 
        - Args:
        -     symbol: Trading symbol
        -     start_date: Start date for data
        -     end_date: End date for data
        -     timeframe: Bar timeframe
        - 
        - Returns:
        -     List of historical bars
      - def is_available(.)
        - Kommentar: Check if provider is available.
        - 
        - Returns:
        -     True if provider is available
      - def fetch_bars_with_cache(.)
        - Kommentar: Fetch bars with caching support (template method).
        - 
        - This provides a standard fetch pattern:
        - 1. Check cache
        - 2. Fetch from source if not cached
        - 3. Convert to bars
        - 4. Cache results
        - 
        - Args:
        -     symbol: Trading symbol
        -     start_date: Start date
        -     end_date: End date
        -     timeframe: Timeframe
        - 
        - Returns:
        -     List of historical bars
      - def _fetch_data_from_source(.)
        - Kommentar: Fetch data from provider source.
        - 
        - Subclasses should implement this to provide provider-specific logic
        - when using the fetch_bars_with_cache template method.
        - 
        - Args:
        -     symbol: Trading symbol
        -     start_date: Start date
        -     end_date: End date
        -     timeframe: Timeframe
        - 
        - Returns:
        -     DataFrame with OHLCV data and timestamp index
        - 
        - Raises:
        -     NotImplementedError: If not implemented by subclass
      - def _cache_key(.)
        - Kommentar: Generate cache key.
        - 
        - Args:
        -     symbol: Trading symbol
        -     start_date: Start date
        -     end_date: End date
        -     timeframe: Timeframe
        - 
        - Returns:
        -     Cache key string
      - def _df_to_bars(.)
        - Kommentar: Convert DataFrame to HistoricalBar list.
        - 
        - Standard conversion method shared across all providers.
        - 
        - Args:
        -     df: DataFrame with OHLCV data and timestamp index
        - 
        - Returns:
        -     List of HistoricalBar objects
      - def _to_unix_timestamp(.)
        - Kommentar: Convert datetime to UTC UNIX timestamp.
        - 
        - Args:
        -     dt: Datetime to convert
        - 
        - Returns:
        -     UNIX timestamp as integer
      - def _clamp_date_range(.)
        - Kommentar: Clamp date range to provider limits.
        - 
        - Args:
        -     requested_start: Requested start date
        -     requested_end: Requested end date
        -     max_lookback_days: Maximum lookback in days (None for unlimited)
        - 
        - Returns:
        -     Tuple of (clamped_start, clamped_end)
  - database_provider.py
    - Class: DatabaseProvider
      - Kommentar: Database historical data provider (local cache).
      - def __init__(.)
        - Kommentar: Initialize database provider.
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from database.
      - def _fetch_bars_sync(.)
        - Kommentar: Synchronous database fetch (runs in thread).
      - def is_available(.)
        - Kommentar: Check if database is available.
      - def _resample_bars(.)
        - Kommentar: Resample bars to different timeframe.
  - finnhub_provider.py
    - Class: FinnhubProvider
      - Kommentar: Finnhub historical data provider.
      - def __init__(.)
        - Kommentar: Initialize Finnhub provider.
        - 
        - Args:
        -     api_key: Finnhub API key
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from Finnhub.
      - def is_available(.)
        - Kommentar: Check if Finnhub is available.
      - def _timeframe_to_finnhub(.)
        - Kommentar: Convert timeframe to Finnhub format.
  - ibkr_provider.py
    - Class: IBKRHistoricalProvider
      - Kommentar: IBKR historical data provider.
      - def __init__(.)
        - Kommentar: Initialize IBKR provider.
        - 
        - Args:
        -     ibkr_adapter: IBKR broker adapter instance
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from IBKR.
      - def is_available(.)
        - Kommentar: Check if IBKR is available.
      - def _calculate_duration(.)
        - Kommentar: Calculate IBKR duration string.
      - def _timeframe_to_ibkr(.)
        - Kommentar: Convert timeframe to IBKR format.
  - yahoo_provider.py
    - Class: YahooFinanceProvider
      - Kommentar: Yahoo Finance historical data provider.
      - def __init__(.)
      - def fetch_bars(.)
        - Kommentar: Fetch historical bars from Yahoo Finance.
      - def is_available(.)
        - Kommentar: Yahoo Finance is always available (no API key required).
      - def _timeframe_to_yahoo(.)
        - Kommentar: Convert timeframe enum to Yahoo Finance interval string.
      - def _to_unix(.)
        - Kommentar: Convert datetime to UTC UNIX timestamp.
      - def _clamp_date_range_yahoo(.)
        - Kommentar: Ensure Yahoo intraday requests stay within supported lookback windows.
      - def _get_lookback_limit(.)
        - Kommentar: Return maximum supported lookback window for a timeframe.
  - stream_client.py
    - Class: StreamStatus
      - Kommentar: Stream connection status.
    - Class: StreamMetrics
      - Kommentar: Metrics for stream performance.
      - def update_latency(.)
        - Kommentar: Update average latency.
    - Class: MarketTick
      - Kommentar: Market data tick.
    - Class: StreamClient
      - Kommentar: Base class for market data stream clients.
      - def __init__(.)
        - Kommentar: Initialize stream client.
        - 
        - Args:
        -     name: Client name
        -     buffer_size: Size of the data buffer
        -     heartbeat_interval: Heartbeat interval in seconds
        -     reconnect_attempts: Maximum reconnection attempts
        -     max_lag_ms: Maximum acceptable lag in milliseconds
      - def connect(.)
        - Kommentar: Connect to data stream.
      - def disconnect(.)
        - Kommentar: Disconnect from data stream.
      - def subscribe(.)
        - Kommentar: Subscribe to market data for symbols.
        - 
        - Args:
        -     symbols: List of symbols to subscribe to
        -     callback: Optional callback for data updates
      - def unsubscribe(.)
        - Kommentar: Unsubscribe from market data.
        - 
        - Args:
        -     symbols: List of symbols to unsubscribe from
      - def _handle_subscription(.)
        - Kommentar: Handle subscription request (override in subclass).
      - def _handle_unsubscription(.)
        - Kommentar: Handle unsubscription request (override in subclass).
      - def process_tick(.)
        - Kommentar: Process incoming market tick.
        - 
        - Args:
        -     tick: Market data tick
      - def _safe_callback(.)
        - Kommentar: Safely execute callback.
        - 
        - Args:
        -     callback: Callback function
        -     tick: Market tick data
      - def _heartbeat_loop(.)
        - Kommentar: Send periodic heartbeats to keep connection alive.
      - def _send_heartbeat(.)
        - Kommentar: Send heartbeat (override in subclass).
      - def _reconnect(.)
        - Kommentar: Reconnect with exponential backoff.
      - def _process_buffer(.)
        - Kommentar: Process buffered data in batches.
      - def _process_batch(.)
        - Kommentar: Process a batch of market ticks.
        - 
        - Args:
        -     batch: List of market ticks
      - def _tick_to_dict(.)
        - Kommentar: Convert tick to dictionary.
        - 
        - Args:
        -     tick: Market tick
        - 
        - Returns:
        -     Dictionary representation
      - def _store_ticks(.)
        - Kommentar: Store ticks in database.
        - 
        - Args:
        -     ticks: List of market ticks
      - def get_latest_tick(.)
        - Kommentar: Get latest tick for symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     Latest market tick or None
      - def get_metrics(.)
        - Kommentar: Get stream metrics.
        - 
        - Returns:
        -     Metrics dictionary
    - Class: IBKRStreamClient
      - Kommentar: IBKR-specific stream client implementation.
      - def __init__(.)
        - Kommentar: Initialize IBKR stream client.
        - 
        - Args:
        -     ibkr_client: IBKR API client instance
      - def connect(.)
        - Kommentar: Connect to IBKR data stream.
      - def _handle_subscription(.)
        - Kommentar: Handle subscription to IBKR market data.
      - def _get_next_req_id(.)
        - Kommentar: Get next request ID.
    - Class: TradeRepublicStreamClient
      - Kommentar: Trade Republic-specific stream client implementation.
      - def __init__(.)
        - Kommentar: Initialize Trade Republic stream client.
        - 
        - Args:
        -     ws_connection: WebSocket connection
      - def connect(.)
        - Kommentar: Connect to Trade Republic data stream.
      - def _listen(.)
        - Kommentar: Listen for WebSocket messages.
      - def _handle_message(.)
        - Kommentar: Handle incoming WebSocket message.
      - def _handle_subscription(.)
        - Kommentar: Handle subscription to Trade Republic market data.
      - def _send_heartbeat(.)
        - Kommentar: Send heartbeat to Trade Republic.
  - types.py
    - Class: AssetClass
      - Kommentar: Asset class types supported by the platform.
    - Class: DataSource
      - Kommentar: Available data sources.
    - Class: Timeframe
      - Kommentar: Market data timeframes.
    - Class: HistoricalBar
      - Kommentar: Historical market bar data.
    - Class: DataRequest
      - Kommentar: Request for historical data.
  - __init__.py
  - backtest_models.py
    - Class: TradeSide
      - Kommentar: Trade direction.
    - Class: Bar
      - Kommentar: OHLCV bar data.
      - 
      - Represents a single candlestick/bar with price and volume information.
    - Class: Trade
      - Kommentar: Represents a completed or active trade.
      - 
      - Captures all relevant information about a trade including entry/exit,
      - P&L, risk management levels, and reasoning.
      - def duration(.)
        - Kommentar: Trade duration in seconds.
      - def r_multiple(.)
        - Kommentar: Risk-reward multiple (R-multiple).
        - 
        - Returns how many times the initial risk was gained/lost.
      - def is_winner(.)
        - Kommentar: Check if trade was profitable.
    - Class: EquityPoint
      - Kommentar: Point on the equity curve.
      - 
      - Represents account equity at a specific point in time.
    - Class: BacktestMetrics
      - Kommentar: Comprehensive backtest performance metrics.
      - 
      - Provides statistical analysis of backtest results including
      - profitability, risk, and trading efficiency metrics.
      - def recovery_factor(.)
        - Kommentar: Recovery factor: Net profit / Max drawdown.
    - Class: BacktestResult
      - Kommentar: Complete backtest result with all data and metrics.
      - 
      - Consolidates all information from a backtest run including market data,
      - trades, equity curve, indicators, and performance metrics.
      - def duration_days(.)
        - Kommentar: Backtest duration in days.
      - def total_pnl(.)
        - Kommentar: Total profit/loss.
      - def total_pnl_pct(.)
        - Kommentar: Total return percentage.
    - def from_historical_bar(.)
      - Kommentar: Convert HistoricalBar (from market_data.types) to Bar.
      - 
      - Args:
      -     bar: HistoricalBar instance from history provider
      -     symbol: Optional symbol override
      - 
      - Returns:
      -     Bar instance
    - def to_historical_bars(.)
      - Kommentar: Convert Bar list to HistoricalBar list.
      - 
      - Args:
      -     bars: List of Bar instances
      -     symbol: Symbol for the bars
      - 
      - Returns:
      -     List of HistoricalBar instances
  - __init__.py
  - embedder.py
    - Class: PatternEmbedder
      - Kommentar: Converts trading patterns to vector embeddings.
      - 
      - Uses a combination of:
      - 1. Flattened normalized OHLC data (captures pattern shape)
      - 2. Statistical features (volatility, trend, momentum)
      - 3. Volume features
      - 
      - Total vector dimension = window_size * 4 + num_features
      - For window_size=20: 20*4 + 16 = 96 dimensions
      - def __init__(.)
        - Kommentar: Initialize embedder.
        - 
        - Args:
        -     window_size: Expected window size of patterns
        -     include_volume: Whether to include volume features
      - def embed(.)
        - Kommentar: Convert pattern to vector embedding.
        - 
        - Args:
        -     pattern: Pattern object
        - 
        - Returns:
        -     Vector embedding of shape (embedding_dim,)
      - def _extract_features(.)
        - Kommentar: Extract statistical features from pattern.
        - 
        - Args:
        -     pattern: Pattern object
        - 
        - Returns:
        -     Feature vector of shape (num_features,)
      - def embed_batch(.)
        - Kommentar: Embed multiple patterns.
        - 
        - Args:
        -     patterns: List of Pattern objects
        - 
        - Returns:
        -     Array of shape (n_patterns, embedding_dim)
      - def get_embedding_dim(.)
        - Kommentar: Get embedding dimension.
        - 
        - Returns:
        -     Embedding dimension
  - extractor.py
    - Class: Pattern
      - Kommentar: A trading pattern extracted from OHLC data.
      - def to_dict(.)
        - Kommentar: Convert pattern to dictionary for storage.
    - Class: PatternExtractor
      - Kommentar: Extracts trading patterns from OHLC data using sliding windows.
      - def __init__(.)
        - Kommentar: Initialize pattern extractor.
        - 
        - Args:
        -     window_size: Number of bars per pattern (default: 20 = ~20 min for 1Min data)
        -     step_size: Step between windows (1 = every bar, 5 = every 5th bar)
        -     outcome_bars: Bars forward to measure outcome
        -     min_volatility: Minimum volatility to include pattern
      - def extract_patterns(.)
        - Kommentar: Extract patterns from a list of bars.
        - 
        - Args:
        -     bars: List of historical bars
        -     symbol: Trading symbol
        -     timeframe: Timeframe string (e.g., "1Min")
        - 
        - Yields:
        -     Pattern objects
      - def _create_pattern(.)
        - Kommentar: Create a pattern from window bars.
        - 
        - Args:
        -     window_bars: Bars in the pattern window
        -     outcome_bars: Bars after the window for outcome measurement
        -     symbol: Trading symbol
        -     timeframe: Timeframe string
        - 
        - Returns:
        -     Pattern object or None if invalid
      - def extract_current_pattern(.)
        - Kommentar: Extract the most recent pattern (for live matching).
        - 
        - Args:
        -     bars: Recent bars (at least window_size)
        -     symbol: Trading symbol
        -     timeframe: Timeframe string
        - 
        - Returns:
        -     Most recent pattern or None
  - fetcher.py
    - Class: FetchConfig
      - Kommentar: Configuration for data fetching.
    - Class: PatternDataFetcher
      - Kommentar: Fetches historical data for pattern database construction.
      - def __init__(.)
        - Kommentar: Initialize the fetcher.
      - def _ensure_initialized(.)
        - Kommentar: Ensure history manager is initialized.
      - def get_default_stock_config(.)
        - Kommentar: Get default config for NASDAQ-100 stocks.
        - 
        - Args:
        -     days_back: Number of days of historical data
        - 
        - Returns:
        -     FetchConfig for stocks
      - def get_default_crypto_config(.)
        - Kommentar: Get default config for crypto (BTC, ETH).
        - 
        - Args:
        -     days_back: Number of days of historical data
        - 
        - Returns:
        -     FetchConfig for crypto
      - def fetch_symbol_data(.)
        - Kommentar: Fetch historical data for a single symbol.
        - 
        - Args:
        -     symbol: Trading symbol (e.g., "AAPL" or "BTC/USD")
        -     timeframe: Bar timeframe
        -     days_back: Number of days of historical data
        -     asset_class: Asset class (STOCK or CRYPTO)
        - 
        - Returns:
        -     List of historical bars
      - def fetch_batch(.)
        - Kommentar: Fetch data for multiple symbols with progress tracking.
        - 
        - Args:
        -     config: Fetch configuration
        -     progress_callback: Optional callback(symbol, timeframe, bars_count)
        - 
        - Yields:
        -     Tuple of (symbol, timeframe, bars)
      - def fetch_all(.)
        - Kommentar: Fetch all data according to config.
        - 
        - Args:
        -     config: Fetch configuration
        -     progress_callback: Optional callback(symbol, timeframe, bars_count, completed, total)
        - 
        - Returns:
        -     Dict mapping symbol -> timeframe -> bars
    - def fetch_daytrading_data(.)
      - Kommentar: Fetch all daytrading data for pattern database.
      - 
      - Args:
      -     include_stocks: Include NASDAQ-100 stocks
      -     include_crypto: Include BTC/ETH
      -     days_back: Days of historical data
      -     progress_callback: Progress callback
      - 
      - Returns:
      -     Combined data dict
    - Kommentar: NASDAQ-100 symbols (top components by weight)
    - Kommentar: Crypto symbols for Alpaca
    - Kommentar: Daytrading timeframes
  - pattern_service.py
    - Class: PatternAnalysis
      - Kommentar: Analysis result from pattern matching.
    - Class: PatternService
      - Kommentar: Service for pattern-based signal validation.
      - 
      - Integrates with the trading bot to validate entry signals
      - by comparing current patterns with historical outcomes.
      - def __init__(.)
        - Kommentar: Initialize pattern service.
        - 
        - Args:
        -     window_size: Pattern window size
        -     min_similar_patterns: Minimum patterns needed for valid analysis
        -     min_win_rate_boost: Win rate threshold for positive boost
        -     similarity_threshold: Minimum similarity score for matches
      - def initialize(.)
        - Kommentar: Initialize the service (connect to Qdrant).
        - 
        - Returns:
        -     True if successful
      - def analyze_signal(.)
        - Kommentar: Analyze a trading signal using pattern matching.
        - 
        - Args:
        -     bars: Recent bars (at least window_size)
        -     symbol: Trading symbol
        -     timeframe: Timeframe string
        -     signal_direction: Expected trade direction
        -     cross_symbol_search: Search across all symbols (recommended)
        - 
        - Returns:
        -     PatternAnalysis or None if not enough data
      - def _calculate_analysis(.)
        - Kommentar: Calculate analysis from matched patterns.
        - 
        - Args:
        -     matches: Similar pattern matches
        -     stats: Statistics from matches
        -     signal_direction: Expected trade direction
        -     current_pattern: Current pattern
        - 
        - Returns:
        -     PatternAnalysis object
      - def get_quick_validation(.)
        - Kommentar: Quick validation returning just boost and recommendation.
        - 
        - Args:
        -     bars: Recent bars
        -     symbol: Trading symbol
        -     timeframe: Timeframe string
        -     signal_direction: Expected trade direction
        - 
        - Returns:
        -     Tuple of (signal_boost, recommendation)
    - def get_pattern_service(.)
      - Kommentar: Get or create the global pattern service instance.
      - 
      - Returns:
      -     Initialized PatternService
    - Kommentar: Global service instance
  - qdrant_client.py
    - Class: PatternMatch
      - Kommentar: A matched pattern from similarity search.
    - Class: TradingPatternDB
      - Kommentar: Qdrant-based trading pattern database.
      - 
      - Stores patterns as vectors for similarity search.
      - Uses Docker Qdrant instance on localhost:6333.
      - def __init__(.)
        - Kommentar: Initialize Qdrant client.
        - 
        - Args:
        -     host: Qdrant host (default: localhost for Docker)
        -     port: Qdrant port (default: 6333)
        -     collection_name: Name of the collection
        -     embedding_dim: Vector embedding dimension
      - def _get_client(.)
        - Kommentar: Get or create Qdrant client.
      - def initialize(.)
        - Kommentar: Initialize the collection if it doesn't exist.
        - 
        - Returns:
        -     True if successful
      - def insert_pattern(.)
        - Kommentar: Insert a single pattern into the database.
        - 
        - Args:
        -     pattern: Pattern to insert
        - 
        - Returns:
        -     Pattern ID
      - def insert_patterns_batch(.)
        - Kommentar: Insert multiple patterns in batches.
        - 
        - Args:
        -     patterns: List of patterns to insert
        -     batch_size: Number of patterns per batch
        -     progress_callback: Optional callback(inserted, total)
        - 
        - Returns:
        -     Number of patterns inserted
      - def search_similar(.)
        - Kommentar: Search for similar patterns.
        - 
        - Args:
        -     pattern: Query pattern
        -     limit: Max results to return
        -     symbol_filter: Filter by symbol (optional)
        -     timeframe_filter: Filter by timeframe (optional)
        -     trend_filter: Filter by trend direction (optional)
        -     outcome_filter: Filter by outcome label (optional)
        -     score_threshold: Minimum similarity score
        - 
        - Returns:
        -     List of matched patterns
      - def get_pattern_statistics(.)
        - Kommentar: Calculate statistics from matched patterns.
        - 
        - Args:
        -     matches: List of pattern matches
        - 
        - Returns:
        -     Statistics dict with win rate, avg return, etc.
      - def get_collection_info(.)
        - Kommentar: Get information about the collection.
        - 
        - Returns:
        -     Collection info dict
      - def delete_collection(.)
        - Kommentar: Delete the entire collection.
        - 
        - Returns:
        -     True if successful
    - Kommentar: Qdrant configuration for Docker
  - __init__.py
    - Kommentar: Enums
    - Kommentar: Models
    - Kommentar: Type Aliases
    - Kommentar: Compiler
  - compiled_strategy.py
    - Class: CompiledStrategy
      - Kommentar: Dynamically compiled strategy from StrategyDefinition.
      - def __init__(.)
        - Kommentar: Initialize strategy with definition.
        - 
        - Args:
        -     definition: Strategy definition containing rules and indicators
      - def _setup_indicators(.)
        - Kommentar: Create and setup all indicators.
      - def _setup_evaluators(.)
        - Kommentar: Setup condition evaluators for entry/exit signals.
      - def _setup_risk_management(.)
        - Kommentar: Setup risk management configuration.
      - def next(.)
        - Kommentar: Execute strategy logic on each bar.
      - def _check_entry_signals(.)
        - Kommentar: Check for entry signals when no position exists.
      - def _check_exit_signals(.)
        - Kommentar: Check for exit signals when position exists.
      - def _enter_long(.)
        - Kommentar: Enter long position.
      - def _enter_short(.)
        - Kommentar: Enter short position.
      - def _exit_position(.)
        - Kommentar: Exit current position.
      - def _check_risk_management(.)
        - Kommentar: Check stop loss and take profit conditions.
      - def _calculate_pnl_percentage(.)
        - Kommentar: Calculate P&L percentage based on position direction.
      - def _check_stop_loss(.)
        - Kommentar: Check stop loss conditions. Returns True if position was closed.
      - def _check_take_profit(.)
        - Kommentar: Check take profit conditions.
      - def notify_order(.)
        - Kommentar: Handle order notifications.
  - compiler.py
    - Class: CompilationError
      - Kommentar: Exception raised when strategy compilation fails.
    - Class: IndicatorFactory
      - Kommentar: Factory for creating Backtrader indicators from IndicatorConfig.
      - 
      - Maps IndicatorType enum to Backtrader indicator classes.
      - def create_indicator(.)
        - Kommentar: Create Backtrader indicator from configuration.
        - 
        - Args:
        -     config: Indicator configuration
        -     data: Backtrader data feed
        - 
        - Returns:
        -     Instantiated Backtrader indicator
        - 
        - Raises:
        -     CompilationError: If indicator type is not supported
      - def _normalize_params(.)
        - Kommentar: Normalize parameter names for different indicators.
        - 
        - Args:
        -     indicator_type: Type of indicator
        -     params: Raw parameters from config
        - 
        - Returns:
        -     Normalized parameters for Backtrader
    - Class: ConditionEvaluator
      - Kommentar: Evaluates Condition and LogicGroup expressions.
      - 
      - Recursively evaluates nested logic groups and handles special operators
      - like crosses_above, crosses_below, inside, outside.
      - def __init__(.)
        - Kommentar: Initialize evaluator.
        - 
        - Args:
        -     strategy: Backtrader strategy instance (for accessing indicators)
      - def evaluate(.)
        - Kommentar: Evaluate condition or logic group.
        - 
        - Args:
        -     logic: Condition or LogicGroup to evaluate
        - 
        - Returns:
        -     Boolean result of evaluation
      - def _evaluate_condition(.)
        - Kommentar: Evaluate a single condition.
        - 
        - Args:
        -     cond: Condition to evaluate
        - 
        - Returns:
        -     Boolean result
      - def _evaluate_logic_group(.)
        - Kommentar: Evaluate a logic group (AND, OR, NOT).
        - 
        - Args:
        -     group: LogicGroup to evaluate
        - 
        - Returns:
        -     Boolean result
      - def _resolve_operand(.)
        - Kommentar: Resolve operand to a numeric value.
        - 
        - Args:
        -     operand: Indicator alias or numeric literal
        - 
        - Returns:
        -     Numeric value
        - 
        - Raises:
        -     CompilationError: If operand cannot be resolved
      - def _check_cross_above(.)
        - Kommentar: Check if left crossed above right.
        - 
        - Args:
        -     key: Unique key for tracking (usually left operand)
        -     current_left: Current left value
        -     current_right: Current right value
        - 
        - Returns:
        -     True if crossed above, False otherwise
      - def _check_cross_below(.)
        - Kommentar: Check if left crossed below right.
        - 
        - Args:
        -     key: Unique key for tracking (usually left operand)
        -     current_left: Current left value
        -     current_right: Current right value
        - 
        - Returns:
        -     True if crossed below, False otherwise
    - Class: StrategyCompiler
      - Kommentar: Compiles StrategyDefinition into executable Backtrader strategies.
      - 
      - Creates a dynamic Backtrader Strategy class at runtime based on the
      - declarative strategy definition.
      - 
      - Example:
      -     >>> compiler = StrategyCompiler()
      -     >>> strategy_class = compiler.compile(strategy_definition)
      -     >>> cerebro.addstrategy(strategy_class)
      - def compile(.)
        - Kommentar: Compile strategy definition to Backtrader Strategy class.
        - 
        - Args:
        -     definition: Validated strategy definition
        - 
        - Returns:
        -     Backtrader Strategy class (not instance)
        - 
        - Raises:
        -     CompilationError: If compilation fails
      - def _create_strategy_class(.)
        - Kommentar: Create dynamic Backtrader Strategy class.
        - 
        - Args:
        -     definition: Strategy definition
        - 
        - Returns:
        -     Strategy class configured with definition
  - definition.py
    - Class: IndicatorType
      - Kommentar: Supported technical indicator types.
    - Class: ComparisonOperator
      - Kommentar: Comparison operators for conditions.
    - Class: LogicOperator
      - Kommentar: Logic operators for combining conditions.
    - Class: IndicatorConfig
      - Kommentar: Configuration for a technical indicator.
      - 
      - Attributes:
      -     type: Indicator type (SMA, RSI, MACD, etc.)
      -     params: Indicator-specific parameters (e.g., period, deviation)
      -     alias: Unique identifier for referencing in conditions
      -     source: Data source field (default: "close")
      -     plot: Whether to plot this indicator in charts
      - 
      - Example:
      -     >>> IndicatorConfig(
      -     ...     type="SMA",
      -     ...     params={"period": 20},
      -     ...     alias="sma_fast",
      -     ...     source="close"
      -     ... )
      - def validate_alias(.)
        - Kommentar: Validate alias format (alphanumeric + underscore).
    - Class: Condition
      - Kommentar: Single condition for strategy logic.
      - 
      - Attributes:
      -     type: Discriminator field (always "condition")
      -     left: Left operand (indicator alias or numeric value)
      -     operator: Comparison operator
      -     right: Right operand (indicator alias or numeric value)
      -     description: Optional human-readable description
      - 
      - Example:
      -     >>> Condition(
      -     ...     left="sma_fast",
      -     ...     operator="crosses_above",
      -     ...     right="sma_slow",
      -     ...     description="Fast SMA crosses above slow SMA"
      -     ... )
      - def validate_range_operators(.)
        - Kommentar: Validate that range operators have list[float] as right operand.
    - Class: LogicGroup
      - Kommentar: Group of conditions combined with logic operators.
      - 
      - Supports recursive nesting for complex logic like:
      - (A AND B) OR (C AND D)
      - 
      - Attributes:
      -     type: Discriminator field (always "group")
      -     operator: Logic operator (AND, OR, NOT)
      -     conditions: List of conditions or nested logic groups
      -     description: Optional human-readable description
      - 
      - Example:
      -     >>> LogicGroup(
      -     ...     operator="AND",
      -     ...     conditions=[
      -     ...         Condition(left="rsi", operator="<", right=30),
      -     ...         Condition(left="sma_fast", operator=">", right="sma_slow")
      -     ...     ],
      -     ...     description="RSI oversold AND bullish crossover"
      -     ... )
      - def validate_conditions_not_empty(.)
        - Kommentar: Validate that conditions list is not empty.
      - def validate_not_operator(.)
        - Kommentar: Validate that NOT operator has exactly one condition.
    - Class: RiskManagement
      - Kommentar: Risk management parameters for the strategy.
      - 
      - Attributes:
      -     stop_loss_pct: Stop loss as percentage of entry price
      -     take_profit_pct: Take profit as percentage of entry price
      -     stop_loss_atr: Stop loss as multiple of ATR
      -     take_profit_atr: Take profit as multiple of ATR
      -     trailing_stop_pct: Trailing stop as percentage
      -     max_position_size_pct: Max position size as % of capital
      -     max_risk_per_trade_pct: Max risk per trade as % of capital
      - 
      - Example:
      -     >>> RiskManagement(
      -     ...     stop_loss_pct=2.0,
      -     ...     take_profit_pct=5.0,
      -     ...     max_risk_per_trade_pct=1.0
      -     ... )
      - def validate_stop_loss_methods(.)
        - Kommentar: Validate that only one stop loss method is used.
      - def validate_take_profit_methods(.)
        - Kommentar: Validate that only one take profit method is used.
    - Class: StrategyDefinition
      - Kommentar: Complete trading strategy definition.
      - 
      - Attributes:
      -     name: Strategy name
      -     version: Strategy version (semantic versioning)
      -     description: Strategy description
      -     indicators: List of indicator configurations
      -     entry_long: Entry condition for long positions
      -     exit_long: Exit condition for long positions
      -     entry_short: Entry condition for short positions (optional)
      -     exit_short: Exit condition for short positions (optional)
      -     risk_management: Risk management parameters
      -     meta: Additional metadata (tags, author, etc.)
      - 
      - Example:
      -     >>> strategy = StrategyDefinition(
      -     ...     name="SMA Crossover",
      -     ...     version="1.0.0",
      -     ...     indicators=[
      -     ...         IndicatorConfig(type="SMA", params={"period": 20}, alias="sma_fast"),
      -     ...         IndicatorConfig(type="SMA", params={"period": 50}, alias="sma_slow")
      -     ...     ],
      -     ...     entry_long=Condition(
      -     ...         left="sma_fast", operator="crosses_above", right="sma_slow"
      -     ...     ),
      -     ...     exit_long=Condition(
      -     ...         left="sma_fast", operator="crosses_below", right="sma_slow"
      -     ...     ),
      -     ...     risk_management=RiskManagement(
      -     ...         stop_loss_pct=2.0,
      -     ...         take_profit_pct=5.0
      -     ...     )
      -     ... )
      - def validate_unique_aliases(.)
        - Kommentar: Validate that all indicator aliases are unique.
      - def validate_condition_references(.)
        - Kommentar: Validate that all condition references point to valid indicators.
      - def get_indicator_by_alias(.)
        - Kommentar: Get indicator configuration by alias.
        - 
        - Args:
        -     alias: Indicator alias
        - 
        - Returns:
        -     IndicatorConfig or None if not found
      - def to_yaml(.)
        - Kommentar: Export strategy definition as YAML string.
        - 
        - Returns:
        -     YAML representation of the strategy
      - def from_yaml(.)
        - Kommentar: Load strategy definition from YAML string.
        - 
        - Args:
        -     yaml_str: YAML string
        - 
        - Returns:
        -     StrategyDefinition instance
      - def to_json_file(.)
        - Kommentar: Save strategy definition to JSON file.
        - 
        - Args:
        -     filepath: Path to JSON file
      - def from_json_file(.)
        - Kommentar: Load strategy definition from JSON file.
        - 
        - Args:
        -     filepath: Path to JSON file
        - 
        - Returns:
        -     StrategyDefinition instance
    - def _get_condition_type(.)
      - Kommentar: Get discriminator value for Condition | LogicGroup union.
    - Kommentar: Type alias for entry/exit logic with discriminator
    - Kommentar: Type aliases for convenience
  - engine.py
    - Class: SignalType
      - Kommentar: Types of trading signals.
    - Class: StrategyType
      - Kommentar: Types of trading strategies.
    - Class: Signal
      - Kommentar: Trading signal generated by strategy.
    - Class: StrategyConfig
      - Kommentar: Configuration for a trading strategy.
    - Class: StrategyState
      - Kommentar: Current state of a strategy.
    - Class: BaseStrategy
      - Kommentar: Abstract base class for trading strategies.
      - def __init__(.)
        - Kommentar: Initialize strategy.
        - 
        - Args:
        -     config: Strategy configuration
        -     indicator_engine: Indicator calculation engine
      - def evaluate(.)
        - Kommentar: Evaluate strategy and generate signal.
        - 
        - Args:
        -     data: Market data (OHLCV)
        - 
        - Returns:
        -     Trading signal or None
      - def update_position(.)
        - Kommentar: Update position tracking.
        - 
        - Args:
        -     symbol: Trading symbol
        -     quantity: Position quantity (negative for short)
      - def get_position(.)
        - Kommentar: Get current position.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     Position quantity (0 if no position)
      - def has_position(.)
        - Kommentar: Check if strategy has position.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     True if has position
      - def calculate_position_size(.)
        - Kommentar: Calculate position size.
        - 
        - Args:
        -     symbol: Trading symbol
        -     signal_confidence: Signal confidence (0-1)
        -     account_equity: Total account equity
        -     current_price: Current price
        - 
        - Returns:
        -     Position size in shares
    - Class: StrategyEngine
      - Kommentar: Engine for managing multiple trading strategies.
      - def __init__(.)
        - Kommentar: Initialize strategy engine.
      - def create_strategy(.)
        - Kommentar: Create a strategy instance.
        - 
        - Args:
        -     config: Strategy configuration
        - 
        - Returns:
        -     Strategy instance
      - def enable_strategy(.)
        - Kommentar: Enable a strategy.
        - 
        - Args:
        -     name: Strategy name
      - def disable_strategy(.)
        - Kommentar: Disable a strategy.
        - 
        - Args:
        -     name: Strategy name
      - def evaluate_all(.)
        - Kommentar: Evaluate all active strategies.
        - 
        - Args:
        -     market_data: Market data by symbol
        - 
        - Returns:
        -     List of generated signals
      - def combine_signals(.)
        - Kommentar: Combine multiple signals into consensus.
        - 
        - Args:
        -     signals: List of signals
        - 
        - Returns:
        -     Combined signal or None
      - def get_strategy_stats(.)
        - Kommentar: Get strategy statistics.
        - 
        - Args:
        -     name: Strategy name
        - 
        - Returns:
        -     Strategy statistics
      - def signal_to_order(.)
        - Kommentar: Convert signal to order request.
        - 
        - Args:
        -     signal: Trading signal
        - 
        - Returns:
        -     Order request
  - evaluation.py
    - Class: ConditionEvaluator
      - Kommentar: Evaluates trading strategy conditions.
      - def __init__(.)
        - Kommentar: Initialize evaluator with strategy context.
        - 
        - Args:
        -     strategy: Backtrader strategy instance
      - def evaluate(.)
        - Kommentar: Evaluate a condition.
        - 
        - Args:
        -     condition: Condition to evaluate
        - 
        - Returns:
        -     Boolean result of evaluation
        - 
        - Raises:
        -     CompilationError: If evaluation fails
      - def _evaluate_comparison(.)
        - Kommentar: Evaluate a comparison condition.
        - 
        - Args:
        -     cond: Comparison condition to evaluate
        - 
        - Returns:
        -     Boolean result
      - def _apply_comparison_operator(.)
        - Kommentar: Apply comparison operator to values.
      - def _evaluate_logic_group(.)
        - Kommentar: Evaluate a logic group (AND, OR, NOT).
        - 
        - Args:
        -     group: LogicGroup to evaluate
        - 
        - Returns:
        -     Boolean result
      - def _resolve_operand(.)
        - Kommentar: Resolve operand to a numeric value.
        - 
        - Args:
        -     operand: Indicator alias or numeric literal
        - 
        - Returns:
        -     Numeric value
        - 
        - Raises:
        -     CompilationError: If operand cannot be resolved
      - def _is_numeric_string(.)
        - Kommentar: Check if string represents a number.
      - def _resolve_data_field(.)
        - Kommentar: Resolve data field (close, open, high, low, volume).
      - def _resolve_indicator(.)
        - Kommentar: Resolve indicator value by alias.
      - def _check_cross_above(.)
        - Kommentar: Check if operand crossed above threshold.
        - 
        - Args:
        -     operand: Operand key for tracking
        -     current_value: Current value
        -     threshold: Threshold value
        - 
        - Returns:
        -     True if crossed above
      - def _check_cross_below(.)
        - Kommentar: Check if operand crossed below threshold.
        - 
        - Args:
        -     operand: Operand key for tracking
        -     current_value: Current value
        -     threshold: Threshold value
        - 
        - Returns:
        -     True if crossed below
      - def _get_previous_value(.)
        - Kommentar: Get previous value for operand.
      - def _update_previous_value(.)
        - Kommentar: Update previous value for operand.
  - __init__.py
  - breakout.py
    - Class: BreakoutStrategy
      - Kommentar: Breakout strategy using support/resistance and volume.
      - def evaluate(.)
        - Kommentar: Evaluate breakout strategy.
  - mean_reversion.py
    - Class: MeanReversionStrategy
      - Kommentar: Mean reversion strategy using Bollinger Bands.
      - def evaluate(.)
        - Kommentar: Evaluate mean reversion strategy.
  - momentum.py
    - Class: MomentumStrategy
      - Kommentar: Momentum strategy using rate of change and volume.
      - def evaluate(.)
        - Kommentar: Evaluate momentum strategy.
  - scalping.py
    - Class: ScalpingStrategy
      - Kommentar: High-frequency scalping strategy.
      - def evaluate(.)
        - Kommentar: Evaluate scalping strategy.
  - trend_following.py
    - Class: TrendFollowingStrategy
      - Kommentar: Trend following strategy using moving averages.
      - def evaluate(.)
        - Kommentar: Evaluate trend following strategy.
  - __init__.py
    - Kommentar: Backtest types from backtest_types.py
    - Kommentar: Backtest simulator from backtest_simulator.py
    - Kommentar: Backtest harness from backtest_harness.py
    - Kommentar: Config
    - Kommentar: Engines
    - Kommentar: Filters
    - Kommentar: Models
    - Kommentar: State Machine
    - Kommentar: Strategy Catalog
    - Kommentar: Strategy Evaluator
    - Kommentar: Strategy Selector
    - Kommentar: Entry/Exit Engine
    - Kommentar: Execution Layer
    - Kommentar: LLM Integration
    - Kommentar: Backtest & QA
  - backtest_harness.py
    - Class: BacktestHarness
      - Kommentar: Main backtest harness for tradingbot.
      - 
      - Runs event-by-event backtests with full bot simulation.
      - def __init__(.)
        - Kommentar: Initialize backtest harness.
        - 
        - Args:
        -     bot_config: Bot configuration
        -     backtest_config: Backtest configuration
        -     data_provider: Function to fetch historical data
      - def _init_bot_components(.)
        - Kommentar: Initialize bot components.
      - def load_data(.)
        - Kommentar: Load historical data for backtest.
        - 
        - Returns:
        -     DataFrame with OHLCV data
      - def run(.)
        - Kommentar: Run the backtest.
        - 
        - Returns:
        -     BacktestResult with all metrics and trades
      - def _process_bar(.)
        - Kommentar: Process a single bar.
        - 
        - Args:
        -     bar_idx: Bar index in data
      - def _process_flat_state(.)
        - Kommentar: Process bar in FLAT state (look for entries).
      - def _process_signal_state(.)
        - Kommentar: Process bar in SIGNAL state (confirm or expire).
      - def _process_manage_state(.)
        - Kommentar: Process bar in MANAGE state (trailing stop, exit signals).
      - def _execute_entry(.)
        - Kommentar: Execute entry order.
        - 
        - Args:
        -     signal: Entry signal
        -     features: Current features
      - def _close_position(.)
        - Kommentar: Close current position.
        - 
        - Args:
        -     reason: Exit reason
        -     exit_price: Exit price (uses current close if None)
      - def _calculate_initial_stop(.)
        - Kommentar: Calculate initial stop-loss price.
        - 
        - Args:
        -     features: Current features
        -     side: Trade side
        -     regime: Current regime
        - 
        - Returns:
        -     Stop-loss price
      - def _calculate_equity(.)
        - Kommentar: Calculate current equity.
        - 
        - Returns:
        -     Current equity value
      - def _calculate_metrics(.)
        - Kommentar: Calculate performance metrics from trades.
  - backtest_metrics_helpers.py
    - def convert_trades_to_results(.)
      - Kommentar: Convert BacktestTrade objects to TradeResult objects.
      - 
      - Args:
      -     trades: List of backtest trades
      - 
      - Returns:
      -     List of TradeResult objects
    - def calculate_backtest_metrics(.)
      - Kommentar: Calculate performance metrics from backtest trades.
      - 
      - Args:
      -     trades: List of backtest trades
      - 
      - Returns:
      -     PerformanceMetrics calculated from trades
  - backtest_simulator.py
    - Class: BacktestSimulator
      - Kommentar: Simulates order execution during backtest.
      - 
      - Provides deterministic slippage and fill simulation.
      - def __init__(.)
        - Kommentar: Initialize simulator.
        - 
        - Args:
        -     slippage_pct: Slippage percentage
        -     commission_pct: Commission per side
        -     seed: Random seed
      - def simulate_fill(.)
        - Kommentar: Simulate order fill with slippage.
        - 
        - Args:
        -     side: Order side
        -     quantity: Order quantity
        -     price: Expected price
        -     bar_high: Bar high price
        -     bar_low: Bar low price
        - 
        - Returns:
        -     (fill_price, slippage_amount, commission)
      - def generate_order_id(.)
        - Kommentar: Generate unique order ID.
    - Class: ReleaseGate
      - Kommentar: Release gate checker for Paper → Live transition.
      - 
      - Validates that backtest/paper results meet minimum criteria.
      - def __init__(.)
        - Kommentar: Initialize release gate.
        - 
        - Args:
        -     min_trades: Minimum number of trades
        -     min_win_rate: Minimum win rate
        -     min_profit_factor: Minimum profit factor
        -     max_drawdown_pct: Maximum drawdown percentage
        -     min_sharpe: Minimum Sharpe ratio
        -     min_paper_days: Minimum days of paper trading
        -     max_consecutive_losses: Maximum consecutive losses
      - def check(.)
        - Kommentar: Check if result passes release gate.
        - 
        - Args:
        -     result: Backtest or paper trading result
        - 
        - Returns:
        -     (passed, list of failure reasons)
      - def _calculate_max_consecutive_losses(.)
        - Kommentar: Calculate maximum consecutive losses.
        - 
        - Args:
        -     trades: List of trades
        - 
        - Returns:
        -     Maximum consecutive loss count
  - backtest_types.py
    - Class: BacktestMode
      - Kommentar: Backtest execution modes.
    - Class: BacktestConfig
      - Kommentar: Configuration for backtest run.
      - def get_seed(.)
        - Kommentar: Get deterministic seed based on config.
    - Class: BacktestTrade
      - Kommentar: Record of a completed trade.
      - def to_dict(.)
        - Kommentar: Convert to dict for serialization.
    - Class: BacktestState
      - Kommentar: State tracking during backtest.
    - Class: BacktestResult
      - Kommentar: Result of a backtest run.
      - def to_dict(.)
        - Kommentar: Convert to dict for serialization.
      - def save(.)
        - Kommentar: Save result to JSON file.
  - bot_controller.py
    - Class: BotController
      - Kommentar: Main trading bot controller.
      - 
      - Orchestrates all bot operations for a single symbol/timeframe.
      - Single source of truth for bot state and decisions.
      - 
      - Functionality is distributed across mixins:
      - - BotStateHandlersMixin: State processing methods
      - - BotSignalLogicMixin: Entry scoring and signal creation
      - - BotTrailingStopsMixin: Trailing stop calculations
      - - BotHelpersMixin: Feature/regime calculation, order creation
      - 
      - Attributes:
      -     config: Full bot configuration
      -     symbol: Trading symbol
      -     state_machine: Bot state machine
      -     position: Current position (if any)
      -     current_signal: Active signal (if any)
      -     regime: Current market regime
      - def __init__(.)
        - Kommentar: Initialize bot controller.
        - 
        - Args:
        -     config: Full bot configuration
        -     event_bus: Event bus for publishing events
        -     on_signal: Callback for new signals
        -     on_decision: Callback for bot decisions
        -     on_order: Callback for order intents
        -     on_log: Callback for activity logging (log_type, message)
        -     on_trading_blocked: Callback when trading is blocked (list of reasons)
        -     on_macd_signal: Callback for MACD cross signals (signal_type, price) for chart markers
      - def state(.)
        - Kommentar: Current bot state.
      - def position(.)
        - Kommentar: Current position.
      - def regime(.)
        - Kommentar: Current market regime.
      - def active_strategy(.)
        - Kommentar: Active strategy profile.
      - def is_running(.)
        - Kommentar: Check if bot is running.
      - def can_trade(.)
        - Kommentar: Check if bot can enter new trades.
      - def _log_activity(.)
        - Kommentar: Log activity to both logger and UI callback.
        - 
        - Args:
        -     log_type: Type of log entry (INFO, BAR, FEATURE, SIGNAL, etc.)
        -     message: Log message
      - def start(.)
        - Kommentar: Start the bot.
        - 
        - Note: Synchronous for easy UI integration. Async operations
        - happen in on_bar() which should be awaited.
      - def stop(.)
        - Kommentar: Stop the bot.
        - 
        - Note: Synchronous for easy UI integration.
      - def pause(.)
        - Kommentar: Pause the bot.
      - def resume(.)
        - Kommentar: Resume the bot.
      - def reset(.)
        - Kommentar: Reset bot to initial state.
      - def warmup_from_history(.)
        - Kommentar: Pre-fill bar buffer with historical data for instant warmup.
        - 
        - This allows the bot to skip the warmup period by using existing
        - chart data instead of waiting for 60+ new bars.
        - 
        - Args:
        -     bars: List of bar dicts with keys: timestamp, open, high, low, close, volume
        - 
        - Returns:
        -     Number of bars loaded into buffer
      - def set_ki_mode(.)
        - Kommentar: Set KI mode dynamically.
        - 
        - Args:
        -     mode: "NO_KI", "LOW_KI", or "FULL_KI" (case-insensitive)
      - def force_strategy_reselection(.)
        - Kommentar: Force strategy re-selection on next bar.
        - 
        - Clears current strategy so the selector will pick a new one.
      - def current_strategy(.)
        - Kommentar: Get current active strategy.
      - def last_regime(.)
        - Kommentar: Get last detected regime.
      - def on_bar(.)
        - Kommentar: Process a new bar (candle close).
        - 
        - Main entry point for bot logic. Called on each candle close.
        - 
        - Args:
        -     bar: Bar data with OHLCV
        - 
        - Returns:
        -     BotDecision if any action taken, None otherwise
  - bot_helpers.py
    - Class: BotHelpersMixin
      - Kommentar: Mixin providing helper methods for feature/regime/order operations.
      - 
      - Expected attributes from BotController:
      -     config: FullBotConfig
      -     symbol: str
      -     timeframe: str
      -     _regime: RegimeState
      -     _active_strategy: StrategyProfile | None
      -     _event_bus: EventBus | None
      -     _feature_engine: FeatureEngine
      -     _bar_buffer: list[dict]
      -     _max_buffer_size: int
      -     _current_signal: Signal | None
      -     _position: PositionState | None
      -     _state_machine: BotStateMachine
      -     _run_id: str
      -     _running: bool
      -     _trades_today: int
      -     _daily_pnl: float
      -     _consecutive_losses: int
      -     _bar_count: int
      -     _log_activity: Callable[[str, str], None]
      - def _calculate_features(.)
        - Kommentar: Calculate feature vector from bar data using FeatureEngine.
        - 
        - Maintains a rolling buffer of bars and uses FeatureEngine to
        - calculate all technical indicators.
        - 
        - Args:
        -     bar: Bar data with OHLCV
        - 
        - Returns:
        -     FeatureVector with calculated indicators
      - def _update_regime(.)
        - Kommentar: Update regime classification.
        - 
        - Args:
        -     features: Current features
        - 
        - Returns:
        -     Updated RegimeState
      - def _create_entry_order(.)
        - Kommentar: Create entry order intent.
        - 
        - Args:
        -     features: Current features
        -     signal: Entry signal
        - 
        - Returns:
        -     OrderIntent
      - def _create_decision(.)
        - Kommentar: Create bot decision record.
        - 
        - Args:
        -     action: Decision action
        -     side: Trade side
        -     features: Current features
        -     reason_codes: Decision reasons
        -     stop_before: Stop price before (if applicable)
        -     stop_after: Stop price after (if applicable)
        -     notes: Additional notes
        - 
        - Returns:
        -     BotDecision
      - def _on_state_transition(.)
        - Kommentar: Handle state transition callback.
        - 
        - Args:
        -     transition: State transition record
      - def simulate_fill(.)
        - Kommentar: Simulate order fill (for paper trading).
        - 
        - Args:
        -     fill_price: Fill price
        -     fill_qty: Filled quantity
        -     order_id: Order ID
      - def to_dict(.)
        - Kommentar: Serialize controller state.
        - 
        - Returns:
        -     Controller state as dict
  - bot_settings_manager.py
    - Class: BotSettingsManager
      - Kommentar: Manages persistent bot settings per symbol.
      - def __init__(.)
        - Kommentar: Initialize settings manager.
        - 
        - Args:
        -     settings_file: Path to settings file (default: config/bot_settings.json)
      - def _load_settings(.)
        - Kommentar: Load settings from file.
      - def _save_settings(.)
        - Kommentar: Save settings to file.
      - def get_settings(.)
        - Kommentar: Get settings for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol (e.g., "BTC/USD", "AAPL")
        - 
        - Returns:
        -     Settings dict or empty dict if no settings saved
      - def save_settings(.)
        - Kommentar: Save settings for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        -     settings: Settings dict to save
      - def get_all_symbols(.)
        - Kommentar: Get list of all symbols with saved settings.
        - 
        - Returns:
        -     List of symbol keys
      - def delete_settings(.)
        - Kommentar: Delete settings for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     True if deleted, False if not found
    - def get_bot_settings_manager(.)
      - Kommentar: Get the singleton settings manager instance.
      - 
      - Returns:
      -     BotSettingsManager instance
    - Kommentar: Default settings file location
    - Kommentar: Singleton instance
  - bot_signal_logic.py
    - Class: BotSignalLogicMixin
      - Kommentar: Mixin providing signal scoring and creation methods.
      - 
      - Expected attributes from BotController:
      -     config: FullBotConfig
      -     symbol: str
      -     _regime: RegimeState
      -     _active_strategy: StrategyProfile | None
      - def _calculate_entry_score(.)
        - Kommentar: Calculate entry score for given side.
        - 
        - Rule-based scoring using indicators.
        - 
        - Args:
        -     features: Current features
        -     side: Trade side
        - 
        - Returns:
        -     Score between 0 and 1
      - def _get_entry_threshold(.)
        - Kommentar: Get entry threshold based on active strategy and regime.
      - def _create_signal(.)
        - Kommentar: Create a trading signal.
        - 
        - Args:
        -     features: Current features
        -     side: Trade side
        -     score: Entry score
        - 
        - Returns:
        -     Signal instance
      - def _get_signal_reasons(.)
        - Kommentar: Get reason codes for signal.
        - 
        - Args:
        -     features: Current features
        -     side: Trade side
        - 
        - Returns:
        -     List of reason codes
  - bot_state_handlers.py
    - Class: BotStateHandlersMixin
      - Kommentar: Mixin providing state processing methods.
      - 
      - Expected attributes from BotController:
      -     config: FullBotConfig
      -     symbol: str
      -     _running: bool
      -     _state_machine: BotStateMachine
      -     _regime: RegimeState
      -     _active_strategy: StrategyProfile | None
      -     _current_signal: Signal | None
      -     _position: PositionState | None
      -     _trades_today: int
      -     _daily_pnl: float
      -     _consecutive_losses: int
      -     _bar_count: int
      -     _trading_blocked: bool
      -     _last_block_reasons: list[str]
      -     _last_strategy_selection_date: datetime | None
      -     _strategy_selector: StrategySelector
      -     _strategy_catalog: StrategyCatalog
      -     _log_activity: Callable[[str, str], None]
      -     _on_signal: Callable[[Signal], None] | None
      -     _on_order: Callable[[OrderIntent], None] | None
      -     _on_trading_blocked: Callable[[list[str]], None] | None
      -     _on_macd_signal: Callable[[str, float], None] | None
      -     can_trade: property
      - def _process_state(.)
        - Kommentar: Process current state and generate decision.
        - 
        - Args:
        -     features: Current feature vector
        -     bar: Current bar data
        - 
        - Returns:
        -     BotDecision or None
      - def _check_strategy_selection(.)
        - Kommentar: Check if strategy selection is needed (daily or forced).
        - 
        - Args:
        -     features: Current feature vector
      - def _process_flat(.)
        - Kommentar: Process FLAT state - look for entry signals.
        - 
        - Args:
        -     features: Current feature vector
        - 
        - Returns:
        -     BotDecision or None
      - def _process_signal(.)
        - Kommentar: Process SIGNAL state - confirm or expire signal.
        - 
        - Args:
        -     features: Current feature vector
        - 
        - Returns:
        -     BotDecision or None
      - def _process_manage(.)
        - Kommentar: Process MANAGE state - manage open position.
        - 
        - Args:
        -     features: Current feature vector
        -     bar: Current bar data
        - 
        - Returns:
        -     BotDecision or None
      - def _handle_stop_hit(.)
        - Kommentar: Handle stop-loss hit.
        - 
        - Args:
        -     features: Current feature vector
        - 
        - Returns:
        -     BotDecision
      - def _handle_exit_signal(.)
        - Kommentar: Handle exit signal.
        - 
        - Args:
        -     features: Current feature vector
        -     reason: Exit reason
        - 
        - Returns:
        -     BotDecision
      - def _check_exit_signals(.)
        - Kommentar: Check for exit signals.
        - 
        - Args:
        -     features: Current features
        - 
        - Returns:
        -     Exit reason or None
  - bot_trailing_stops.py
    - Class: BotTrailingStopsMixin
      - Kommentar: Mixin providing trailing stop calculation methods.
      - 
      - Expected attributes from BotController:
      -     config: FullBotConfig
      -     _log_activity: Callable[[str, str], None]
      - def _calculate_trailing_stop(.)
        - Kommentar: Calculate new trailing stop price.
        - 
        - Trailing stop is only activated when position is in profit.
        - Until then, the initial stop loss remains active.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        - 
        - Returns:
        -     New stop price or None if no update needed
      - def _trailing_pct(.)
        - Kommentar: Percentage-based trailing stop.
        - 
        - Distance is calculated from CURRENT price, not highest/lowest.
        - The stop only moves in favorable direction (up for long, down for short).
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        - 
        - Returns:
        -     New stop price or None
      - def _trailing_atr(.)
        - Kommentar: ATR-based trailing stop with regime-adaptive multiplier.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        - 
        - Returns:
        -     New stop price or None
      - def _trailing_swing(.)
        - Kommentar: Swing/structure-based trailing stop.
        - 
        - Simplified: uses Bollinger bands as structure levels.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        - 
        - Returns:
        -     New stop price or None
  - candle_preprocessing.py
    - def preprocess_candles(.)
      - Kommentar: Preprocess candles for feature calculation.
      - 
      - Handles:
      - - Timezone normalization
      - - Missing candle detection and forward-fill
      - - Session filtering (RTH for stocks, 24/7 for crypto)
      - - Invalid price detection
      - 
      - Args:
      -     data: DataFrame with OHLCV columns and datetime index
      -     market_type: "STOCK" or "CRYPTO"
      -     target_tz: Target timezone for normalization
      -     fill_missing: Whether to forward-fill missing candles
      -     filter_sessions: Whether to filter to valid trading sessions
      - 
      - Returns:
      -     Preprocessed DataFrame
    - def detect_missing_candles(.)
      - Kommentar: Detect timestamps where candles are missing.
      - 
      - Args:
      -     data: DataFrame with datetime index
      -     expected_freq: Expected candle frequency (e.g., "1T", "5T", "1H")
      - 
      - Returns:
      -     List of missing timestamps
    - def validate_candles(.)
      - Kommentar: Validate candle data quality.
      - 
      - Returns dict with validation results:
      - - is_valid: Overall validity
      - - issues: List of detected issues
      - - stats: Data quality statistics
    - Kommentar: Trading session definitions
  - config.py
    - Class: MarketType
      - Kommentar: Supported market types.
    - Class: KIMode
      - Kommentar: KI operation modes.
      - 
      - NO_KI: Pure rule-based operation, no LLM calls
      - LOW_KI: Daily strategy selection only (1 call/day)
      - FULL_KI: Daily + intraday events (regime flip, exit candidate, signal change)
    - Class: TrailingMode
      - Kommentar: Trailing stop modes.
    - Class: TradingEnvironment
      - Kommentar: Trading environment.
    - Class: BotConfig
      - Kommentar: Main bot configuration.
      - 
      - Contains all settings for bot operation including market type,
      - timeframe, and enabled features.
      - def validate_symbol(.)
        - Kommentar: Normalize symbol to uppercase.
    - Class: RiskConfig
      - Kommentar: Risk management configuration.
      - 
      - Defines position sizing, stop-loss parameters, and risk limits.
      - def crypto_defaults(.)
        - Kommentar: Get conservative defaults for crypto trading.
      - def nasdaq_defaults(.)
        - Kommentar: Get conservative defaults for NASDAQ trading.
    - Class: LLMPolicyConfig
      - Kommentar: LLM/KI call policy configuration.
      - 
      - Defines when and how LLM is called, with budget and safety limits.
    - Class: FullBotConfig
      - Kommentar: Complete bot configuration combining all config types.
      - def create_default(.)
        - Kommentar: Create default configuration for a symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        -     market_type: Target market type
        - 
        - Returns:
        -     FullBotConfig with market-appropriate defaults
  - entry_exit_engine.py
    - Class: TrailingStopResult
      - Kommentar: Result of trailing stop calculation.
    - Class: TrailingStopManager
      - Kommentar: Manages trailing stop updates for positions.
      - def __init__(.)
        - Kommentar: Initialize trailing stop manager.
        - 
        - Args:
        -     min_step_pct: Minimum step size as percentage
        -     update_cooldown_bars: Bars between updates
        -     activation_pct: Minimum profit % before trailing activates
      - def calculate_trailing_stop(.)
        - Kommentar: Calculate new trailing stop price.
        - 
        - Trailing stop is only activated when position is in profit.
        - Until then, the initial stop loss remains active.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        -     regime: Current regime
        -     current_bar: Current bar index
        - 
        - Returns:
        -     TrailingStopResult with new stop price if applicable
      - def _trailing_pct(.)
        - Kommentar: Percentage-based trailing stop.
      - def _trailing_atr(.)
        - Kommentar: ATR-based trailing stop.
      - def _trailing_swing(.)
        - Kommentar: Swing/structure-based trailing stop using BB.
    - Class: EntryExitEngine
      - Kommentar: Unified engine for entry/exit decisions.
      - 
      - Combines entry scoring, exit signal checking, and trailing stop
      - management into a single interface.
      - def __init__(.)
        - Kommentar: Initialize entry/exit engine.
        - 
        - Args:
        -     entry_scorer: Entry score calculator
        -     exit_checker: Exit signal checker
        -     trailing_manager: Trailing stop manager
      - def evaluate_entry(.)
        - Kommentar: Evaluate entry scores for both sides.
        - 
        - Args:
        -     features: Current features
        -     regime: Current regime
        -     strategy: Optional strategy
        - 
        - Returns:
        -     (long_score, short_score)
      - def check_exit(.)
        - Kommentar: Check for exit signals.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        -     regime: Current regime
        -     previous_regime: Previous regime
        -     strategy: Optional strategy
        - 
        - Returns:
        -     ExitSignalResult
      - def update_trailing_stop(.)
        - Kommentar: Update trailing stop.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        -     regime: Current regime
        -     current_bar: Current bar index
        - 
        - Returns:
        -     TrailingStopResult
  - entry_scorer.py
    - Class: EntryScoreResult
      - Kommentar: Result of entry score calculation.
    - Class: EntryScorer
      - Kommentar: Calculates entry scores based on strategy rules and indicators.
      - 
      - Supports both generic scoring and strategy-specific rule evaluation.
      - def __init__(.)
        - Kommentar: Initialize entry scorer.
        - 
        - Args:
        -     weights: Custom indicator weights
      - def calculate_score(.)
        - Kommentar: Calculate entry score for a side.
        - 
        - Args:
        -     features: Current feature vector
        -     side: Trade direction
        -     regime: Current market regime
        -     strategy: Optional strategy with custom rules
        - 
        - Returns:
        -     EntryScoreResult with score and breakdown
      - def _score_generic(.)
        - Kommentar: Generic scoring without strategy-specific rules.
      - def _score_with_rules(.)
        - Kommentar: Score using strategy-specific entry rules.
      - def _evaluate_entry_rule(.)
        - Kommentar: Evaluate a single entry rule.
      - def _get_indicator_value(.)
        - Kommentar: Get indicator value from features.
      - def _check_direction_match(.)
        - Kommentar: Check if indicator direction matches trade side.
      - def _score_trend_alignment(.)
        - Kommentar: Score trend alignment (MA alignment).
      - def _score_rsi_momentum(.)
        - Kommentar: Score RSI momentum.
      - def _score_macd_momentum(.)
        - Kommentar: Score MACD momentum.
      - def _score_trend_strength(.)
        - Kommentar: Score trend strength via ADX.
      - def _score_mean_reversion(.)
        - Kommentar: Score mean reversion setup (BB position).
      - def _score_volume(.)
        - Kommentar: Score volume confirmation.
      - def _score_regime_match(.)
        - Kommentar: Score regime appropriateness.
  - evaluator_types.py
    - Class: TradeResult
      - Kommentar: Result of a single trade.
    - Class: PerformanceMetrics
      - Kommentar: Performance metrics for a strategy evaluation period.
      - def is_robust(.)
        - Kommentar: Check if metrics meet robustness criteria.
        - 
        - Args:
        -     min_trades: Minimum number of trades
        -     min_profit_factor: Minimum profit factor
        -     max_drawdown_pct: Maximum allowed drawdown %
        -     min_win_rate: Minimum win rate
        - 
        - Returns:
        -     True if all criteria met
    - Class: RobustnessGate
      - Kommentar: Configuration for robustness validation.
    - Class: WalkForwardConfig
      - Kommentar: Configuration for walk-forward analysis.
    - Class: WalkForwardResult
      - Kommentar: Result of walk-forward analysis.
  - execution.py
    - Class: PaperExecutor
      - Kommentar: Paper trading executor with slippage simulation.
      - 
      - Simulates order execution for backtesting and paper trading.
      - def __init__(.)
        - Kommentar: Initialize paper executor.
        - 
        - Args:
        -     slippage_pct: Simulated slippage percentage
        -     fill_probability: Probability of fill (1.0 = always)
        -     partial_fill_probability: Probability of partial fill
        -     latency_ms: Simulated latency in milliseconds
        -     fee_pct: Fee percentage (per side)
      - def execute(.)
        - Kommentar: Execute an order (paper).
        - 
        - Args:
        -     order: Order intent
        -     current_price: Current market price
        - 
        - Returns:
        -     OrderResult
      - def cancel(.)
        - Kommentar: Cancel an order.
        - 
        - Args:
        -     order_id: Order ID to cancel
        - 
        - Returns:
        -     OrderResult with cancelled status
      - def get_order(.)
        - Kommentar: Get order result by ID.
        - 
        - Args:
        -     order_id: Order ID
        - 
        - Returns:
        -     OrderResult or None
    - Class: ExecutionGuardrails
      - Kommentar: Safety guardrails for order execution.
      - 
      - Validates orders before execution and prevents
      - dangerous operations.
      - def __init__(.)
        - Kommentar: Initialize guardrails.
        - 
        - Args:
        -     max_order_value: Maximum order value
        -     max_order_quantity: Maximum quantity
        -     min_order_value: Minimum order value
        -     rate_limit_per_minute: Orders per minute limit
        -     require_stop_loss: Require stop-loss for entries
        -     prevent_duplicates: Prevent duplicate orders
      - def validate(.)
        - Kommentar: Validate an order before execution.
        - 
        - Args:
        -     order: Order to validate
        -     current_price: Current market price
        - 
        - Returns:
        -     (is_valid, list of rejection reasons)
      - def record_order(.)
        - Kommentar: Record an executed order for tracking.
        - 
        - Args:
        -     order: Executed order
      - def clear_signal(.)
        - Kommentar: Clear a signal from pending.
        - 
        - Args:
        -     signal_id: Signal ID to clear
      - def _check_rate_limit(.)
        - Kommentar: Check if within rate limit.
    - Class: OrderExecutor
      - Kommentar: Unified order executor supporting paper and live modes.
      - 
      - Combines position sizing, risk management, guardrails,
      - and execution in a single interface.
      - def __init__(.)
        - Kommentar: Initialize order executor.
        - 
        - Args:
        -     environment: Trading environment (paper/live)
        -     account_value: Account value
        -     risk_limits: Risk limits
        -     guardrails: Execution guardrails
        -     on_fill: Callback for fills
      - def execute_entry(.)
        - Kommentar: Execute an entry order.
        - 
        - Args:
        -     signal: Entry signal
        -     current_price: Current price
        -     atr: ATR for sizing
        - 
        - Returns:
        -     OrderResult
      - def execute_exit(.)
        - Kommentar: Execute an exit order.
        - 
        - Args:
        -     symbol: Symbol
        -     side: Original position side
        -     quantity: Quantity to exit
        -     current_price: Current price
        -     reason: Exit reason
        - 
        - Returns:
        -     OrderResult
      - def record_trade_pnl(.)
        - Kommentar: Record trade P&L for risk tracking.
        - 
        - Args:
        -     pnl: Trade P&L
      - def update_account_value(.)
        - Kommentar: Update account value.
        - 
        - Args:
        -     value: New account value
      - def get_risk_stats(.)
        - Kommentar: Get current risk statistics.
        - 
        - Returns:
        -     Risk stats dict
      - def is_trading_allowed(.)
        - Kommentar: Check if trading is allowed.
        - 
        - Returns:
        -     True if trading allowed
    - Kommentar: Re-export types for backward compatibility
  - execution_types.py
    - Class: OrderStatus
      - Kommentar: Order status.
    - Class: OrderType
      - Kommentar: Order types.
    - Class: OrderResult
      - Kommentar: Result of order execution.
      - def is_filled(.)
      - def is_rejected(.)
    - Class: PositionSizeResult
      - Kommentar: Result of position size calculation.
    - Class: RiskLimits
      - Kommentar: Risk limit configuration.
    - Class: RiskState
      - Kommentar: Current risk tracking state.
  - exit_checker.py
    - Class: ExitReason
      - Kommentar: Exit signal reasons.
    - Class: ExitSignalResult
      - Kommentar: Result of exit signal check.
    - Class: ExitSignalChecker
      - Kommentar: Checks for exit signals based on multiple criteria.
      - def __init__(.)
        - Kommentar: Initialize exit signal checker.
        - 
        - Args:
        -     max_bars_held: Maximum bars before time stop
        -     rsi_extreme_threshold: RSI level for extreme exit
        -     enable_time_stop: Enable time-based exit
      - def check_exit(.)
        - Kommentar: Check all exit conditions.
        - 
        - Args:
        -     features: Current features
        -     position: Current position
        -     regime: Current regime
        -     previous_regime: Previous regime for flip detection
        -     strategy: Optional strategy with custom exit rules
        - 
        - Returns:
        -     ExitSignalResult
      - def _check_rsi_extreme(.)
        - Kommentar: Check RSI extreme exit.
      - def _check_macd_cross(.)
        - Kommentar: Check MACD cross against position.
      - def _check_bb_reversal(.)
        - Kommentar: Check Bollinger Band reversal.
      - def _check_trend_break(.)
        - Kommentar: Check trend break (MA cross).
      - def _check_volatility_spike(.)
        - Kommentar: Check for volatility spike exit.
      - def _check_regime_flip(.)
        - Kommentar: Check for significant regime change.
      - def _check_time_stop(.)
        - Kommentar: Check time-based exit.
  - feature_engine.py
    - Class: FeatureEngine
      - Kommentar: Engine for calculating features from market data.
      - 
      - Integrates with IndicatorEngine to compute all required
      - technical indicators and constructs FeatureVector objects.
      - def __init__(.)
        - Kommentar: Initialize feature engine.
        - 
        - Args:
        -     indicator_engine: Existing indicator engine instance.
        -                     Creates new one if not provided.
        -     periods: Custom indicator periods. Merges with defaults.
      - def _build_indicator_configs(.)
        - Kommentar: Build list of indicator configurations.
      - def calculate_features(.)
        - Kommentar: Calculate feature vector from OHLCV data.
        - 
        - Args:
        -     data: DataFrame with columns: open, high, low, close, volume
        -           Should have at least MIN_BARS rows.
        -     symbol: Trading symbol
        -     timestamp: Override timestamp (uses last bar if not provided)
        - 
        - Returns:
        -     FeatureVector with all calculated indicators, or None if
        -     insufficient data.
      - def _normalize_columns(.)
        - Kommentar: Normalize column names to lowercase.
      - def preprocess_candles(.)
        - Kommentar: Preprocess candles for feature calculation. Delegates to module function.
      - def detect_missing_candles(.)
        - Kommentar: Detect missing candles. Delegates to module function.
      - def validate_candles(.)
        - Kommentar: Validate candle data. Delegates to module function.
      - def _calculate_all_indicators(.)
        - Kommentar: Calculate all configured indicators.
        - 
        - Returns dict keyed by indicator identifier.
      - def _result_key(.)
        - Kommentar: Generate unique key for indicator result.
      - def _extract_feature_values(.)
        - Kommentar: Extract latest values from indicator results.
      - def _get_last_value(.)
        - Kommentar: Safely extract last value from Series, array, or scalar.
      - def _calculate_derived_features(.)
        - Kommentar: Calculate derived features from base indicators.
      - def _get_sma_at_index(.)
        - Kommentar: Calculate SMA at a specific index.
      - def get_required_bars(.)
        - Kommentar: Get minimum bars required for feature calculation.
      - def clear_cache(.)
        - Kommentar: Clear indicator cache.
  - llm_integration.py
    - Class: LLMIntegration
      - Kommentar: Main LLM integration class for tradingbot.
      - 
      - Manages:
      - - Call policy enforcement
      - - Budget tracking
      - - OpenAI API calls with structured outputs
      - - Response validation
      - - Fallback handling
      - - Audit trail
      - def __init__(.)
        - Kommentar: Initialize LLM integration.
        - 
        - Args:
        -     config: LLM policy configuration
        -     api_key: OpenAI API key (or from env)
        -     on_call: Callback for call events
      - def _get_client(.)
        - Kommentar: Get or create OpenAI client.
      - def can_call(.)
        - Kommentar: Check if an LLM call is allowed.
        - 
        - Args:
        -     call_type: Type of call
        - 
        - Returns:
        -     (allowed, reason)
      - def call_for_strategy_selection(.)
        - Kommentar: Make LLM call for daily strategy selection.
        - 
        - Args:
        -     features: Current features
        -     regime: Current regime
        -     strategies: Available strategies with scores
        - 
        - Returns:
        -     Strategy selection dict or None on failure
      - def call_for_trade_decision(.)
        - Kommentar: Make LLM call for trade decision.
        - 
        - Args:
        -     features: Current features
        -     regime: Current regime
        -     position: Current position or None
        -     state: Bot state
        -     strategy: Active strategy
        -     call_type: Type of call trigger
        - 
        - Returns:
        -     Validated LLMBotResponse (may be fallback)
      - def _make_call(.)
        - Kommentar: Make actual API call to OpenAI.
        - 
        - Args:
        -     prompt: Prompt string
        -     call_type: Type of call
        -     response_format: Optional response format spec
        - 
        - Returns:
        -     Response text or None
      - def _record_call(.)
        - Kommentar: Record a call for audit and budget tracking.
        - 
        - Args:
        -     record: Call record
      - def _record_fallback_used(.)
        - Kommentar: Record that a fallback was used.
      - def _check_day_rollover(.)
        - Kommentar: Check for day rollover and reset budget.
      - def get_stats(.)
        - Kommentar: Get current LLM usage statistics.
        - 
        - Returns:
        -     Stats dict
      - def get_audit_trail(.)
        - Kommentar: Get audit trail of LLM calls.
        - 
        - Args:
        -     limit: Max records to return
        -     call_type: Filter by call type
        - 
        - Returns:
        -     List of call records as dicts
    - Kommentar: Import from split modules
    - Kommentar: Re-export for backward compatibility
  - llm_prompts.py
    - Class: LLMPromptBuilder
      - Kommentar: Builds structured prompts for LLM calls.
      - 
      - Formats features, state, and constraints into a consistent
      - prompt format that the LLM can process reliably.
      - def build_daily_strategy_prompt(.)
        - Kommentar: Build prompt for daily strategy selection.
        - 
        - Args:
        -     features: Current feature vector
        -     regime: Current regime state
        -     strategies: List of available strategies with scores
        -     constraints: Optional constraints dict
        - 
        - Returns:
        -     Formatted prompt string
      - def build_trade_decision_prompt(.)
        - Kommentar: Build prompt for trade decision.
        - 
        - Args:
        -     features: Current feature vector
        -     regime: Current regime state
        -     position: Current position dict or None
        -     state: Bot state (FLAT, SIGNAL, MANAGE, etc.)
        -     strategy: Active strategy dict
        -     constraints: Risk constraints
        - 
        - Returns:
        -     Formatted prompt string
  - llm_types.py
    - Class: LLMCallType
      - Kommentar: Types of LLM calls.
    - Class: LLMCallRecord
      - Kommentar: Record of an LLM call for audit trail.
    - Class: LLMBudgetState
      - Kommentar: Budget tracking state.
  - llm_validators.py
    - Class: LLMResponseValidator
      - Kommentar: Validates LLM responses against expected schema.
      - 
      - Provides strict validation with repair attempts and
      - fallback to rule-based defaults.
      - def validate_trade_decision(.)
        - Kommentar: Validate trade decision response.
        - 
        - Args:
        -     response: Raw response dict or JSON string
        -     allow_repair: Attempt to repair invalid responses
        - 
        - Returns:
        -     (Validated response or None, list of validation errors)
      - def _attempt_repair(.)
        - Kommentar: Attempt to repair an invalid response.
        - 
        - Args:
        -     response: Invalid response dict
        - 
        - Returns:
        -     Repaired dict or None
      - def get_fallback_response(.)
        - Kommentar: Get rule-based fallback response.
        - 
        - Args:
        -     state: Current bot state
        -     features: Optional features for context
        - 
        - Returns:
        -     Safe fallback response
  - models.py
    - Class: TradeSide
      - Kommentar: Trade direction.
    - Class: BotAction
      - Kommentar: Bot decision actions.
    - Class: RegimeType
      - Kommentar: Market regime types.
    - Class: VolatilityLevel
      - Kommentar: Volatility classification.
    - Class: SignalType
      - Kommentar: Signal confirmation level.
    - Class: FeatureVector
      - Kommentar: Feature vector for bot decision making.
      - 
      - Contains all indicator values and derived features
      - used for entry/exit scoring and LLM input.
      - def to_dict_normalized(.)
        - Kommentar: Export as normalized dict for LLM input.
        - 
        - Returns dict with only numeric features, suitable for structured prompt.
      - def compute_hash(.)
        - Kommentar: Compute hash of feature vector for audit trail.
    - Class: RegimeState
      - Kommentar: Current market regime classification.
      - 
      - Combines trend direction and volatility level for
      - strategy selection and parameter adjustment.
      - def is_trending(.)
        - Kommentar: Check if market is trending.
      - def regime_label(.)
        - Kommentar: Human-readable regime label.
    - Class: Signal
      - Kommentar: Trading signal with entry details.
      - 
      - Represents a potential or confirmed entry signal with
      - scoring, direction, and risk parameters.
      - def risk_reward_potential(.)
        - Kommentar: Estimated risk-reward based on ATR.
      - def to_marker_data(.)
        - Kommentar: Convert to chart marker data format.
    - Class: OrderIntent
      - Kommentar: Intent to place an order.
      - 
      - Represents the bot's decision to enter/exit, before
      - actual order execution. Used for validation and logging.
    - Class: TrailingState
      - Kommentar: Trailing stop state tracking.
      - 
      - Tracks the current trailing stop level and mode,
      - with history of adjustments.
      - def update_stop(.)
        - Kommentar: Update stop price if valid (never loosens).
        - 
        - Args:
        -     new_stop: New stop price
        -     current_bar: Current bar index
        -     timestamp: Current timestamp
        -     is_long: True for LONG positions (stop can only go up),
        -              False for SHORT positions (stop can only go down)
        - 
        - Returns:
        -     True if stop was updated, False if rejected
    - Class: PositionState
      - Kommentar: Current position state.
      - 
      - Complete state of an open position including entry,
      - trailing stop, P&L, and metadata.
      - def update_price(.)
        - Kommentar: Update current price and recalculate P&L.
      - def is_stopped_out(.)
        - Kommentar: Check if position hit stop-loss.
    - Class: BotDecision
      - Kommentar: Bot decision record.
      - 
      - Complete record of a bot decision for audit trail,
      - including inputs, action, and reasoning.
    - Class: LLMBotResponse
      - Kommentar: Structured LLM response for bot decisions.
      - 
      - JSON schema for OpenAI Structured Outputs.
      - def validate_reason_codes(.)
        - Kommentar: Ensure reason codes are uppercase.
    - Class: StrategyProfile
      - Kommentar: Strategy profile for daily selection.
      - 
      - Defines a trading strategy with its parameters,
      - applicable regimes, and performance history.
      - def is_applicable(.)
        - Kommentar: Check if strategy is applicable for current regime.
  - no_trade_filter.py
    - Class: FilterReason
      - Kommentar: Reasons for filtering a trade.
    - Class: FilterResult
      - Kommentar: Result of trade filter check.
      - def add_block(.)
        - Kommentar: Add a blocking reason.
      - def __bool__(.)
        - Kommentar: Returns True if trade is allowed.
    - Class: TradingSession
      - Kommentar: Track daily trading session metrics.
      - def record_trade(.)
        - Kommentar: Record a completed trade.
    - Class: NoTradeFilter
      - Kommentar: Filter engine to block trades under unfavorable conditions.
      - 
      - Implements multiple filter layers:
      - 1. Volatility filters
      - 2. Volume/liquidity filters
      - 3. Time-based filters
      - 4. Risk management filters
      - 5. Technical filters
      - def __init__(.)
        - Kommentar: Initialize no-trade filter.
        - 
        - Args:
        -     market_type: Type of market (CRYPTO or NASDAQ)
        -     account_value: Current account value for risk calculations
        -     config: Custom configuration overrides
      - def session(.)
        - Kommentar: Get current trading session, creating new one if needed.
      - def check(.)
        - Kommentar: Check all filters for current market conditions.
        - 
        - Args:
        -     features: Current feature vector
        -     regime: Current regime state
        -     timestamp: Override timestamp for testing
        - 
        - Returns:
        -     FilterResult indicating if trade is allowed
      - def _check_volatility(.)
        - Kommentar: Check volatility filters.
      - def _check_volume(.)
        - Kommentar: Check volume/liquidity filters.
      - def _check_time(.)
        - Kommentar: Check time-based filters.
      - def _check_risk_limits(.)
        - Kommentar: Check risk management filters.
      - def _check_technical(.)
        - Kommentar: Check technical filters.
      - def _check_regime_transition(.)
        - Kommentar: Check for regime transition.
      - def record_trade(.)
        - Kommentar: Record a completed trade result.
        - 
        - Args:
        -     pnl: Realized P&L of the trade
      - def reset_session(.)
        - Kommentar: Force reset trading session.
      - def update_account_value(.)
        - Kommentar: Update account value for risk calculations.
        - 
        - Args:
        -     value: New account value
      - def add_news_blackout(.)
        - Kommentar: Add a news blackout window.
        - 
        - Args:
        -     start: Blackout start time
        -     end: Blackout end time
      - def clear_news_blackouts(.)
        - Kommentar: Clear all news blackout windows.
      - def is_trading_allowed(.)
        - Kommentar: Quick check if trading is generally allowed.
        - 
        - Returns:
        -     True if no session-level blocks
      - def get_session_stats(.)
        - Kommentar: Get current session statistics.
        - 
        - Returns:
        -     Dict with session stats
      - def get_filter_config(.)
        - Kommentar: Get current filter configuration.
        - 
        - Returns:
        -     Copy of filter config
  - position_sizer.py
    - Class: PositionSizer
      - Kommentar: Calculates position sizes based on risk parameters.
      - 
      - Supports multiple sizing methods:
      - - Fixed fractional (% of account)
      - - ATR-based (volatility-adjusted)
      - - Fixed quantity
      - def __init__(.)
        - Kommentar: Initialize position sizer.
        - 
        - Args:
        -     account_value: Current account value
        -     risk_limits: Risk limit configuration
        -     default_risk_pct: Default risk per trade
        -     include_fees: Include fees in calculations
        -     fee_pct: Fee percentage (round-trip)
      - def calculate_size(.)
        - Kommentar: Calculate position size for a signal.
        - 
        - Args:
        -     signal: Entry signal with stop-loss
        -     current_price: Current market price
        -     atr: Average True Range (for ATR-based sizing)
        -     risk_pct: Override risk percentage
        - 
        - Returns:
        -     PositionSizeResult with calculated size
      - def calculate_size_atr(.)
        - Kommentar: Calculate position size using ATR-based stop distance.
        - 
        - Args:
        -     signal: Entry signal
        -     current_price: Current price
        -     atr: Average True Range
        -     atr_multiple: ATR multiple for stop distance
        -     risk_pct: Risk percentage
        - 
        - Returns:
        -     PositionSizeResult
      - def update_account_value(.)
        - Kommentar: Update account value.
        - 
        - Args:
        -     value: New account value
  - regime_engine.py
    - Class: RegimeEngine
      - Kommentar: Engine for market regime classification.
      - 
      - Analyzes technical indicators to determine:
      - - Trend direction (up/down/range)
      - - Volatility level (low/normal/high/extreme)
      - 
      - Classification is used for:
      - - Daily strategy selection
      - - Entry/exit parameter adjustment
      - - Risk management tuning
      - def __init__(.)
        - Kommentar: Initialize regime engine.
        - 
        - Args:
        -     adx_trending: Custom ADX threshold for trending
        -     vol_high_pct: Custom volatility high threshold
        -     use_rsi_confirmation: Use RSI to confirm trend direction
      - def classify(.)
        - Kommentar: Classify current market regime from features.
        - 
        - Args:
        -     features: Feature vector with indicator values
        - 
        - Returns:
        -     RegimeState with regime and volatility classification
      - def _classify_regime(.)
        - Kommentar: Classify regime as trend up/down or range.
        - 
        - Returns:
        -     (RegimeType, confidence)
      - def _classify_volatility(.)
        - Kommentar: Classify volatility level.
        - 
        - Uses ATR % and BB width as primary indicators.
        - 
        - Returns:
        -     (VolatilityLevel, confidence)
      - def _calc_atr_pct(.)
        - Kommentar: Calculate ATR as percentage of price.
      - def is_favorable_for_trend(.)
        - Kommentar: Check if regime is favorable for trend-following strategies.
        - 
        - Args:
        -     state: Current regime state
        - 
        - Returns:
        -     True if trend-following is favorable
      - def is_favorable_for_range(.)
        - Kommentar: Check if regime is favorable for range/mean-reversion strategies.
        - 
        - Args:
        -     state: Current regime state
        - 
        - Returns:
        -     True if range trading is favorable
      - def get_risk_multiplier(.)
        - Kommentar: Get risk adjustment multiplier based on volatility.
        - 
        - Args:
        -     state: Current regime state
        - 
        - Returns:
        -     Multiplier for position sizing (0.5 to 1.0)
      - def get_trailing_multiplier(.)
        - Kommentar: Get trailing stop distance multiplier based on volatility.
        - 
        - Args:
        -     state: Current regime state
        - 
        - Returns:
        -     Multiplier for trailing distance (1.0 to 2.0)
      - def detect_regime_change(.)
        - Kommentar: Detect if regime has changed significantly.
        - 
        - Args:
        -     current: Current regime state
        -     previous: Previous regime state
        - 
        - Returns:
        -     Dict with change flags
  - risk_manager.py
    - Class: RiskManager
      - Kommentar: Manages trading risk limits and tracking.
      - 
      - Tracks daily P&L, position count, loss streaks,
      - and enforces risk limits.
      - def __init__(.)
        - Kommentar: Initialize risk manager.
        - 
        - Args:
        -     limits: Risk limit configuration
        -     account_value: Account value for calculations
      - def state(.)
        - Kommentar: Current risk state.
      - def can_trade(.)
        - Kommentar: Check if trading is allowed.
        - 
        - Returns:
        -     (can_trade, list of blocking reasons)
      - def record_trade_start(.)
        - Kommentar: Record start of a new trade.
      - def record_trade_end(.)
        - Kommentar: Record end of a trade.
        - 
        - Args:
        -     pnl: Trade P&L
      - def _check_day_rollover(.)
        - Kommentar: Check if we've rolled into a new trading day.
      - def _check_cooldown_expired(.)
        - Kommentar: Check if cooldown has expired.
      - def _enter_cooldown(.)
        - Kommentar: Enter cooldown mode.
      - def update_account_value(.)
        - Kommentar: Update account value.
      - def get_stats(.)
        - Kommentar: Get current risk stats.
        - 
        - Returns:
        -     Dict with risk metrics
  - state_machine.py
    - Class: BotState
      - Kommentar: Bot operation states.
    - Class: BotTrigger
      - Kommentar: State transition triggers.
    - Class: StateTransition
      - Kommentar: Record of a state transition.
    - Class: StateMachineError
      - Kommentar: State machine operation error.
    - Class: InvalidTransitionError
      - Kommentar: Invalid state transition attempted.
    - Class: BotStateMachine
      - Kommentar: Finite state machine for trading bot operation.
      - 
      - Manages state transitions with guards and callbacks.
      - Thread-safe design for async operation.
      - def __init__(.)
        - Kommentar: Initialize state machine.
        - 
        - Args:
        -     symbol: Trading symbol this machine manages
        -     initial_state: Starting state
        -     on_transition: Callback for state transitions
      - def state(.)
        - Kommentar: Current state.
      - def history(.)
        - Kommentar: Transition history.
      - def context(.)
        - Kommentar: State context data.
      - def can_transition(.)
        - Kommentar: Check if transition is valid from current state.
        - 
        - Args:
        -     trigger: Transition trigger
        - 
        - Returns:
        -     True if transition is valid
      - def get_valid_triggers(.)
        - Kommentar: Get all valid triggers from current state.
        - 
        - Returns:
        -     List of valid triggers
      - def trigger(.)
        - Kommentar: Execute a state transition.
        - 
        - Args:
        -     trigger: Transition trigger
        -     data: Additional context data
        -     force: Force transition even if invalid (for error recovery)
        - 
        - Returns:
        -     New state after transition
        - 
        - Raises:
        -     InvalidTransitionError: If transition is invalid and not forced
      - def reset(.)
        - Kommentar: Reset state machine to FLAT.
        - 
        - Args:
        -     clear_history: Also clear transition history
      - def set_context(.)
        - Kommentar: Set context value.
        - 
        - Args:
        -     key: Context key
        -     value: Context value
      - def get_context(.)
        - Kommentar: Get context value.
        - 
        - Args:
        -     key: Context key
        -     default: Default value if not found
        - 
        - Returns:
        -     Context value or default
      - def is_flat(.)
        - Kommentar: Check if no position.
      - def is_in_trade(.)
        - Kommentar: Check if in active trade.
      - def is_waiting_fill(.)
        - Kommentar: Check if waiting for order fill.
      - def is_managing(.)
        - Kommentar: Check if actively managing position.
      - def is_paused(.)
        - Kommentar: Check if paused.
      - def is_error(.)
        - Kommentar: Check if in error state.
      - def can_enter_trade(.)
        - Kommentar: Check if can enter new trade.
      - def on_candle_close(.)
        - Kommentar: Handle candle close event.
        - 
        - Args:
        -     bar_data: Bar data dict
        - 
        - Returns:
        -     New state
      - def on_signal(.)
        - Kommentar: Handle signal event.
        - 
        - Args:
        -     signal: Trading signal
        -     confirmed: Whether signal is confirmed
        - 
        - Returns:
        -     New state
      - def on_order_fill(.)
        - Kommentar: Handle order fill event.
        - 
        - Args:
        -     fill_price: Fill price
        -     fill_qty: Filled quantity
        -     order_id: Order ID
        - 
        - Returns:
        -     New state
      - def on_stop_hit(.)
        - Kommentar: Handle stop-loss hit event.
        - 
        - Args:
        -     exit_price: Exit price
        - 
        - Returns:
        -     New state
      - def on_exit_signal(.)
        - Kommentar: Handle exit signal event.
        - 
        - Args:
        -     reason: Exit reason
        - 
        - Returns:
        -     New state
      - def pause(.)
        - Kommentar: Pause the bot.
        - 
        - Args:
        -     reason: Pause reason
        - 
        - Returns:
        -     New state
      - def resume(.)
        - Kommentar: Resume the bot.
        - 
        - Returns:
        -     New state
      - def error(.)
        - Kommentar: Transition to error state.
        - 
        - Args:
        -     error_msg: Error message
        - 
        - Returns:
        -     New state
      - def clear_error(.)
        - Kommentar: Clear error and return to FLAT.
        - 
        - Returns:
        -     New state
      - def to_dict(.)
        - Kommentar: Serialize state machine to dict.
        - 
        - Returns:
        -     State machine as dict
      - def from_dict(.)
        - Kommentar: Deserialize state machine from dict.
        - 
        - Args:
        -     data: Serialized data
        -     on_transition: Transition callback
        - 
        - Returns:
        -     BotStateMachine instance
  - strategy_catalog.py
    - Class: StrategyCatalog
      - Kommentar: Catalog of pre-built trading strategies.
      - 
      - Provides strategy definitions for different market conditions
      - and regime types.
      - def __init__(.)
        - Kommentar: Initialize strategy catalog with built-in strategies.
      - def _register_builtin_strategies(.)
        - Kommentar: Register all built-in strategy definitions.
      - def get_strategy(.)
        - Kommentar: Get strategy by name.
        - 
        - Args:
        -     name: Strategy name
        - 
        - Returns:
        -     StrategyDefinition or None if not found
      - def get_all_strategies(.)
        - Kommentar: Get all registered strategies.
        - 
        - Returns:
        -     List of all strategy definitions
      - def get_strategies_for_regime(.)
        - Kommentar: Get strategies applicable for current regime.
        - 
        - Args:
        -     regime: Current regime state
        - 
        - Returns:
        -     List of applicable strategies
      - def get_strategies_by_type(.)
        - Kommentar: Get strategies of a specific type.
        - 
        - Args:
        -     strategy_type: Strategy type
        - 
        - Returns:
        -     List of matching strategies
      - def register_strategy(.)
        - Kommentar: Register a custom strategy.
        - 
        - Args:
        -     name: Strategy name
        -     strategy: Strategy definition
      - def list_strategies(.)
        - Kommentar: List all strategy names.
        - 
        - Returns:
        -     List of strategy names
    - Kommentar: Re-export types for backward compatibility
  - strategy_definitions.py
    - Class: StrategyType
      - Kommentar: Built-in strategy types.
    - Class: EntryRule
      - Kommentar: Entry rule configuration.
    - Class: ExitRule
      - Kommentar: Exit rule configuration.
    - Class: StrategyDefinition
      - Kommentar: Complete strategy definition with rules.
      - def is_applicable(.)
        - Kommentar: Check if strategy is applicable for current regime.
  - strategy_evaluator.py
    - Class: StrategyEvaluator
      - Kommentar: Evaluator for strategy performance.
      - 
      - Provides methods for calculating performance metrics
      - and running walk-forward analysis.
      - def __init__(.)
        - Kommentar: Initialize evaluator.
        - 
        - Args:
        -     robustness_gate: Robustness validation criteria
        -     walk_forward_config: Walk-forward analysis configuration
      - def calculate_metrics(.)
        - Kommentar: Calculate performance metrics from trade results.
        - 
        - Args:
        -     trades: List of trade results
        -     initial_capital: Starting capital for drawdown calculations
        -     sample_type: "in_sample" or "out_of_sample"
        - 
        - Returns:
        -     PerformanceMetrics
      - def _calculate_drawdown(.)
        - Kommentar: Calculate maximum drawdown.
      - def _calculate_consecutive_streaks(.)
        - Kommentar: Calculate consecutive win/loss streaks.
      - def _calculate_risk_ratios(.)
        - Kommentar: Calculate Sharpe, Sortino, Calmar ratios.
      - def validate_robustness(.)
        - Kommentar: Validate metrics against robustness criteria.
        - 
        - Args:
        -     metrics: Performance metrics to validate
        -     gate: Custom robustness gate (uses default if None)
        - 
        - Returns:
        -     (is_robust, list of failure reasons)
      - def run_walk_forward(.)
        - Kommentar: Run walk-forward analysis on strategy.
        - 
        - Args:
        -     strategy: Strategy definition
        -     all_trades: All historical trades for this strategy
        -     config: Walk-forward configuration
        - 
        - Returns:
        -     WalkForwardResult with in-sample and out-of-sample metrics
      - def _simple_train_test_split(.)
        - Kommentar: Simple 70/30 train/test split when not enough history.
      - def _generate_rolling_periods(.)
        - Kommentar: Generate rolling window periods.
      - def _generate_anchored_periods(.)
        - Kommentar: Generate anchored (expanding) window periods.
      - def _calculate_oos_degradation(.)
        - Kommentar: Calculate performance degradation from IS to OOS.
        - 
        - Returns:
        -     Degradation ratio (0 = same, 0.3 = 30% worse)
      - def _aggregate_metrics(.)
        - Kommentar: Aggregate metrics from multiple periods.
      - def compare_strategies(.)
        - Kommentar: Rank strategies by composite score.
        - 
        - Args:
        -     results: Walk-forward results for strategies
        - 
        - Returns:
        -     List of (strategy_name, score) sorted by score descending
    - Kommentar: Import types from evaluator_types
    - Kommentar: Re-export for backward compatibility
  - strategy_selector.py
    - Class: SelectionResult
      - Kommentar: Result of strategy selection.
    - Class: SelectionSnapshot
      - Kommentar: Snapshot of strategy selection for persistence.
    - Class: StrategySelector
      - Kommentar: Daily strategy selector.
      - 
      - Selects the best strategy for current market conditions
      - using walk-forward validation and regime matching.
      - def __init__(.)
        - Kommentar: Initialize strategy selector.
        - 
        - Args:
        -     catalog: Strategy catalog (creates default if None)
        -     evaluator: Strategy evaluator (creates default if None)
        -     snapshot_dir: Directory for selection snapshots
        -     allow_intraday_switch: Allow strategy switch within day
        -     require_regime_flip_for_switch: Only switch on significant regime change
      - def select_strategy(.)
        - Kommentar: Select best strategy for current conditions.
        - 
        - Args:
        -     regime: Current market regime
        -     symbol: Trading symbol
        -     force: Force re-selection even if locked
        - 
        - Returns:
        -     SelectionResult with selected strategy
      - def _should_reselect(.)
        - Kommentar: Check if we should re-select strategy.
      - def _create_selection_result(.)
        - Kommentar: Create selection result.
      - def _create_fallback_result(.)
        - Kommentar: Create fallback selection result.
      - def _save_selection(.)
        - Kommentar: Save selection snapshot.
      - def record_trade(.)
        - Kommentar: Record a trade result for strategy evaluation.
        - 
        - Args:
        -     strategy_name: Name of strategy that generated trade
        -     trade: Trade result
      - def load_trade_history(.)
        - Kommentar: Load historical trades for a strategy.
        - 
        - Args:
        -     strategy_name: Strategy name
        -     trades: Historical trades
      - def get_trade_history(.)
        - Kommentar: Get trade history for a strategy.
        - 
        - Args:
        -     strategy_name: Strategy name
        - 
        - Returns:
        -     List of trade results
      - def get_current_selection(.)
        - Kommentar: Get current strategy selection.
        - 
        - Returns:
        -     Current selection or None
      - def get_current_strategy(.)
        - Kommentar: Get current selected strategy definition.
        - 
        - Returns:
        -     StrategyDefinition or None
      - def is_trading_allowed(.)
        - Kommentar: Check if trading is allowed with current selection.
        - 
        - Returns:
        -     True if a strategy is selected
      - def get_applicable_strategies(.)
        - Kommentar: Get strategies applicable for regime.
        - 
        - Args:
        -     regime: Market regime
        - 
        - Returns:
        -     List of strategy names
      - def get_strategy_info(.)
        - Kommentar: Get detailed info about a strategy.
        - 
        - Args:
        -     strategy_name: Strategy name
        - 
        - Returns:
        -     Strategy info dict or None
      - def get_regime_strategies(.)
        - Kommentar: Get strategy mapping per regime.
        - 
        - Returns:
        -     Dict mapping regime to applicable strategies
      - def suggest_strategy(.)
        - Kommentar: Quick suggestion without full evaluation.
        - 
        - Args:
        -     regime: Current regime
        - 
        - Returns:
        -     Suggested strategy name or None
  - strategy_templates.py
    - Class: StrategyTemplatesMixin
      - Kommentar: Mixin providing strategy template creation methods.
      - def _create_trend_following_conservative(.)
        - Kommentar: Conservative trend following strategy.
      - def _create_trend_following_aggressive(.)
        - Kommentar: Aggressive trend following for strong trends.
      - def _create_mean_reversion_bb(.)
        - Kommentar: Mean reversion using Bollinger Bands.
      - def _create_mean_reversion_rsi(.)
        - Kommentar: Mean reversion using RSI extremes.
      - def _create_breakout_volatility(.)
        - Kommentar: Breakout strategy for volatility expansion.
      - def _create_breakout_momentum(.)
        - Kommentar: Momentum breakout strategy.
      - def _create_momentum_macd(.)
        - Kommentar: MACD-based momentum strategy.
      - def _create_scalping_range(.)
        - Kommentar: Scalping strategy for tight ranges.
  - __init__.py
    - Kommentar: Models
    - Kommentar: Database Manager
  - database.py
    - Class: DatabaseManager
      - Kommentar: Manages database connections and operations.
      - def __init__(.)
        - Kommentar: Initialize the database manager.
        - 
        - Args:
        -     config: Database configuration
      - def initialize(.)
        - Kommentar: Initialize the database connection and create tables.
      - def create_tables(.)
        - Kommentar: Create all database tables.
      - def _create_timescale_hypertables(.)
        - Kommentar: Create TimescaleDB hypertables for time-series data.
      - def drop_tables(.)
        - Kommentar: Drop all database tables. USE WITH CAUTION!
      - def session(.)
        - Kommentar: Provide a transactional scope for database operations.
        - 
        - Yields:
        -     Database session
        - 
        - Example:
        -     with db_manager.session() as session:
        -         session.add(order)
        -         session.commit()
      - def get_session(.)
        - Kommentar: Get a new database session.
        - 
        - Returns:
        -     Database session
        - 
        - Note:
        -     Caller is responsible for closing the session.
      - def execute_raw(.)
        - Kommentar: Execute a raw SQL query.
        - 
        - Args:
        -     query: SQL query string
        -     params: Query parameters
        - 
        - Returns:
        -     Query result
      - def backup(.)
        - Kommentar: Create a database backup (SQLite only).
        - 
        - Args:
        -     backup_path: Path to save the backup
      - def vacuum(.)
        - Kommentar: Perform database maintenance (VACUUM for SQLite).
      - def get_table_stats(.)
        - Kommentar: Get statistics about database tables.
        - 
        - Returns:
        -     Dictionary with table names and row counts
      - def cleanup_old_data(.)
        - Kommentar: Clean up old data from the database.
        - 
        - Args:
        -     days_to_keep: Number of days of data to keep
      - def close(.)
        - Kommentar: Close the database connection.
    - def initialize_database(.)
      - Kommentar: Initialize the global database manager.
      - 
      - Args:
      -     config: Database configuration
      - 
      - Returns:
      -     Initialized database manager
    - def get_db_manager(.)
      - Kommentar: Get the global database manager.
      - 
      - Returns:
      -     Database manager instance
      - 
      - Raises:
      -     RuntimeError: If database not initialized
    - Kommentar: Global database manager instance
  - models.py
    - Class: OrderStatus
      - Kommentar: Order status enumeration.
    - Class: OrderSide
      - Kommentar: Order side (buy/sell).
    - Class: OrderType
      - Kommentar: Order type enumeration.
    - Class: TimeInForce
      - Kommentar: Time in force for orders.
    - Class: AlertPriority
      - Kommentar: Alert priority levels.
    - Class: MarketBar
      - Kommentar: 1-second market data bars.
    - Class: Order
      - Kommentar: Trading orders.
    - Class: Execution
      - Kommentar: Order executions/fills.
    - Class: Position
      - Kommentar: Current positions.
    - Class: Alert
      - Kommentar: Trading alerts and notifications.
    - Class: Strategy
      - Kommentar: Strategy configurations and parameters.
    - Class: BacktestResult
      - Kommentar: Backtesting results.
    - Class: AITelemetry
      - Kommentar: AI API usage telemetry and cost tracking.
    - Class: AICache
      - Kommentar: Cache for AI responses to reduce API calls.
    - Class: AuditLog
      - Kommentar: Comprehensive audit trail for all trading activities.
    - Class: SystemMetrics
      - Kommentar: System performance and health metrics.
  - __init__.py
  - app.py
    - Class: TradingApplication
      - Kommentar: Main application window for OrderPilot-AI.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the user interface.
      - def create_central_widget(.)
        - Kommentar: Create the central widget with tabs.
      - def create_dock_widgets(.)
        - Kommentar: Create dock widgets for additional panels.
      - def create_status_bar(.)
        - Kommentar: Create the status bar.
      - def setup_event_handlers(.)
        - Kommentar: Setup event bus handlers.
      - def _on_market_data_error_event(.)
        - Kommentar: Handle market data error from background thread.
      - def _show_market_data_error_popup(.)
        - Kommentar: Show error popup in main thread (thread-safe).
      - def setup_timers(.)
        - Kommentar: Setup update timers.
      - def initialize_services(.)
        - Kommentar: Initialize application services.
      - def apply_theme(.)
        - Kommentar: Apply a theme to the application.
      - def load_settings(.)
        - Kommentar: Load application settings.
      - def save_settings(.)
        - Kommentar: Save application settings.
      - def open_chart_popup(.)
        - Kommentar: Open a popup chart window for the symbol.
      - def on_watchlist_symbol_added(.)
        - Kommentar: Handle symbol added to watchlist.
      - def on_order_placed(.)
        - Kommentar: Handle order placement.
      - def on_broker_connected(.)
        - Kommentar: Handle broker connection event.
      - def on_broker_disconnected(.)
        - Kommentar: Handle broker disconnection event.
      - def on_order_filled(.)
        - Kommentar: Handle order fill event.
      - def on_alert_triggered(.)
        - Kommentar: Handle alert trigger event.
      - def update_time(.)
        - Kommentar: Update time display.
      - def update_dashboard(.)
        - Kommentar: Update dashboard with latest data.
      - def update_account_info(.)
        - Kommentar: Update account information display.
      - def on_data_provider_changed(.)
        - Kommentar: Handle market data provider change.
      - def refresh_market_data(.)
        - Kommentar: Refresh market data for all visible widgets.
      - def closeEvent(.)
        - Kommentar: Handle application close event.
    - def main(.)
      - Kommentar: Main application entry point.
    - Kommentar: qasync for asyncio integration
    - Kommentar: PyQt6 imports
    - Kommentar: Application imports
    - Kommentar: UI component imports
  - __init__.py
  - actions_mixin.py
    - Class: ActionsMixin
      - Kommentar: Mixin providing dialog and action methods for TradingApplication.
      - def show_order_dialog(.)
        - Kommentar: Show the order placement dialog.
      - def show_settings_dialog(.)
        - Kommentar: Show the settings dialog.
      - def show_backtest_dialog(.)
        - Kommentar: Show the backtest dialog.
      - def show_ai_backtest_dialog(.)
        - Kommentar: Show the AI-powered backtest analysis dialog.
      - def show_parameter_optimization_dialog(.)
        - Kommentar: Show the parameter optimization dialog.
      - def show_ai_monitor(.)
        - Kommentar: Show AI usage monitor.
      - def show_pattern_db_dialog(.)
        - Kommentar: Show the pattern database management dialog.
      - def reset_toolbars_and_docks(.)
        - Kommentar: Reset all toolbars and dock widgets to their default positions.
      - def show_about(.)
        - Kommentar: Show about dialog.
  - broker_mixin.py
    - Class: BrokerMixin
      - Kommentar: Mixin providing broker connection functionality for TradingApplication.
      - def connect_broker(.)
        - Kommentar: Connect to the selected broker.
      - def disconnect_broker(.)
        - Kommentar: Disconnect from the broker.
      - def _on_trading_mode_changed(.)
        - Kommentar: Handle trading mode changes.
      - def initialize_realtime_streaming(.)
        - Kommentar: Initialize real-time market data streaming.
      - def _is_crypto_symbol(.)
        - Kommentar: Check if symbol is a cryptocurrency pair.
      - def toggle_live_data(.)
        - Kommentar: Toggle live market data on/off.
      - def analyze_order_with_ai(.)
        - Kommentar: AI hook for order analysis.
      - def _subscribe_symbol_to_stream(.)
        - Kommentar: Subscribe a symbol to the appropriate real-time stream.
  - menu_mixin.py
    - Class: MenuMixin
      - Kommentar: Mixin providing menu bar functionality for TradingApplication.
      - def create_menu_bar(.)
        - Kommentar: Create the application menu bar.
  - toolbar_mixin.py
    - Class: ToolbarMixin
      - Kommentar: Mixin providing toolbar functionality for TradingApplication.
      - def create_toolbar(.)
        - Kommentar: Create the application toolbar.
      - def update_data_provider_list(.)
        - Kommentar: Update the list of available market data providers.
  - __init__.py
  - chart_adapter.py
    - Class: ChartAdapter
      - Kommentar: Adapter for converting BacktestResult to Lightweight Charts format.
      - 
      - Provides conversion methods for candlestick data, equity curves, indicators,
      - and trade markers compatible with TradingView Lightweight Charts.
      - def backtest_result_to_chart_data(.)
        - Kommentar: Convert comprehensive BacktestResult to Lightweight Charts JSON format.
        - 
        - Args:
        -     result: BacktestResult instance with bars, trades, equity curve, etc.
        - 
        - Returns:
        -     Dictionary with all chart data ready for Lightweight Charts:
        -     {
        -         'candlesticks': [...],      # OHLC data
        -         'equity_curve': [...],      # Account equity over time
        -         'markers': [...],           # Entry/Exit markers
        -         'indicators': {...},        # Technical indicators
        -         'metadata': {...}           # Chart metadata
        -     }
        - 
        - Example:
        -     >>> adapter = ChartAdapter()
        -     >>> chart_data = adapter.backtest_result_to_chart_data(backtest_result)
        -     >>> json_str = json.dumps(chart_data)
      - def bars_to_candlesticks(.)
        - Kommentar: Convert Bar list to Lightweight Charts candlestick format.
        - 
        - Args:
        -     bars: List of Bar instances
        - 
        - Returns:
        -     List of candlestick dictionaries:
        -     [
        -         {time: '2024-01-01', open: 100, high: 105, low: 99, close: 102},
        -         ...
        -     ]
      - def equity_to_line_series(.)
        - Kommentar: Convert EquityPoint list to Lightweight Charts line series format.
        - 
        - Args:
        -     equity_curve: List of EquityPoint instances
        - 
        - Returns:
        -     List of line series data points:
        -     [
        -         {time: '2024-01-01', value: 10000},
        -         ...
        -     ]
      - def build_markers_from_trades(.)
        - Kommentar: Build entry/exit markers from Trade list.
        - 
        - Args:
        -     trades: List of Trade instances
        -     show_stop_loss: Whether to show stop loss levels as markers
        -     show_take_profit: Whether to show take profit levels as markers
        - 
        - Returns:
        -     List of marker dictionaries for Lightweight Charts:
        -     [
        -         {
        -             time: '2024-01-01',
        -             position: 'belowBar',  # or 'aboveBar'
        -             color: 'green',
        -             shape: 'arrowUp',      # or 'arrowDown', 'circle'
        -             text: 'Buy @ 100.00'
        -         },
        -         ...
        -     ]
      - def _build_entry_marker(.)
        - Kommentar: Build entry marker for a trade.
        - 
        - Args:
        -     trade: Trade instance
        - 
        - Returns:
        -     Entry marker dictionary
      - def _build_exit_marker(.)
        - Kommentar: Build exit marker for a trade.
        - 
        - Args:
        -     trade: Trade instance (must have exit_time and exit_price)
        - 
        - Returns:
        -     Exit marker dictionary
      - def _build_sl_tp_marker(.)
        - Kommentar: Build stop loss or take profit marker.
        - 
        - Args:
        -     trade: Trade instance
        -     marker_type: Type of marker ('stop_loss' or 'take_profit')
        -     price: SL or TP price level
        - 
        - Returns:
        -     SL/TP marker dictionary
      - def indicators_to_series(.)
        - Kommentar: Convert indicator data to Lightweight Charts line series.
        - 
        - Args:
        -     indicators: Dictionary mapping indicator names to time-series data
        -                {name: [(datetime, value), ...]}
        - 
        - Returns:
        -     Dictionary of line series data:
        -     {
        -         'SMA_20': [{time: '2024-01-01', value: 100.5}, ...],
        -         'RSI': [{time: '2024-01-01', value: 65.2}, ...],
        -         ...
        -     }
      - def _format_time(.)
        - Kommentar: Format datetime for Lightweight Charts.
        - 
        - Lightweight Charts accepts:
        - - UNIX timestamp (seconds)
        - - YYYY-MM-DD for daily data
        - - YYYY-MM-DD HH:MM:SS for intraday
        - 
        - Args:
        -     dt: Datetime object
        - 
        - Returns:
        -     Formatted time string
      - def to_json(.)
        - Kommentar: Convert chart data to JSON string.
        - 
        - Args:
        -     chart_data: Chart data dictionary from backtest_result_to_chart_data()
        -     indent: Optional indentation for pretty printing
        - 
        - Returns:
        -     JSON string
        - 
        - Example:
        -     >>> json_str = ChartAdapter.to_json(chart_data, indent=2)
        -     >>> with open('chart.json', 'w') as f:
        -     ...     f.write(json_str)
      - def validate_chart_data(.)
        - Kommentar: Validate chart data structure.
        - 
        - Args:
        -     chart_data: Chart data dictionary
        - 
        - Returns:
        -     Tuple of (is_valid, error_messages)
        - 
        - Example:
        -     >>> is_valid, errors = ChartAdapter.validate_chart_data(chart_data)
        -     >>> if not is_valid:
        -     ...     print("Validation errors:", errors)
  - chart_bridge.py
    - Class: ChartBridge
      - Kommentar: Qt WebChannel bridge for chart communication.
      - 
      - Enables Python ↔ JavaScript communication for chart updates:
      - - Python → JS: Emit signals with chart data (JSON)
      - - JS → Python: Call slots to request data or perform actions
      - 
      - Signals:
      -     chartDataReady: Emitted when chart data is ready (JSON string)
      -     error: Emitted when an error occurs (error message)
      -     statusChanged: Emitted when bridge status changes (status message)
      - 
      - Example Usage:
      -     # In Python (PyQt6):
      -     bridge = ChartBridge()
      -     channel = QWebChannel()
      -     channel.registerObject("chartBridge", bridge)
      -     web_view.page().setWebChannel(channel)
      - 
      -     # Load backtest result
      -     bridge.loadBacktestResult(result.model_dump_json())
      - 
      -     # In JavaScript:
      -     new QWebChannel(qt.webChannelTransport, function(channel) {
      -         var chartBridge = channel.objects.chartBridge;
      - 
      -         chartBridge.chartDataReady.connect(function(jsonData) {
      -             var data = JSON.parse(jsonData);
      -             renderChart(data);
      -         });
      -     });
      - def __init__(.)
        - Kommentar: Initialize ChartBridge.
        - 
        - Args:
        -     parent: Optional parent QObject
      - def loadBacktestResult(.)
        - Kommentar: Load and display backtest result from JSON.
        - 
        - Called from JavaScript to load backtest data.
        - 
        - Args:
        -     result_json: BacktestResult as JSON string
        - 
        - Emits:
        -     chartDataReady: When conversion is successful
        -     error: When conversion fails
      - def loadBacktestResultObject(.)
        - Kommentar: Load and display backtest result from Python object.
        - 
        - Called from Python code to display backtest.
        - 
        - Args:
        -     result: BacktestResult instance
        - 
        - Emits:
        -     chartDataReady: When conversion is successful
        -     error: When conversion fails
      - def loadLiveData(.)
        - Kommentar: Load and display live market data for a symbol.
        - 
        - Called from JavaScript to request live data.
        - 
        - Args:
        -     symbol: Trading symbol (e.g., "AAPL")
        - 
        - Emits:
        -     chartDataReady: When data is loaded
        -     error: When loading fails
        - 
        - Note:
        -     This is a placeholder. In a real implementation, this would:
        -     1. Fetch live bars from market data provider
        -     2. Convert to chart format
        -     3. Emit chartDataReady signal
      - def updateTrade(.)
        - Kommentar: Update chart with new trade marker (for live trading).
        - 
        - Called from JavaScript or Python when a trade is executed.
        - 
        - Args:
        -     trade_json: Trade as JSON string
        - 
        - Emits:
        -     chartDataReady: With updated markers
        -     error: When update fails
        - 
        - Note:
        -     This updates only the markers, not the full chart.
      - def getCurrentSymbol(.)
        - Kommentar: Get currently displayed symbol.
        - 
        - Returns:
        -     Symbol string or empty string if none loaded
      - def getMetricsSummary(.)
        - Kommentar: Get summary of current backtest metrics as JSON.
        - 
        - Returns:
        -     JSON string with key metrics or empty object
      - def clearChart(.)
        - Kommentar: Clear the current chart.
        - 
        - Emits:
        -     chartDataReady: With empty data
        -     statusChanged: With clear message
      - def toggleMarkers(.)
        - Kommentar: Toggle trade markers on/off.
        - 
        - Args:
        -     show: True to show markers, False to hide
        - 
        - Emits:
        -     chartDataReady: With updated data
      - def toggleIndicator(.)
        - Kommentar: Toggle specific indicator on/off.
        - 
        - Args:
        -     indicator_name: Name of indicator (e.g., "SMA_20")
        -     show: True to show, False to hide
        - 
        - Emits:
        -     chartDataReady: With updated indicators
      - def _convert_and_emit_chart_data(.)
        - Kommentar: Convert BacktestResult to chart data and emit signal.
        - 
        - Args:
        -     result: BacktestResult to convert
        - 
        - Emits:
        -     chartDataReady: With converted chart data
        -     statusChanged: With status message
        -     error: If conversion fails
  - chart_window_manager.py
    - Class: ChartWindowManager
      - Kommentar: Manages popup chart windows.
      - def __init__(.)
        - Kommentar: Initialize chart window manager.
        - 
        - Args:
        -     history_manager: HistoryManager instance for loading data
        -     parent: Parent widget for the windows
      - def open_or_focus_chart(.)
        - Kommentar: Open a chart window for the symbol, or focus if already open.
        - 
        - Args:
        -     symbol: Trading symbol
        -     data_provider: Optional data provider to use
        - 
        - Returns:
        -     ChartWindow instance
      - def _on_window_closed(.)
        - Kommentar: Handle window closed signal.
        - 
        - Args:
        -     symbol: Symbol of the closed window
      - def close_window(.)
        - Kommentar: Close a chart window.
        - 
        - Args:
        -     symbol: Symbol of the window to close
      - def close_all_windows(.)
        - Kommentar: Close all open chart windows.
      - def get_open_symbols(.)
        - Kommentar: Get list of symbols with open chart windows.
        - 
        - Returns:
        -     List of symbol strings
      - def has_open_window(.)
        - Kommentar: Check if a window is open for the symbol.
        - 
        - Args:
        -     symbol: Trading symbol
        - 
        - Returns:
        -     True if window is open, False otherwise
      - def get_active_symbol(.)
        - Kommentar: Get the symbol of the currently focused/active chart window.
        - 
        - Returns:
        -     Symbol string if an active chart exists, None otherwise
      - def open_chart(.)
        - Kommentar: Open a chart window (alias for open_or_focus_chart).
        - 
        - This method provides compatibility with code that used EnhancedChartWindow.
        - 
        - Args:
        -     symbol: Trading symbol
        -     chart_type: Chart type (ignored, uses TradingView)
        - 
        - Returns:
        -     ChartWindow instance
      - def close_all_charts(.)
        - Kommentar: Close all open chart windows (alias for close_all_windows).
    - def get_chart_window_manager(.)
      - Kommentar: Get or create the singleton ChartWindowManager instance.
      - 
      - This function provides a global access point to the ChartWindowManager,
      - migrated from enhanced_chart_window.py.
      - 
      - Args:
      -     history_manager: HistoryManager instance (only used on first call)
      -     parent: Parent widget (only used on first call)
      - 
      - Returns:
      -     ChartWindowManager singleton instance
    - Kommentar: Singleton instance
  - __init__.py
  - ai_backtest_dialog.py
    - Class: AIBacktestDialog
      - Kommentar: Enhanced backtest dialog with AI analysis.
      - def __init__(.)
        - Kommentar: Initialize AI Backtest Dialog.
        - 
        - Args:
        -     parent: Parent widget
        -     current_symbol: Currently selected symbol from chart (optional)
      - def init_ui(.)
        - Kommentar: Initialize the UI.
      - def _create_config_tab(.)
        - Kommentar: Create configuration tab.
      - def _create_results_tab(.)
        - Kommentar: Create results tab.
      - def _create_ai_tab(.)
        - Kommentar: Create AI analysis tab.
      - def _create_chart_tab(.)
        - Kommentar: Create chart visualization tab with BacktestChartWidget.
      - def run_backtest(.)
        - Kommentar: Run the backtest.
      - def _create_mock_result(.)
        - Kommentar: Create mock backtest result.
      - def _display_results(.)
        - Kommentar: Display backtest results.
      - def run_ai_review(.)
        - Kommentar: Run AI analysis on backtest results.
      - def _display_ai_analysis(.)
        - Kommentar: Display AI analysis results.
      - def _add_section(.)
        - Kommentar: Add a section with title and content.
      - def _add_list_section(.)
        - Kommentar: Add a section with a bullet-point list.
      - def _add_dict_section(.)
        - Kommentar: Add a section displaying dictionary data.
      - def _create_improvement_widget(.)
        - Kommentar: Create widget for improvement suggestion.
      - def _open_chart_popup(.)
        - Kommentar: Open chart popup window with backtest results.
        - 
        - Args:
        -     result: BacktestResult to display
      - def _show_no_api_key_message(.)
        - Kommentar: Show message when no API key is configured.
  - backtest_dialog.py
    - Class: BacktestDialog
      - Kommentar: Dialog for running backtests.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the backtest dialog UI.
      - def run_backtest(.)
        - Kommentar: Run the backtest.
      - def _run_backtest_simulation(.)
        - Kommentar: Simulate backtest execution.
      - def export_results(.)
        - Kommentar: Export backtest results.
  - optimization_tabs_mixin.py
    - Class: OptimizationTabsMixin
      - Kommentar: Mixin providing tab creation methods for ParameterOptimizationDialog.
      - def _create_config_tab(.)
        - Kommentar: Create configuration tab.
      - def _update_combination_count(.)
        - Kommentar: Update total combination count label.
      - def _create_progress_tab(.)
        - Kommentar: Create progress monitoring tab.
      - def _create_results_tab(.)
        - Kommentar: Create results display tab.
      - def _create_ai_tab(.)
        - Kommentar: Create AI insights tab.
      - def _create_chart_tab(.)
        - Kommentar: Create chart visualization tab for best result.
  - order_dialog.py
    - Class: OrderDialog
      - Kommentar: Dialog for placing orders with AI analysis.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the order dialog UI.
      - def on_order_type_changed(.)
        - Kommentar: Handle order type changes.
      - def analyze_order(.)
        - Kommentar: Analyze order with AI.
      - def _get_ai_analysis(.)
        - Kommentar: Get AI analysis for the order.
      - def place_order(.)
        - Kommentar: Place the order via broker.
  - parameter_optimization_dialog.py
    - Class: ParameterOptimizationDialog
      - Kommentar: Dialog for AI-guided parameter optimization.
      - def __init__(.)
        - Kommentar: Initialize Parameter Optimization Dialog.
        - 
        - Args:
        -     parent: Parent widget
        -     current_symbol: Currently selected symbol from chart (optional)
      - def init_ui(.)
        - Kommentar: Initialize UI.
      - def start_optimization(.)
        - Kommentar: Start parameter optimization.
      - def _run_real_backtest(.)
        - Kommentar: Run REAL backtest with actual market data (NO MOCK!).
        - 
        - Args:
        -     params: Strategy parameters to test
        - 
        - Returns:
        -     BacktestResult with real metrics from backtrader
      - def _display_results(.)
        - Kommentar: Display optimization results.
      - def _open_chart_popup(.)
        - Kommentar: Open chart popup window with backtest results.
        - 
        - Args:
        -     result: BacktestResult to display
      - def _display_ai_insights(.)
        - Kommentar: Display AI insights.
      - def log_progress(.)
        - Kommentar: Log progress message.
      - def stop_optimization(.)
        - Kommentar: Stop optimization.
  - pattern_db_dialog.py
    - Class: PatternDatabaseDialog
      - Kommentar: Dialog for managing the pattern database.
      - def __init__(.)
      - def _setup_ui(.)
        - Kommentar: Set up the dialog UI.
      - def _select_all(.)
        - Kommentar: Select or deselect all items in a list.
      - def _add_custom_crypto(.)
        - Kommentar: Add a custom crypto symbol.
      - def _load_initial_state(.)
        - Kommentar: Load initial state on dialog open.
      - def _update_docker_status(.)
        - Kommentar: Update Docker status display.
      - def _start_docker(.)
        - Kommentar: Start the existing Qdrant Docker container (from RAG-System).
      - def _stop_docker(.)
        - Kommentar: Stop the Qdrant Docker container.
      - def _restart_docker(.)
        - Kommentar: Restart the Qdrant Docker container.
      - def _refresh_stats(.)
        - Kommentar: Refresh database statistics.
      - def _start_build(.)
        - Kommentar: Start building the database.
      - def _run_build(.)
        - Kommentar: Run the build worker.
      - def _cancel_build(.)
        - Kommentar: Cancel the build process.
      - def _on_build_finished(.)
        - Kommentar: Handle build completion.
      - def _update_progress(.)
        - Kommentar: Update progress bar.
      - def _log(.)
        - Kommentar: Add message to log.
      - def _clear_database(.)
        - Kommentar: Clear the entire database.
      - def _run_search_test(.)
        - Kommentar: Run a search test.
      - def closeEvent(.)
        - Kommentar: Handle dialog close.
    - Kommentar: Docker configuration - uses existing Qdrant from RAG system
    - Kommentar: Existing container
  - pattern_db_tabs_mixin.py
    - Class: PatternDbTabsMixin
      - Kommentar: Mixin providing tab creation methods for PatternDatabaseDialog.
      - def _create_status_tab(.)
        - Kommentar: Create the status tab.
      - def _create_build_tab(.)
        - Kommentar: Create the build database tab.
      - def _create_search_tab(.)
        - Kommentar: Create the search test tab.
    - Kommentar: Constants (must match pattern_db_dialog.py)
  - pattern_db_worker.py
    - Class: DatabaseBuildWorker
      - Kommentar: Worker thread for building the pattern database.
      - def __init__(.)
      - def cancel(.)
        - Kommentar: Cancel the build process.
      - def run(.)
        - Kommentar: Run the database build in a separate thread.
      - def _build_async(.)
        - Kommentar: Async build process.
  - settings_dialog.py
    - Class: SettingsDialog
      - Kommentar: Application settings dialog.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the settings dialog UI.
      - def load_current_settings(.)
        - Kommentar: Load current settings from QSettings.
      - def save_settings(.)
        - Kommentar: Save settings to QSettings and configuration.
      - def _save_api_keys(.)
        - Kommentar: Save API keys to secure keyring.
      - def _save_market_data_settings(.)
        - Kommentar: Save market data provider settings.
  - settings_tabs_mixin.py
    - Class: SettingsTabsMixin
      - Kommentar: Mixin providing tab creation methods for SettingsDialog.
      - def _create_general_tab(.)
        - Kommentar: Create general settings tab.
      - def _create_trading_tab(.)
        - Kommentar: Create trading settings tab.
      - def _create_broker_tab(.)
        - Kommentar: Create broker settings tab.
      - def _create_market_data_tab(.)
        - Kommentar: Create market data settings tab.
      - def _create_ai_tab(.)
        - Kommentar: Create AI settings tab.
      - def _create_notifications_tab(.)
        - Kommentar: Create notifications settings tab.
  - icons.py
    - Class: IconProvider
      - Kommentar: Provides themed icons for the application.
      - def __init__(.)
        - Kommentar: Initialize icon provider.
        - 
        - Args:
        -     theme: Theme name ("dark" or "light")
      - def _update_colors(.)
        - Kommentar: Update colors based on theme.
      - def set_theme(.)
        - Kommentar: Change theme and clear cache.
        - 
        - Args:
        -     theme: Theme name ("dark" or "light")
      - def get_icon(.)
        - Kommentar: Get icon by name.
        - 
        - Args:
        -     name: Icon name
        - 
        - Returns:
        -     QIcon instance
      - def get_available_icons(.)
        - Kommentar: Get list of available icon names.
        - 
        - Returns:
        -     List of icon names
    - def _svg_to_icon(.)
      - Kommentar: Convert SVG string to QIcon with color substitution.
      - 
      - Args:
      -     svg_data: SVG XML string with {{primary}} and {{secondary}} placeholders
      -     primary_color: Primary color (default: white)
      -     secondary_color: Secondary color (default: blue)
      - 
      - Returns:
      -     QIcon with rendered SVG
    - def get_icon(.)
      - Kommentar: Get icon by name using global provider.
      - 
      - Args:
      -     name: Icon name
      - 
      - Returns:
      -     QIcon instance
    - def set_icon_theme(.)
      - Kommentar: Set global icon theme.
      - 
      - Args:
      -     theme: Theme name ("dark" or "light")
    - def get_available_icons(.)
      - Kommentar: Get list of available icon names.
      - 
      - Returns:
      -     List of icon names
    - Kommentar: SVG icon templates
    - Kommentar: Global icon provider instance
  - themes.py
    - Class: ThemeManager
      - Kommentar: Manages application themes.
      - def __init__(.)
        - Kommentar: Initialize theme manager.
      - def _create_dark_theme(.)
        - Kommentar: Create dark theme stylesheet.
      - def _create_light_theme(.)
        - Kommentar: Create light theme stylesheet.
      - def get_dark_theme(.)
        - Kommentar: Get dark theme stylesheet.
      - def get_light_theme(.)
        - Kommentar: Get light theme stylesheet.
      - def get_theme(.)
        - Kommentar: Get theme by name.
  - __init__.py
  - alerts.py
    - Class: AlertsWidget
      - Kommentar: Widget for displaying trading alerts.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the alerts UI.
      - def setup_event_handlers(.)
        - Kommentar: Setup event bus handlers.
      - def on_alert_triggered(.)
        - Kommentar: Handle alert triggered event.
      - def on_order_rejected(.)
        - Kommentar: Handle order rejected event.
      - def on_app_error(.)
        - Kommentar: Handle application error event.
      - def add_alert(.)
        - Kommentar: Add a new alert to the list.
  - backtest_chart_widget.py
    - Class: BacktestChartWidget
      - Kommentar: Chart widget for displaying backtest results.
      - 
      - Uses Qt WebChannel to communicate between Python and JavaScript,
      - displaying interactive charts with TradingView Lightweight Charts.
      - 
      - Features:
      -     - Display backtest candlesticks
      -     - Show equity curve
      -     - Trade markers (entry/exit with P&L)
      -     - Technical indicators
      -     - Toggle markers and indicators
      -     - Responsive and interactive
      - 
      - Example:
      -     widget = BacktestChartWidget()
      -     widget.load_backtest_result(backtest_result)
      - def __init__(.)
        - Kommentar: Initialize backtest chart widget.
        - 
        - Args:
        -     parent: Optional parent widget
      - def _setup_ui(.)
        - Kommentar: Setup user interface.
      - def _create_toolbar(.)
        - Kommentar: Create toolbar with controls.
        - 
        - Returns:
        -     QToolBar instance
      - def _setup_webchannel(.)
        - Kommentar: Setup Qt WebChannel for Python ↔ JavaScript communication.
      - def _setup_connections(.)
        - Kommentar: Setup signal/slot connections.
      - def _load_html(.)
        - Kommentar: Load HTML template with Lightweight Charts.
      - def load_backtest_result(.)
        - Kommentar: Load and display backtest result.
        - 
        - Args:
        -     result: BacktestResult instance to display
      - def clear_chart(.)
        - Kommentar: Clear the current chart.
      - def toggle_markers(.)
        - Kommentar: Toggle trade markers visibility.
        - 
        - Args:
        -     show: True to show markers, False to hide
      - def _on_toggle_markers(.)
        - Kommentar: Handle toggle markers button click.
      - def _on_clear_chart(.)
        - Kommentar: Handle clear chart button click.
      - def _on_chart_data_ready(.)
        - Kommentar: Handle chart data ready signal from bridge.
        - 
        - Args:
        -     json_data: Chart data as JSON string
      - def _on_bridge_error(.)
        - Kommentar: Handle error from bridge.
        - 
        - Args:
        -     error_msg: Error message
      - def _on_status_changed(.)
        - Kommentar: Handle status change from bridge.
        - 
        - Args:
        -     status_msg: Status message
      - def closeEvent(.)
        - Kommentar: Handle widget close event.
        - 
        - Args:
        -     event: Close event
  - chart_js_template.py
    - Kommentar: HTML template for TradingView Lightweight Charts
    - Kommentar: This is extracted from embedded_tradingview_chart.py to reduce file size.
    - Kommentar: The template provides:
    - Kommentar: - Professional chart appearance
    - Kommentar: - Drawing toolbar with multiple tools
    - Kommentar: - Price panels for indicators
    - Kommentar: - Drag support for stop lines (with Python callback)
    - Kommentar: - Chart state management (visible range, pane layout)
  - __init__.py
  - bot_overlay_mixin.py
    - Class: BotOverlayMixin
      - Kommentar: Mixin providing bot overlay functionality for chart widgets.
      - 
      - Requires the chart widget to have:
      - - _execute_js(script: str) method
      - - page_loaded and chart_initialized flags
      - def _init_bot_overlay(.)
        - Kommentar: Initialize bot overlay state.
      - def add_bot_marker(.)
        - Kommentar: Add a bot marker to the chart.
        - 
        - Args:
        -     timestamp: Bar timestamp (datetime or Unix timestamp)
        -     price: Price level for marker
        -     marker_type: Type of marker
        -     side: "long" or "short"
        -     text: Optional text to display
        -     score: Optional score value
      - def add_entry_candidate(.)
        - Kommentar: Add entry candidate marker.
        - 
        - Args:
        -     timestamp: Bar timestamp
        -     price: Entry price
        -     side: "long" or "short"
        -     score: Entry score (0-100)
      - def add_entry_confirmed(.)
        - Kommentar: Add confirmed entry marker.
        - 
        - Args:
        -     timestamp: Bar timestamp
        -     price: Entry price
        -     side: "long" or "short"
        -     score: Entry score
      - def add_exit_marker(.)
        - Kommentar: Add exit signal marker.
        - 
        - Args:
        -     timestamp: Bar timestamp
        -     price: Exit price
        -     side: Original position side
        -     reason: Exit reason code
      - def add_stop_triggered_marker(.)
        - Kommentar: Add stop-triggered marker.
        - 
        - Args:
        -     timestamp: Bar timestamp
        -     price: Stop price
        -     side: Position side
      - def add_macd_marker(.)
        - Kommentar: Add MACD cross marker (info only, no exit triggered).
        - 
        - Args:
        -     timestamp: Bar timestamp
        -     price: Current price
        -     is_bearish: True for bearish cross, False for bullish
      - def clear_bot_markers(.)
        - Kommentar: Clear all bot markers from chart.
      - def _update_chart_markers(.)
        - Kommentar: Update chart with current markers.
      - def add_stop_line(.)
        - Kommentar: Add or update a stop-loss line on the chart.
        - 
        - Args:
        -     line_id: Unique identifier for the line
        -     price: Stop price level
        -     line_type: "initial", "trailing", or "target"
        -     color: Line color (auto-selected if None)
        -     label: Optional label text
      - def update_stop_line(.)
        - Kommentar: Update an existing stop line.
        - 
        - Args:
        -     line_id: Line identifier
        -     new_price: New price level
        -     label: Optional custom label (if None, uses default format)
        - 
        - Returns:
        -     True if updated, False if line not found
      - def remove_stop_line(.)
        - Kommentar: Remove a stop line from the chart.
        - 
        - Args:
        -     line_id: Line identifier
        - 
        - Returns:
        -     True if removed, False if not found
      - def clear_stop_lines(.)
        - Kommentar: Clear all stop lines from chart.
      - def _remove_chart_line(.)
        - Kommentar: Remove a line from the chart by ID.
      - def set_debug_hud_visible(.)
        - Kommentar: Set debug HUD visibility.
        - 
        - Args:
        -     visible: Whether to show debug HUD
      - def update_debug_info(.)
        - Kommentar: Update debug HUD information.
        - 
        - Args:
        -     regime: Current regime (e.g., "TREND_UP")
        -     strategy: Active strategy name
        -     ki_mode: KI mode (NO_KI, LOW_KI, FULL_KI)
        -     trailing_mode: Trailing stop mode
        -     confidence: Decision confidence (0-1)
        -     state: Bot state (FLAT, SIGNAL, etc.)
        -     extra: Additional key-value pairs
      - def _update_debug_hud(.)
        - Kommentar: Update the debug HUD on chart.
      - def display_position(.)
        - Kommentar: Display position information on chart.
        - 
        - Args:
        -     position: Current position state
      - def clear_position_display(.)
        - Kommentar: Clear position display elements.
      - def display_signal(.)
        - Kommentar: Display a signal on the chart.
        - 
        - Args:
        -     signal: Signal to display
      - def clear_signal_display(.)
        - Kommentar: Clear signal display.
        - 
        - Args:
        -     signal_id: Specific signal to clear, or None for all
      - def clear_bot_overlay(.)
        - Kommentar: Clear all bot overlay elements.
    - Kommentar: Re-export for backward compatibility
  - bot_overlay_types.py
    - Class: MarkerType
      - Kommentar: Marker types for chart display.
    - Class: BotMarker
      - Kommentar: Marker data for chart display.
      - def to_chart_marker(.)
        - Kommentar: Convert to Lightweight Charts marker format.
    - Class: StopLine
      - Kommentar: Stop-loss line data.
    - Class: BotOverlayState
      - Kommentar: State tracking for bot overlay elements.
    - def build_hud_content(.)
      - Kommentar: Build HTML content for debug HUD.
    - Kommentar: Color mappings for HUD display
  - data_loading_mixin.py
    - Class: DataLoadingMixin
      - Kommentar: Mixin providing data loading functionality for EmbeddedTradingViewChart.
      - def load_data(.)
        - Kommentar: Load market data into chart.
        - 
        - Args:
        -     data: OHLCV DataFrame with DatetimeIndex
      - def load_symbol(.)
        - Kommentar: Load symbol data and display chart.
        - 
        - Args:
        -     symbol: Trading symbol
        -     data_provider: Data provider (alpaca, yahoo, etc.)
      - def refresh_data(.)
        - Kommentar: Public method to refresh chart data (called by main app).
      - def _on_symbol_change(.)
        - Kommentar: Handle symbol change.
      - def _on_timeframe_change(.)
        - Kommentar: Handle timeframe (candle size) change.
      - def _on_period_change(.)
        - Kommentar: Handle time period change.
      - def _on_load_chart(.)
        - Kommentar: Load chart data for current symbol.
      - def _load_chart_async(.)
        - Kommentar: Async implementation of chart loading.
      - def _on_refresh(.)
        - Kommentar: Refresh current chart.
    - def get_local_timezone_offset_seconds(.)
      - Kommentar: Get local timezone offset in seconds (positive for east of UTC).
      - 
      - This accounts for DST automatically.
  - indicator_mixin.py
    - Class: IndicatorMixin
      - Kommentar: Mixin providing indicator functionality for EmbeddedTradingViewChart.
      - def _get_indicator_configs(.)
        - Kommentar: Get indicator configuration dictionaries.
        - 
        - Returns:
        -     Tuple of (overlay_configs, oscillator_configs)
      - def _convert_macd_data_to_chart_format(.)
        - Kommentar: Convert MACD indicator result to chart format.
        - 
        - Args:
        -     result: IndicatorResult with DataFrame values
        - 
        - Returns:
        -     Dict with 'macd', 'signal', 'histogram' keys
      - def _convert_multi_series_data_to_chart_format(.)
        - Kommentar: Convert multi-series indicator result to chart format.
        - 
        - Args:
        -     result: IndicatorResult with DataFrame values
        -     ind_id: Indicator ID string
        - 
        - Returns:
        -     List of time/value dicts
      - def _convert_single_series_data_to_chart_format(.)
        - Kommentar: Convert single-series indicator result to chart format.
        - 
        - Args:
        -     result: IndicatorResult with Series values
        - 
        - Returns:
        -     List of time/value dicts
      - def _create_overlay_indicator(.)
        - Kommentar: Create overlay indicator on price chart.
        - 
        - Args:
        -     display_name: Display name for the indicator
        -     color: Color string for the indicator
      - def _create_oscillator_panel(.)
        - Kommentar: Create oscillator panel with indicator-specific reference lines.
        - 
        - Args:
        -     ind_id: Indicator ID string
        -     display_name: Display name for the panel
        -     color: Color string for the indicator
        -     min_val: Minimum value for y-axis (or None)
        -     max_val: Maximum value for y-axis (or None)
      - def _add_oscillator_reference_lines(.)
        - Kommentar: Add indicator-specific reference lines to oscillator panel.
        - 
        - Args:
        -     ind_id: Indicator ID string
        -     panel_id: Panel ID string
      - def _update_overlay_data(.)
        - Kommentar: Update overlay indicator data on price chart.
        - 
        - Args:
        -     display_name: Display name of the indicator
        -     ind_data: List of time/value dicts
      - def _update_oscillator_data(.)
        - Kommentar: Update oscillator panel data.
        - 
        - Args:
        -     ind_id: Indicator ID string
        -     ind_data: Either list of time/value dicts or dict with multiple series
      - def _remove_indicator_from_chart(.)
        - Kommentar: Remove indicator from chart.
        - 
        - Args:
        -     ind_id: Indicator ID string
        -     display_name: Display name of the indicator
        -     is_overlay: True if overlay indicator, False if oscillator
      - def _update_indicators(.)
        - Kommentar: Update technical indicators on chart.
      - def _update_indicators_realtime(.)
        - Kommentar: Update indicators in real-time with new candle data.
        - 
        - Args:
        -     candle: New candle dict with time, open, high, low, close
      - def _update_indicators_button_badge(.)
        - Kommentar: Update indicators button to show count of active indicators.
      - def _on_indicator_toggled(.)
        - Kommentar: Handle indicator toggle from dropdown menu.
        - 
        - Args:
        -     action: The QAction that was toggled
    - def _ts_to_local_unix(.)
      - Kommentar: Convert timestamp to Unix seconds with local timezone offset for chart display.
  - state_mixin.py
    - Class: ChartStateMixin
      - Kommentar: Mixin providing state management for EmbeddedTradingViewChart.
      - def get_visible_range(.)
        - Kommentar: Asynchronously get the current visible logical range.
        - 
        - Args:
        -     callback: Function to call with the result (dict/None)
      - def set_visible_range(.)
        - Kommentar: Restore visible logical range.
        - 
        - Args:
        -     range_data: Dictionary with 'from' and 'to' logical indices
      - def get_pane_layout(.)
        - Kommentar: Asynchronously get the current pane layout (stretch factors).
        - 
        - Args:
        -     callback: Function to call with the result (dict)
      - def set_pane_layout(.)
        - Kommentar: Restore pane layout (stretch factors).
        - 
        - Args:
        -     layout: Dictionary mapping pane IDs to stretch factors
      - def get_chart_state(.)
        - Kommentar: Get comprehensive chart state including panes, zoom, and indicators.
        - 
        - Args:
        -     callback: Function to call with the complete state dict
      - def set_chart_state(.)
        - Kommentar: Restore comprehensive chart state.
        - 
        - Args:
        -     state: State dictionary from get_chart_state()
  - streaming_mixin.py
    - Class: StreamingMixin
      - Kommentar: Mixin providing streaming functionality for EmbeddedTradingViewChart.
      - def _on_market_bar(.)
        - Kommentar: Handle market bar event.
      - def _on_market_tick(.)
        - Kommentar: Handle market tick event - update current candle in real-time.
      - def _process_pending_updates(.)
        - Kommentar: Process pending bar updates (batched for performance).
      - def _toggle_live_stream(.)
        - Kommentar: Toggle live streaming on/off.
      - def _start_live_stream_async(.)
        - Kommentar: Async wrapper for starting live stream.
      - def _stop_live_stream_async(.)
        - Kommentar: Async wrapper for stopping live stream.
      - def _start_live_stream(.)
        - Kommentar: Start live streaming for current symbol.
      - def _stop_live_stream(.)
        - Kommentar: Stop live streaming - disconnect WebSocket to free connection slot.
  - toolbar_mixin.py
    - Class: ToolbarMixin
      - Kommentar: Mixin providing toolbar functionality for EmbeddedTradingViewChart.
      - def _create_toolbar(.)
        - Kommentar: Create chart toolbar.
  - chart_window.py
    - Class: DockTitleBar
      - Kommentar: Custom title bar for dock widget with minimize/maximize buttons.
      - def __init__(.)
      - def _on_maximize_clicked(.)
      - def set_maximized(.)
        - Kommentar: Update button state without emitting signal.
    - Class: ChartWindow
      - Kommentar: Popup window for displaying a single chart.
      - def __init__(.)
        - Kommentar: Initialize chart window.
        - 
        - Args:
        -     symbol: Trading symbol to display
        -     history_manager: HistoryManager instance for loading data
        -     parent: Parent widget
      - def _activate_live_stream(.)
        - Kommentar: Activate live streaming when chart data is loaded.
      - def closeEvent(.)
        - Kommentar: Handle window close event with async state saving.
      - def load_chart(.)
        - Kommentar: Load chart data for the symbol.
        - 
        - Args:
        -     data_provider: Optional data provider to use
      - def _minimize_dock(.)
        - Kommentar: Minimize the dock widget to show only the title bar.
      - def _toggle_dock_maximized(.)
        - Kommentar: Toggle dock widget between maximized and normal state.
      - def _reset_layout(.)
        - Kommentar: Reset window layout to default state.
        - 
        - Restores chart visibility, dock position, and clears any
        - maximized/minimized state. Use this if the window gets into
        - a broken state.
      - def _open_trailing_stop_help(.)
        - Kommentar: Open the trailing stop help documentation in browser.
  - __init__.py
  - bot_callbacks.py
    - Class: BotCallbacksMixin
      - Kommentar: Mixin providing bot controller callbacks and control methods.
      - def _start_bot_with_config(.)
        - Kommentar: Start bot with current UI configuration.
      - def _stop_bot(.)
        - Kommentar: Stop the running bot.
      - def _on_bot_signal(.)
        - Kommentar: Handle bot signal event.
      - def _on_bot_decision(.)
        - Kommentar: Handle bot decision event.
      - def _on_bot_log(.)
        - Kommentar: Handle bot log event.
      - def _on_bot_order(.)
        - Kommentar: Handle bot order event.
      - def _on_macd_signal(.)
        - Kommentar: Handle MACD signal from bot controller.
      - def _on_trading_blocked(.)
        - Kommentar: Handle trading blocked event.
      - def _on_bot_state_change(.)
        - Kommentar: Handle bot state change.
      - def _on_chart_candle_closed(.)
        - Kommentar: Handle candle close event from chart - feed bar to bot.
        - 
        - This is the main entry point for bot bar processing when using
        - tick-based streaming (not event-bus MARKET_BAR).
        - 
        - Args:
        -     previous_close: The close price of the completed candle
        -     new_open: The open price of the new candle
  - bot_display_manager.py
    - Class: BotDisplayManagerMixin
      - Kommentar: Mixin providing bot display update methods.
      - def _update_bot_status(.)
        - Kommentar: Update bot status indicator.
      - def _update_bot_display(.)
        - Kommentar: Update bot display with current state.
      - def _update_signals_pnl(.)
        - Kommentar: Update P&L for all open signals in history.
      - def _check_tr_activation(.)
        - Kommentar: Check if trailing stop should be activated based on activation threshold.
        - 
        - Trailing stop only activates when price moves TRA% into profit:
        - - LONG: current_price >= entry_price * (1 + trailing_activation_pct / 100)
        - - SHORT: current_price <= entry_price * (1 - trailing_activation_pct / 100)
      - def _update_signals_table(.)
        - Kommentar: Update signals table with recent entries.
      - def _add_ki_log_entry(.)
        - Kommentar: Add entry to KI log (uses local time).
      - def _log_bot_diagnostics(.)
        - Kommentar: Log periodic bot diagnostics for debugging.
      - def update_strategy_scores(.)
        - Kommentar: Update strategy scores table.
        - 
        - Args:
        -     scores: List of strategy score dicts
      - def update_walk_forward_results(.)
        - Kommentar: Update walk-forward results display.
        - 
        - Args:
        -     results: Walk-forward results dict
      - def log_ki_request(.)
        - Kommentar: Log a KI request/response pair.
        - 
        - Args:
        -     request: Request data sent to KI
        -     response: Response received (if any)
  - bot_event_handlers.py
    - Class: BotEventHandlersMixin
      - Kommentar: Mixin providing bot event handlers and settings management.
      - def _on_bot_start_clicked(.)
        - Kommentar: Handle bot start button click.
      - def _on_bot_stop_clicked(.)
        - Kommentar: Handle bot stop button click.
      - def _on_bot_pause_clicked(.)
        - Kommentar: Handle bot pause button click.
      - def _on_ki_mode_changed(.)
        - Kommentar: Handle KI mode change.
      - def _on_trailing_mode_changed(.)
        - Kommentar: Handle trailing mode change - toggle field visibility based on mode.
      - def _on_regime_adaptive_changed(.)
        - Kommentar: Handle regime-adaptive checkbox change - toggle field visibility.
      - def _on_display_option_changed(.)
        - Kommentar: Handle display option checkbox change.
      - def _on_debug_hud_changed(.)
        - Kommentar: Handle debug HUD checkbox change.
      - def _on_force_reselect(.)
        - Kommentar: Handle force re-selection button click.
      - def _clear_ki_log(.)
        - Kommentar: Clear KI log display.
      - def update_bot_symbol(.)
        - Kommentar: Update the bot panel with current symbol and load its settings.
        - 
        - Args:
        -     symbol: Symbol to use, or None to get from chart
      - def _load_bot_settings(.)
        - Kommentar: Load saved settings for a symbol into UI controls.
        - 
        - Args:
        -     symbol: Symbol to load settings for
      - def _save_bot_settings(.)
        - Kommentar: Save current UI settings for a symbol.
        - 
        - Args:
        -     symbol: Symbol to save settings for
  - bot_panels_mixin.py
    - Class: BotPanelsMixin
      - Kommentar: Mixin providing bot control and monitoring panels.
      - 
      - This class combines all bot-related functionality through multiple inheritance
      - from specialized sub-mixins. Each sub-mixin handles a specific concern:
      - 
      - - BotUIPanelsMixin: Creates the UI tabs and widgets
      - - BotEventHandlersMixin: Handles UI events and settings persistence
      - - BotCallbacksMixin: Manages bot controller lifecycle and callbacks
      - - BotDisplayManagerMixin: Updates displays (status, tables, P&L)
      - - BotPositionPersistenceMixin: Manages position persistence and chart integration
      - 
      - Usage:
      -     class ChartWindow(QMainWindow, BotPanelsMixin, ...):
      -         def __init__(self):
      -             super().__init__()
      -             self._init_bot_panels()
      -             # Add tabs using:
      -             # - self._create_bot_control_tab()
      -             # - self._create_strategy_selection_tab()
      -             # - self._create_signals_tab()
      -             # - self._create_ki_logs_tab()
      - def _init_bot_panels(.)
        - Kommentar: Initialize bot panel state.
        - 
        - Must be called during ChartWindow initialization to set up:
        - - Bot controller reference
        - - Update timer
        - - Signal/trade history
        - - Settings manager
      - def _connect_candle_closed_signal(.)
        - Kommentar: Connect the chart's candle_closed signal to feed bars to the bot.
        - 
        - This is critical for the trading bot to receive candle data when
        - using tick-based streaming (Live button).
    - Kommentar: Import sub-mixins
  - bot_position_persistence.py
    - Class: BotPositionPersistenceMixin
      - Kommentar: Mixin providing position persistence and chart integration.
      - def _get_signal_history_key(.)
        - Kommentar: Get settings key for signal history based on current symbol.
      - def _save_signal_history(.)
        - Kommentar: Save signal history to settings for the current symbol.
      - def _load_signal_history(.)
        - Kommentar: Load signal history from settings for the current symbol.
      - def _on_chart_data_loaded_restore_position(.)
        - Kommentar: Called when chart data is loaded - restore persisted positions.
      - def _restore_persisted_position(.)
        - Kommentar: Restore chart elements and Current Position display for persisted positions.
      - def _start_pnl_update_timer(.)
        - Kommentar: Start timer to update P&L for restored positions.
      - def _update_restored_positions_pnl(.)
        - Kommentar: Update P&L for restored positions from chart's current price.
      - def _show_signals_context_menu(.)
        - Kommentar: Show context menu for signals table.
      - def _sell_signal(.)
        - Kommentar: Manually close/sell a signal's position.
      - def _delete_signal(.)
        - Kommentar: Delete a signal from history.
      - def _connect_chart_line_signals(.)
        - Kommentar: Connect chart line drag signals for bidirectional editing.
      - def _on_chart_stop_line_moved(.)
        - Kommentar: Handle stop line being dragged in the chart.
      - def _on_signals_table_cell_changed(.)
        - Kommentar: Handle table cell editing - update chart lines when SL% or TR% changes.
      - def _sync_stop_to_bot_controller(.)
        - Kommentar: Sync stop price to bot controller's internal position.
  - bot_tr_lock_mixin.py
    - Class: BotTRLockMixin
      - Kommentar: Mixin providing TR% lock feature for trailing stop management.
      - def _on_row_tr_lock_changed(.)
        - Kommentar: Handle TR% lock checkbox change for a specific signal row.
      - def _get_signals_with_active_lock(.)
        - Kommentar: Get all signals that have TR% lock active.
      - def _on_candle_closed(.)
        - Kommentar: Handle candle close event for TR% lock feature.
  - bot_ui_panels.py
    - Class: BotUIPanelsMixin
      - Kommentar: Mixin providing bot panel tab creation methods.
      - def _create_bot_control_tab(.)
        - Kommentar: Create bot control tab with start/stop and settings.
      - def _on_open_help_clicked(.)
        - Kommentar: Open the trading bot help documentation.
      - def _create_strategy_selection_tab(.)
        - Kommentar: Create daily strategy selection tab.
      - def _create_signals_tab(.)
        - Kommentar: Create signals & trade management tab.
      - def _create_ki_logs_tab(.)
        - Kommentar: Create KI logs tab for monitoring AI decisions.
  - event_bus_mixin.py
    - Class: EventBusMixin
      - Kommentar: Mixin providing event bus integration for ChartWindow.
      - def _setup_event_subscriptions(.)
        - Kommentar: Subscribe to event bus for live trade marker updates.
      - def _on_chart_symbol_changed(.)
        - Kommentar: Handle symbol change in chart - update bot panel settings.
        - 
        - Args:
        -     new_symbol: The new symbol that was selected
      - def _on_trade_entry(.)
        - Kommentar: Handle TRADE_ENTRY event - add entry marker to chart.
      - def _on_trade_exit(.)
        - Kommentar: Handle TRADE_EXIT event - add exit marker to chart.
      - def _on_stop_loss_hit(.)
        - Kommentar: Handle STOP_LOSS_HIT event - add SL marker to chart.
      - def _on_take_profit_hit(.)
        - Kommentar: Handle TAKE_PROFIT_HIT event - add TP marker to chart.
      - def _on_order_filled(.)
        - Kommentar: Handle ORDER_FILLED event - add fill marker to chart.
      - def _on_market_bar(.)
        - Kommentar: Handle MARKET_BAR event - update chart with real-time data.
      - def _feed_bar_to_bot(.)
        - Kommentar: Feed bar data to the trading bot if active.
        - 
        - Args:
        -     bar_data: Bar data dictionary with OHLCV
      - def _update_chart_bar(.)
        - Kommentar: Update the chart with a new real-time bar.
      - def _add_single_marker(.)
        - Kommentar: Add a single marker to the chart in real-time.
      - def _unsubscribe_events(.)
        - Kommentar: Unsubscribe from all event bus events.
    - def _ts_to_chart_time(.)
      - Kommentar: Convert timestamp to chart time (with local timezone offset).
  - panels_mixin.py
    - Class: PanelsMixin
      - Kommentar: Mixin providing panel/tab creation for ChartWindow.
      - def _create_bottom_panel(.)
        - Kommentar: Create bottom panel with Bot tabs only.
      - def _toggle_bottom_panel(.)
        - Kommentar: Toggle visibility of bottom panel dock widget.
      - def _on_dock_visibility_changed(.)
        - Kommentar: Handle dock visibility changes.
      - def _update_toggle_button_text(.)
        - Kommentar: Update the toggle button text based on state.
  - state_mixin.py
    - Class: StateMixin
      - Kommentar: Mixin providing state save/restore for ChartWindow.
      - def _load_window_state(.)
        - Kommentar: Load window position and size from settings.
      - def _get_settings_key(.)
        - Kommentar: Get sanitized settings key for this symbol.
      - def _save_window_state(.)
        - Kommentar: Save window position, size, and chart settings.
      - def _restore_chart_state(.)
        - Kommentar: Restore pane sizes and zoom level from settings.
        - 
        - IMPORTANT: This is called when data_loaded signal is emitted.
        - We use a short delay (100ms) to let the chart render the data first,
        - then immediately restore the saved state.
      - def _finalize_restoration(.)
        - Kommentar: Clean up after state restoration.
      - def _restore_indicators_after_data_load(.)
        - Kommentar: Restore indicators after data has been loaded.
        - 
        - NOTE: Visible range is restored by _restore_chart_state(), not here.
        - This function only handles indicators to avoid duplicate restoration.
      - def _restore_zoom_state_now(.)
        - Kommentar: Restore zoom/visible range state immediately (no delay).
      - def _restore_pane_layout_now(.)
        - Kommentar: Restore pane layout/row heights with minimal delay.
      - def _restore_indicators_now(.)
        - Kommentar: Restore indicators.
      - def _sanitize_symbol(.)
        - Kommentar: Sanitize symbol for use in settings keys.
      - def load_backtest_result(.)
        - Kommentar: Load and display backtest result in chart window.
  - dashboard.py
    - Class: DashboardWidget
      - Kommentar: Main dashboard widget displaying account overview.
      - def __init__(.)
      - def init_ui(.)
        - Kommentar: Initialize the dashboard UI.
      - def _create_stat_widget(.)
        - Kommentar: Create a statistics display widget.
      - def setup_event_handlers(.)
        - Kommentar: Setup event bus handlers.
      - def on_order_filled(.)
        - Kommentar: Handle order filled event.
      - def on_market_connected(.)
        - Kommentar: Handle market connected event.
      - def update_balance(.)
        - Kommentar: Update balance display.
        - 
        - Args:
        -     balance: Balance object or tuple of (equity, cash)
      - def update_pnl(.)
        - Kommentar: Update P&L display.
      - def update_positions_count(.)
        - Kommentar: Update open positions count.
      - def refresh_stats(.)
        - Kommentar: Refresh dashboard statistics from database or broker.
  - dashboard_metrics.py
    - Class: PerformanceMetrics
      - Kommentar: Performance metrics data.
    - Class: MetricCard
      - Kommentar: Widget for displaying a single metric.
      - def __init__(.)
        - Kommentar: Initialize metric card.
        - 
        - Args:
        -     title: Metric title
        -     value: Metric value
        -     suffix: Value suffix (%, $, etc.)
        -     color: Text color
      - def update_value(.)
        - Kommentar: Update the metric value.
        - 
        - Args:
        -     value: New value
        -     suffix: Value suffix
  - dashboard_tabs_mixin.py
    - Class: DashboardTabsMixin
      - Kommentar: Mixin providing tab creation methods for PerformanceDashboard.
      - def _create_overview_tab(.)
        - Kommentar: Create overview tab.
      - def _create_returns_tab(.)
        - Kommentar: Create returns analysis tab.
      - def _create_trades_tab(.)
        - Kommentar: Create trades analysis tab.
      - def _create_positions_tab(.)
        - Kommentar: Create positions tab.
      - def _create_ai_tab(.)
        - Kommentar: Create AI analytics tab.
      - def _create_reports_tab(.)
        - Kommentar: Create reports tab.
  - embedded_tradingview_chart.py
    - Class: ChartBridge
      - Kommentar: Bridge object for JavaScript to Python communication.
      - 
      - Allows JavaScript in the chart to call Python methods, e.g., when
      - a stop line is dragged to a new position.
      - def __init__(.)
      - def onStopLineMoved(.)
        - Kommentar: Called from JavaScript when a stop line is dragged.
        - 
        - Args:
        -     line_id: ID of the line ("initial_stop", "trailing_stop", "entry_line")
        -     new_price: New price level after drag
    - Class: EmbeddedTradingViewChart
      - Kommentar: Embedded TradingView Lightweight Charts widget.
      - 
      - Features:
      - - Fully embedded in Qt application (no external windows)
      - - Chromium-based WebEngine rendering
      - - Professional TradingView appearance
      - - Real-time updates
      - - Technical indicators support
      - def __init__(.)
        - Kommentar: Initialize embedded chart widget.
        - 
        - Args:
        -     history_manager: HistoryManager instance for loading data
      - def _on_market_tick_event(.)
        - Kommentar: Event bus callback - emit signal for thread-safe handling.
      - def _on_market_bar_event(.)
        - Kommentar: Event bus callback - emit signal for thread-safe handling.
      - def _handle_tick_main_thread(.)
        - Kommentar: Handle tick in main thread (thread-safe).
      - def _handle_bar_main_thread(.)
        - Kommentar: Handle bar in main thread (thread-safe).
      - def _show_error_ui(.)
        - Kommentar: Show error message if WebEngine not available.
      - def _setup_ui(.)
        - Kommentar: Setup the UI components.
      - def _execute_js(.)
        - Kommentar: Execute JavaScript in the web view, queueing until chart is ready.
      - def _flush_pending_js(.)
        - Kommentar: Run any JS commands that were queued before chart initialization completed.
      - def _on_page_loaded(.)
        - Kommentar: Handle page load completion.
      - def _start_chart_ready_poll(.)
        - Kommentar: Poll inside the WebEngine until window.chartAPI exists.
      - def _poll_chart_ready(.)
      - def _on_chart_ready_result(.)
      - def _on_bridge_stop_line_moved(.)
        - Kommentar: Handle stop line moved event from JavaScript bridge.
        - 
        - Re-emits the signal so it can be caught by the chart window.
  - indicators.py
    - Class: IndicatorsWidget
      - Kommentar: Widget for managing technical indicators.
      - def __init__(.)
        - Kommentar: Initialize indicators widget.
      - def _setup_ui(.)
        - Kommentar: Setup the UI components.
      - def _add_indicator(.)
        - Kommentar: Add a new indicator.
      - def _remove_indicator(.)
        - Kommentar: Remove selected indicator.
  - orders.py
    - Class: OrdersWidget
      - Kommentar: Widget for displaying orders.
      - def __init__(.)
      - def _get_table_columns(.)
        - Kommentar: Define order table columns.
      - def _get_column_keys(.)
        - Kommentar: Define keys for mapping order data to columns.
      - def _setup_event_subscriptions(.)
        - Kommentar: Setup event bus handlers.
      - def on_order_created(.)
        - Kommentar: Handle order created event.
      - def on_order_updated(.)
        - Kommentar: Handle order update events.
      - def add_order(.)
        - Kommentar: Add a new order to the table.
      - def update_order(.)
        - Kommentar: Update an existing order in the table.
  - performance_dashboard.py
    - Class: PerformanceDashboard
      - Kommentar: Performance dashboard widget.
      - def __init__(.)
        - Kommentar: Initialize performance dashboard.
      - def _setup_ui(.)
        - Kommentar: Setup the UI components.
      - def _setup_timers(.)
        - Kommentar: Setup update timers.
      - def _load_performance_data(.)
        - Kommentar: Load performance data from database.
      - def _get_date_range(.)
        - Kommentar: Get date range based on selected period.
      - def _calculate_metrics(.)
        - Kommentar: Calculate performance metrics.
      - def _update_ui(.)
        - Kommentar: Update UI with current metrics.
      - def _update_metrics(.)
        - Kommentar: Update metrics (called by timer).
      - def _on_period_changed(.)
        - Kommentar: Handle period change.
      - def _apply_custom_dates(.)
        - Kommentar: Apply custom date range.
      - def _generate_report(.)
        - Kommentar: Generate performance report.
      - def _create_report_content(.)
        - Kommentar: Create report content.
      - def _on_order_filled(.)
        - Kommentar: Handle order filled event.
      - def _on_position_closed(.)
        - Kommentar: Handle position closed event.
    - Kommentar: Re-export for backward compatibility
  - positions.py
    - Class: PositionsWidget
      - Kommentar: Widget for displaying current positions.
      - def _get_table_columns(.)
        - Kommentar: Define position table columns.
      - def _get_column_keys(.)
        - Kommentar: Define keys for mapping position data to columns.
      - def _get_format_functions(.)
        - Kommentar: Define format functions for columns.
      - def update_positions(.)
        - Kommentar: Update positions table.
      - def _setup_event_subscriptions(.)
        - Kommentar: Setup event bus handlers.
      - def on_order_filled(.)
        - Kommentar: Handle order filled event - refresh positions.
      - def on_market_tick(.)
        - Kommentar: Handle market tick - update prices if needed.
      - def refresh(.)
        - Kommentar: Refresh positions display from database.
  - watchlist.py
    - Class: WatchlistWidget
      - Kommentar: Widget displaying watchlist with real-time updates.
      - def __init__(.)
        - Kommentar: Initialize watchlist widget.
        - 
        - Args:
        -     parent: Parent widget
      - def init_ui(.)
        - Kommentar: Initialize user interface.
      - def setup_event_handlers(.)
        - Kommentar: Setup event bus handlers.
      - def on_market_tick(.)
        - Kommentar: Handle market tick events.
      - def on_market_bar(.)
        - Kommentar: Handle market bar events.
      - def update_prices(.)
        - Kommentar: Update prices in the table.
      - def format_volume(.)
        - Kommentar: Format volume for display. Delegates to module function.
      - def add_symbol_from_input(.)
        - Kommentar: Add symbol from input field.
      - def add_symbol(.)
        - Kommentar: Add symbol to watchlist.
        - 
        - Args:
        -     symbol_data: Trading symbol (string) or dict with {symbol, name, wkn}
        -     save: Whether to save watchlist immediately (default: True, set False for batch operations)
      - def remove_symbol(.)
        - Kommentar: Remove symbol from watchlist.
        - 
        - Args:
        -     symbol: Trading symbol
      - def clear_watchlist(.)
        - Kommentar: Clear all symbols from watchlist.
      - def add_indices(.)
        - Kommentar: Add major market indices.
      - def add_tech_stocks(.)
        - Kommentar: Add major tech stocks.
      - def add_crypto_pairs(.)
        - Kommentar: Add major cryptocurrency trading pairs.
      - def on_symbol_double_clicked(.)
        - Kommentar: Handle symbol double-click.
        - 
        - Args:
        -     item: Clicked table item
      - def show_context_menu(.)
        - Kommentar: Show context menu for table.
        - 
        - Args:
        -     position: Menu position
      - def create_order(.)
        - Kommentar: Create order for symbol.
        - 
        - Args:
        -     symbol: Trading symbol
      - def load_default_watchlist(.)
        - Kommentar: Load default watchlist on startup.
      - def save_watchlist(.)
        - Kommentar: Save watchlist to settings.
      - def get_symbols(.)
        - Kommentar: Get list of watched symbols.
        - 
        - Returns:
        -     List of symbols
      - def save_column_state(.)
        - Kommentar: Save column widths and order to settings.
      - def load_column_state(.)
        - Kommentar: Load column widths and order from settings.
      - def closeEvent(.)
        - Kommentar: Handle widget close event - save column state.
        - 
        - Args:
        -     event: Close event
  - watchlist_presets.py
    - Class: SymbolInfo
      - Kommentar: Type definition for symbol information.
    - def format_volume(.)
      - Kommentar: Format volume for display.
    - Kommentar: Market indices ETFs
    - Kommentar: Major tech stocks
    - Kommentar: Major cryptocurrency trading pairs
    - Kommentar: Default watchlist symbols
    - Kommentar: Market status display configuration
  - widget_helpers.py
    - Class: EventBusWidget
      - Kommentar: Base widget with event bus integration.
      - 
      - Provides automatic event subscription/unsubscription lifecycle management.
      - Subclasses should implement _setup_event_subscriptions() to register handlers.
      - def __init__(.)
        - Kommentar: Initialize event bus widget.
        - 
        - Args:
        -     parent: Parent widget
      - def _subscribe_event(.)
        - Kommentar: Subscribe to an event and track for cleanup.
        - 
        - Args:
        -     event_type: Event type to subscribe to
        -     handler: Handler function
      - def _setup_event_subscriptions(.)
        - Kommentar: Set up event subscriptions.
        - 
        - Subclasses should override this method to subscribe to events
        - using _subscribe_event().
      - def closeEvent(.)
        - Kommentar: Clean up event subscriptions on close.
    - Class: BaseTableWidget
      - Kommentar: Base class for table-based widgets with common setup pattern.
      - 
      - Provides template method pattern for widget initialization:
      - 1. Create UI layout
      - 2. Create and configure table
      - 3. Add table to layout
      - 4. Set up event handlers
      - 
      - Subclasses should implement:
      - - _get_table_columns() - return list of column headers
      - - _configure_table() - optional additional table configuration
      - - _setup_event_subscriptions() - subscribe to events
      - def __init__(.)
        - Kommentar: Initialize base table widget.
        - 
        - Args:
        -     parent: Parent widget
      - def _init_ui(.)
        - Kommentar: Initialize UI using template method pattern.
      - def _get_table_columns(.)
        - Kommentar: Get table column headers.
        - 
        - Subclasses must implement this method.
        - 
        - Returns:
        -     List of column header labels
      - def _get_table_config(.)
        - Kommentar: Get table configuration parameters.
        - 
        - Subclasses can override to customize table behavior.
        - 
        - Returns:
        -     Dict of parameters for create_table_widget()
      - def _configure_table(.)
        - Kommentar: Configure table after creation.
        - 
        - Optional hook for subclasses to apply additional configuration.
      - def _add_additional_widgets(.)
        - Kommentar: Add additional widgets to layout.
        - 
        - Optional hook for subclasses to add widgets before/after table.
      - def update_row(.)
        - Kommentar: Update a table row with data.
        - 
        - Args:
        -     row: Row index
        -     data: Dictionary with column data
      - def _get_column_keys(.)
        - Kommentar: Get keys for mapping data to columns.
        - 
        - Subclasses should implement this to define how data dict keys
        - map to table columns.
        - 
        - Returns:
        -     List of keys matching column order
      - def _get_format_functions(.)
        - Kommentar: Get format functions for columns.
        - 
        - Subclasses can override to provide custom formatting.
        - 
        - Returns:
        -     Dict mapping column keys to format functions
    - def create_table_widget(.)
      - Kommentar: Create a configured QTableWidget with common settings.
      - 
      - Args:
      -     columns: List of column headers
      -     stretch_columns: If True, columns stretch to fill width
      -     selection_behavior: Row or cell selection
      -     selection_mode: Single, multi, or no selection
      -     editable: Allow editing cells
      -     alternating_colors: Use alternating row colors
      -     sortable: Enable column sorting
      - 
      - Returns:
      -     Configured QTableWidget
    - def setup_table_row(.)
      - Kommentar: Set up a table row with data.
      - 
      - Args:
      -     table: QTableWidget to update
      -     row: Row index
      -     data: Dictionary with data for the row
      -     column_keys: List of keys matching column order
      -     format_funcs: Optional dict mapping column keys to format functions
    - def create_vbox_layout(.)
      - Kommentar: Create a QVBoxLayout with common settings.
      - 
      - Args:
      -     parent: Parent widget (can be None)
      -     spacing: Spacing between widgets
      -     margins: Tuple of (left, top, right, bottom) margins. None for default.
      - 
      - Returns:
      -     Configured QVBoxLayout
    - def create_hbox_layout(.)
      - Kommentar: Create a QHBoxLayout with common settings.
      - 
      - Args:
      -     parent: Parent widget (can be None)
      -     spacing: Spacing between widgets
      -     margins: Tuple of (left, top, right, bottom) margins. None for default.
      - 
      - Returns:
      -     Configured QHBoxLayout
    - def create_grid_layout(.)
      - Kommentar: Create a QGridLayout with common settings.
      - 
      - Args:
      -     parent: Parent widget (can be None)
      -     spacing: Spacing between widgets
      -     margins: Tuple of (left, top, right, bottom) margins. None for default.
      - 
      - Returns:
      -     Configured QGridLayout
  - start_orderpilot.py
    - def setup_logging(.)
      - Kommentar: Setup application logging
    - def check_dependencies(.)
      - Kommentar: Check if all required dependencies are installed
    - def check_database(.)
      - Kommentar: Check and initialize database if needed
    - def print_startup_banner(.)
      - Kommentar: Display startup banner
    - def main_with_args(.)
      - Kommentar: Main function with argument handling
    - def create_parser(.)
      - Kommentar: Create command line argument parser
    - def main(.)
      - Kommentar: Main entry point
    - Kommentar: !/usr/bin/env python
    - Kommentar: Add src directory to path
  - Andere Dateien
    - requirements.txt
  - Kommentar: !/usr/bin/env python
  - Kommentar: Add src directory to path
  - Kommentar: Import and run the full-featured launcher
TREE-->