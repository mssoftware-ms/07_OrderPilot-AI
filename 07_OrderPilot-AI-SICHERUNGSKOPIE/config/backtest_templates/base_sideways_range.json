{
  "$schema": "../schemas/backtest_config_v2.schema.json",
  "version": "2.0.0",

  "meta": {
    "name": "Sideways Range Market Strategy",
    "description": "Spezialisierte Strategie fuer seitwaertsgerichtete Maerkte mit einer maximalen Range von 0.6%. Kombiniert SMA 20/50, RSI 14, Bollinger-Baender, Stochastik, Volumen und MACD fuer umfassende Marktanalyse in konsolidierenden Maerkten.",
    "author": "OrderPilot-AI",
    "tags": ["sideways", "range", "consolidation", "mean_reversion", "low_volatility", "chop"],
    "target_asset_class": "crypto",
    "target_timeframe": "15m",
    "scenario_type": "conservative"
  },

  "strategy_profile": {
    "type": "mean_reversion",
    "preset": "W3_SIDEWAYS",
    "direction_bias": "BOTH"
  },

  "entry_score": {
    "weights": {
      "use_preset": "W3_SIDEWAYS",
      "custom": null
    },
    "weight_presets": {
      "W0": { "trend": 0.25, "rsi": 0.15, "macd": 0.20, "adx": 0.15, "vol": 0.10, "volume": 0.15 },
      "W1": { "trend": 0.35, "rsi": 0.10, "macd": 0.15, "adx": 0.20, "vol": 0.10, "volume": 0.10 },
      "W2": { "trend": 0.25, "rsi": 0.20, "macd": 0.20, "adx": 0.10, "vol": 0.15, "volume": 0.10 },
      "W3_MR": { "trend": 0.15, "rsi": 0.30, "macd": 0.15, "adx": 0.10, "vol": 0.15, "volume": 0.15 },
      "W3_SIDEWAYS": { "trend": 0.10, "rsi": 0.25, "macd": 0.15, "adx": 0.15, "vol": 0.20, "volume": 0.15 }
    },
    "thresholds": {
      "min_score_for_entry": { "value": 0.55, "optimize": true, "range": [0.50, 0.55, 0.60] }
    },
    "gates": {
      "block_in_chop": false,
      "block_against_strong_trend": true,
      "allow_counter_trend_sfp": true
    },
    "indicator_params": {
      "ema_short": 20,
      "ema_medium": 50,
      "ema_long": 200,
      "sma_short": 20,
      "sma_medium": 50,
      "rsi_period": 14,
      "rsi_oversold": 30,
      "rsi_overbought": 70,
      "bb_period": 20,
      "bb_std_dev": 2.0,
      "stoch_k_period": 14,
      "stoch_d_period": 3,
      "stoch_smooth": 3,
      "stoch_oversold": 20,
      "stoch_overbought": 80,
      "macd_fast": 12,
      "macd_slow": 26,
      "macd_signal": 9,
      "adx_period": 14,
      "adx_strong_trend": 20.0,
      "atr_period": 14,
      "max_range_percent": 0.6
    }
  },

  "entry_triggers": {
    "breakout": {
      "enabled": false,
      "volume_multiplier": { "value": 1.5, "optimize": false },
      "close_threshold": { "value": 0.5, "optimize": false }
    },
    "pullback": {
      "enabled": true,
      "max_distance_atr": { "value": 1.0, "optimize": true, "range": [0.8, 1.0, 1.2] },
      "rejection_wick_pct": { "value": 0.3, "optimize": true, "range": [0.25, 0.3, 0.4] }
    },
    "sfp": {
      "enabled": true,
      "wick_body_ratio": { "value": 2.0, "optimize": true, "range": [1.8, 2.0, 2.5] },
      "penetration_pct": { "value": 0.25, "optimize": false }
    },
    "range_bounce": {
      "enabled": true,
      "bb_touch_threshold": { "value": 0.05, "optimize": true, "range": [0.03, 0.05, 0.08] },
      "rsi_extreme_threshold": { "value": 30, "optimize": true, "range": [25, 30, 35] },
      "stoch_extreme_threshold": { "value": 20, "optimize": true, "range": [15, 20, 25] }
    }
  },

  "exit_management": {
    "stop_loss": {
      "type": "percent",
      "percent": { "value": 0.6, "optimize": true, "range": [0.4, 0.6, 0.8] },
      "atr_multiplier": { "value": 1.0, "optimize": false }
    },
    "take_profit": {
      "type": "bb_middle",
      "atr_multiplier": { "value": 1.0, "optimize": false },
      "use_level": true,
      "rsi_target": { "value": 50, "optimize": false },
      "stoch_target": { "value": 50, "optimize": false }
    },
    "trailing_stop": {
      "enabled": true,
      "move_to_breakeven": true,
      "activation_pct": { "value": 0.2, "optimize": true, "range": [0.15, 0.2, 0.3] },
      "distance_pct": { "value": 0.4, "optimize": true, "range": [0.3, 0.4, 0.5] },
      "step_percent": { "value": 0.1, "optimize": false }
    },
    "partial_tp": {
      "enabled": true,
      "tp1_percent": 50,
      "tp1_rr": 0.5
    },
    "time_stop": {
      "enabled": true,
      "max_holding_minutes": 180
    }
  },

  "risk_leverage": {
    "risk_per_trade_pct": { "value": 0.30, "optimize": true, "range": [0.20, 0.30, 0.40] },
    "base_leverage": { "value": 5, "optimize": true, "range": [3, 5, 7] },
    "max_leverage": 10,
    "min_liquidation_distance_pct": 10.0,
    "max_daily_loss_pct": 1.5,
    "max_trades_per_day": 10,
    "max_concurrent_positions": 1,
    "max_loss_streak": 3,
    "cooldown_after_streak_min": 60
  },

  "execution_simulation": {
    "initial_capital": 1000.0,
    "fee_maker_pct": 0.02,
    "fee_taker_pct": 0.06,
    "assume_taker": true,
    "slippage_method": "fixed_bps",
    "slippage_bps": 3.0,
    "funding_rate_8h": 0.01
  },

  "optimization": {
    "method": "grid",
    "max_iterations": 200,
    "target_metric": "sharpe_ratio",
    "minimize": false,
    "n_jobs": -1,
    "seed": 42
  },

  "walk_forward": {
    "enabled": true,
    "train_window_days": 90,
    "test_window_days": 30,
    "step_size_days": 30,
    "min_folds": 3,
    "reoptimize_each_fold": true
  },

  "parameter_groups": [
    {
      "name": "sideways_detection",
      "description": "Parameter zur Erkennung von Seitwaertsmaerkten",
      "parameters": [
        "entry_score.indicator_params.adx_strong_trend",
        "entry_score.indicator_params.max_range_percent"
      ]
    },
    {
      "name": "oscillator_settings",
      "description": "RSI und Stochastik Einstellungen",
      "parameters": [
        "entry_triggers.range_bounce.rsi_extreme_threshold",
        "entry_triggers.range_bounce.stoch_extreme_threshold"
      ]
    },
    {
      "name": "bollinger_settings",
      "description": "Bollinger Band Einstellungen",
      "parameters": [
        "entry_triggers.range_bounce.bb_touch_threshold",
        "entry_score.indicator_params.bb_period",
        "entry_score.indicator_params.bb_std_dev"
      ]
    }
  ],

  "conditionals": [
    {
      "if": { "entry_score.indicator_params.adx_strong_trend": { ">": 25 } },
      "then": { "entry_score.gates.block_in_chop": true },
      "comment": "Blockiere Entries wenn ADX zu hoch (kein Seitwaertsmarkt mehr)"
    },
    {
      "if": { "exit_management.stop_loss.percent.value": { ">": 0.6 } },
      "then": { "risk_leverage.base_leverage": 3 },
      "comment": "Reduziere Leverage bei groesserem Stop Loss"
    }
  ],

  "constraints": {
    "min_trades": 30,
    "max_drawdown_pct": 10,
    "min_win_rate": 0.55,
    "min_profit_factor": 1.3,
    "min_sharpe": 0.8,
    "weights_must_sum_to_one": true,
    "max_range_for_entry_pct": 0.6
  },

  "indicators_summary": {
    "description": "Zusammenfassung des Indikator-Sets fuer Seitwaertsmaerkte",
    "indicators": [
      {
        "name": "SMA (Simple Moving Average)",
        "periods": [20, 50],
        "purpose": "Kurzfristige (20) und mittelfristige (50) Trendrichtung"
      },
      {
        "name": "RSI (Relative Strength Index)",
        "period": 14,
        "oversold": 30,
        "overbought": 70,
        "purpose": "Identifikation von Ueberkauft/Ueberverkauft Zustaenden"
      },
      {
        "name": "Bollinger Baender",
        "period": 20,
        "std_dev": 2,
        "purpose": "Volatilitaetsmessung und potenzielle Ausbruchserkennung"
      },
      {
        "name": "Stochastischer Oszillator",
        "period": 14,
        "oversold": 20,
        "overbought": 80,
        "purpose": "Erkennung von Umkehrpunkten im Markt"
      },
      {
        "name": "Volumen",
        "type": "average_ratio",
        "purpose": "Bewertung des Marktinteresses"
      },
      {
        "name": "MACD",
        "fast": 12,
        "slow": 26,
        "signal": 9,
        "purpose": "Identifikation von Kauf- und Verkaufssignalen"
      },
      {
        "name": "ADX",
        "period": 14,
        "threshold": 20,
        "purpose": "Bestaetigung des Seitwaertsmarktes (ADX < 20)"
      }
    ]
  }
}
