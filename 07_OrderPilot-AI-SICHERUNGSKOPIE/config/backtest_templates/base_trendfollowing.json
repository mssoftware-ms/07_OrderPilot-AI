{
  "$schema": "../schemas/backtest_config_v2.schema.json",
  "version": "2.0.0",

  "meta": {
    "name": "Base Trendfollowing",
    "description": "Basis-Template fuer Trend-Following Strategien. Optimiert fuer Trendmaerkte mit ADX-Filter und EMA-Alignment.",
    "author": "OrderPilot-AI",
    "tags": ["trendfollowing", "base", "trend", "ema", "adx"],
    "target_asset_class": "crypto",
    "target_timeframe": "5m",
    "scenario_type": "balanced"
  },

  "strategy_profile": {
    "type": "trendfollowing",
    "preset": "W1",
    "direction_bias": "BOTH"
  },

  "entry_score": {
    "weights": {
      "use_preset": "W1",
      "custom": null
    },
    "weight_presets": {
      "W0": { "trend": 0.25, "rsi": 0.15, "macd": 0.20, "adx": 0.15, "vol": 0.10, "volume": 0.15 },
      "W1": { "trend": 0.35, "rsi": 0.10, "macd": 0.15, "adx": 0.20, "vol": 0.10, "volume": 0.10 },
      "W2": { "trend": 0.25, "rsi": 0.20, "macd": 0.20, "adx": 0.10, "vol": 0.15, "volume": 0.10 }
    },
    "thresholds": {
      "min_score_for_entry": { "value": 0.60, "optimize": true, "range": [0.55, 0.60, 0.65, 0.70] }
    },
    "gates": {
      "block_in_chop": true,
      "block_against_strong_trend": true,
      "allow_counter_trend_sfp": false
    },
    "indicator_params": {
      "ema_short": 20,
      "ema_medium": 50,
      "ema_long": 200,
      "rsi_period": 14,
      "adx_strong_trend": 25.0
    }
  },

  "entry_triggers": {
    "breakout": {
      "enabled": true,
      "volume_multiplier": { "value": 1.5, "optimize": true, "range": [1.2, 1.5, 2.0] },
      "close_threshold": { "value": 0.5, "optimize": false }
    },
    "pullback": {
      "enabled": true,
      "max_distance_atr": { "value": 1.2, "optimize": true, "range": [1.0, 1.2, 1.6] },
      "rejection_wick_pct": { "value": 0.3, "optimize": false }
    },
    "sfp": {
      "enabled": false,
      "wick_body_ratio": { "value": 2.0, "optimize": false },
      "penetration_pct": { "value": 0.3, "optimize": false }
    }
  },

  "exit_management": {
    "stop_loss": {
      "type": "atr_based",
      "atr_multiplier": { "value": 2.0, "optimize": true, "range": [1.6, 2.0, 2.4] },
      "percent": { "value": 1.0, "optimize": false }
    },
    "take_profit": {
      "type": "atr_based",
      "atr_multiplier": { "value": 2.5, "optimize": true, "range": [2.0, 2.5, 3.0] },
      "use_level": true
    },
    "trailing_stop": {
      "enabled": true,
      "move_to_breakeven": true,
      "activation_atr": { "value": 1.5, "optimize": true, "range": [1.0, 1.5, 2.0] },
      "distance_atr": { "value": 0.9, "optimize": true, "range": [0.6, 0.9, 1.2] },
      "step_percent": { "value": 0.25, "optimize": false }
    },
    "partial_tp": {
      "enabled": false,
      "tp1_percent": 50,
      "tp1_rr": 1.0
    },
    "time_stop": {
      "enabled": false,
      "max_holding_minutes": 480
    }
  },

  "risk_leverage": {
    "risk_per_trade_pct": { "value": 0.75, "optimize": true, "range": [0.50, 0.75, 1.00] },
    "base_leverage": { "value": 5, "optimize": true, "range": [3, 5, 8] },
    "max_leverage": 15,
    "min_liquidation_distance_pct": 5.0,
    "max_daily_loss_pct": 3.0,
    "max_trades_per_day": 10,
    "max_concurrent_positions": 1,
    "max_loss_streak": 3,
    "cooldown_after_streak_min": 60
  },

  "execution_simulation": {
    "initial_capital": 1000.0,
    "fee_maker_pct": 0.02,
    "fee_taker_pct": 0.06,
    "assume_taker": true,
    "slippage_method": "fixed_bps",
    "slippage_bps": 5.0,
    "funding_rate_8h": 0.01
  },

  "optimization": {
    "method": "grid",
    "max_iterations": 500,
    "target_metric": "expectancy",
    "minimize": false,
    "n_jobs": -1,
    "seed": 42
  },

  "walk_forward": {
    "enabled": true,
    "train_window_days": 90,
    "test_window_days": 30,
    "step_size_days": 30,
    "min_folds": 4,
    "reoptimize_each_fold": true
  },

  "parameter_groups": [],

  "conditionals": [
    {
      "if": { "risk_leverage.base_leverage": { ">=": 10 } },
      "then": { "risk_leverage.min_liquidation_distance_pct": 7.0 }
    }
  ],

  "constraints": {
    "min_trades": 50,
    "max_drawdown_pct": 30,
    "min_win_rate": 0.45,
    "min_profit_factor": 1.2,
    "min_sharpe": 0.5,
    "weights_must_sum_to_one": true
  }
}
