# Trend Pullback Strategy
#
# Classic Trend Following: Buy dips in an uptrend, Sell rallies in a downtrend.
#
# Logic:
# - Trend Filter: Price > EMA 200 (Long) or Price < EMA 200 (Short)
# - Pullback: RSI drops below 30 (Long) or rises above 70 (Short)
# - Trigger: Price closes back in direction of trend (e.g. above previous high or candle pattern)
#
# Recommended: BTC, NQ, 1m/5m

name: "Trend Pullback"
version: "1.0.0"
category: "Trend Following"
author: "OrderPilot-AI"
description: |
  Trades in the direction of the main trend (EMA 200) entering on pullbacks (RSI).
  High probability setup for trending markets.

asset_class: crypto
recommended_symbols: ["BTC/USD", "ETH/USD", "NQ"]
recommended_timeframes: ["1m", "5m", "15m"]

indicators:
  - type: EMA
    alias: ema_trend
    params: { period: 200 }
    source: close
    plot: true

  - type: RSI
    alias: rsi
    params: { period: 14 }
    source: close
    plot: true

  - type: ATR
    alias: atr
    params: { period: 14 }
    plot: true

entry_long:
  type: composite
  operator: AND
  conditions:
    # 1. Trend Filter
    - type: condition
      left: close
      operator: ">"
      right: ema_trend
      description: "Uptrend: Price above EMA 200"

    # 2. Pullback
    - type: condition
      left: rsi
      operator: "<"
      right: 40
      description: "Pullback: RSI < 40 (Deep dip in uptrend)"

    # 3. Reversal Confirmation (Optional but recommended: RSI hooks up)
    # Simplified: RSI Low was lower than current RSI (Hook) - hard to express in simple YAML without 'prev'
    # relying on the level for now.

exit_long:
  type: composite
  operator: OR
  conditions:
    - type: condition
      left: rsi
      operator: ">"
      right: 70
      description: "Exit on strength: RSI > 70"

    - type: condition
      left: close
      operator: "<"
      right: ema_trend
      description: "Trend broken: Price below EMA 200"

risk_management:
  stop_loss_atr_multiplier: 2.0
  take_profit_atr_multiplier: 3.0
  trailing_stop_enabled: true
  trailing_stop_trigger_pct: 1.0
  trailing_stop_distance_atr: 1.5

backtest:
  initial_capital: 10000
  commission: 0.0005
