# Bollinger Squeeze Breakout Strategy
#
# Capture explosive moves after periods of low volatility.
#
# Logic:
# - Squeeze: Bollinger Bands are inside Keltner Channels (or Bandwidth is low)
# - Entry Long: Price breaks above Upper Bollinger Band + Volume Spike
# - Exit: Trailing Stop (ATR based) or Momentum loss
#
# Recommended: BTC/USD, NQ (Nasdaq) on 1m/5m timeframe

name: "Bollinger Squeeze Breakout"
version: "1.0.0"
category: "Breakout"
author: "OrderPilot-AI"
description: |
  Identifies periods of low volatility (Squeeze) and trades the subsequent explosive breakout.
  Uses Volume and Close confirmation to filter fakeouts.

# Asset Class
asset_class: crypto
recommended_symbols:
  - "BTC/USD"
  - "ETH/USD"
  - "NQ" # Nasdaq Futures equivalent

# Timeframes
recommended_timeframes:
  - "1m"
  - "5m"
  - "15m"

# Indicators
indicators:
  # Bollinger Bands (20, 2.0)
  - type: BBANDS
    alias: bbands
    params:
      period: 20
      deviation: 2.0
    source: close
    plot: true

  # Keltner Channels (20, 1.5 ATR) - Used for Squeeze detection
  # If KC is not available, we can use BB Width
  - type: KELTNER
    alias: keltner
    params:
      period: 20
      atr_period: 10
      multiplier: 1.5
    source: close
    plot: true

  # Volume SMA for Volume Spike
  - type: SMA
    alias: vol_sma
    params:
      period: 20
    source: volume
    plot: false

  # ATR for Stops
  - type: ATR
    alias: atr
    params:
      period: 14
    plot: true

  # ADX for Trend Strength after breakout
  - type: ADX
    alias: adx
    params:
      period: 14
    plot: true

# Entry Long
entry_long:
  type: composite
  operator: AND
  conditions:
    # 1. Squeeze Condition: Upper BB inside Upper KC AND Lower BB inside Lower KC
    # (Simplified here to Bandwidth check if KC comparison is complex in engine)
    # Assuming engine supports direct comparison or we use a Bandwidth threshold
    - type: condition
      left: "bbands.upper"
      operator: "<"
      right: "keltner.upper"
      description: "Squeeze: BB Upper inside KC Upper"

    - type: condition
      left: "bbands.lower"
      operator: ">"
      right: "keltner.lower"
      description: "Squeeze: BB Lower inside KC Lower"

    # 2. Breakout Condition: Close above Upper BB
    - type: condition
      left: close
      operator: ">"
      right: "bbands.upper"
      description: "Price closes above Upper Bollinger Band"

    # 3. Volume Confirmation
    - type: condition
      left: volume
      operator: ">"
      right_formula: "vol_sma * 1.5"
      description: "Volume Spike (1.5x average)"

# Exit Long
exit_long:
  type: composite
  operator: OR
  conditions:
    # Trailing Stop via ATR (handled in risk_management, but can be explicit here)
    - type: condition
      left: close
      operator: "<"
      right_formula: "high - (2 * atr)"
      description: "Trailing Stop hit (2 ATR from High)"

    # Reversion to Mean (optional take profit)
    - type: condition
      left: close
      operator: "<"
      right: "bbands.middle"
      description: "Price returns to mean"

# Risk Management
risk_management:
  stop_loss_atr_multiplier: 1.5  # Tight stop initially
  take_profit_atr_multiplier: 4.0 # Let winners run
  trailing_stop_enabled: true
  trailing_stop_trigger_pct: 0.5 # Activate early for scalping
  trailing_stop_distance_atr: 2.0

# Backtest
backtest:
  initial_capital: 10000
  commission: 0.0005
  slippage: 0.0001
