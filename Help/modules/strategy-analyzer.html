<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Analyzer - OrderPilot-AI Help</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>OrderPilot-AI Help <span class="version-badge">v1.0.0</span></h1>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="../index.html">‚Üê Zur√ºck zur √úbersicht</a></li>
            <li><a href="#overview">√úbersicht</a></li>
            <li><a href="#api">API</a></li>
            <li><a href="#examples">Beispiele</a></li>
            <li><a href="#best-practices">Best Practices</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Overview Section -->
        <section id="overview">
            <h2>üìä Strategy Analyzer - √úbersicht</h2>

            <div class="alert info">
                <strong>Zweck:</strong> Der StrategyAnalyzer extrahiert automatisch alle relevanten Informationen aus hardkodierten Python-Strategieklassen mittels Abstract Syntax Tree (AST) Parsing.
            </div>

            <h3>Hauptfunktionen</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>AST-basierte Analyse</h3>
                    <p>Parst Python-Quellcode und extrahiert Strategielogik ohne Code-Ausf√ºhrung.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìã</div>
                    <h3>Condition Extraction</h3>
                    <p>Erkennt Entry- und Exit-Bedingungen mit allen Operatoren und Schwellenwerten.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìà</div>
                    <h3>Indicator Detection</h3>
                    <p>Identifiziert alle verwendeten technischen Indikatoren automatisch.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚öôÔ∏è</div>
                    <h3>Risk Parameter Extraction</h3>
                    <p>Extrahiert Position Size, Stop Loss und Take Profit Parameter.</p>
                </div>
            </div>

            <h3>Architektur</h3>
            <pre><code class="language-python">StrategyAnalyzer
‚îú‚îÄ‚îÄ analyze_strategy_class()      # Analysiert Python-Klassendefinition
‚îú‚îÄ‚îÄ analyze_strategy_definition()  # Analysiert StrategyDefinition Objekt
‚îú‚îÄ‚îÄ _extract_conditions()          # Extrahiert Bedingungen
‚îú‚îÄ‚îÄ _extract_indicators()          # Extrahiert Indikatoren
‚îî‚îÄ‚îÄ _extract_risk_parameters()     # Extrahiert Risikoparameter</code></pre>
        </section>

        <!-- API Documentation -->
        <section id="api">
            <h2>üîß API Dokumentation</h2>

            <h3>Klasse: <code>StrategyAnalyzer</code></h3>

            <div class="accordion-header">
                <span><strong>__init__(catalog: StrategyCatalog | None = None)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Initialisiert den StrategyAnalyzer.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>catalog</code> (StrategyCatalog | None): Optional. Strategy Catalog f√ºr Metadaten-Lookup.</li>
                </ul>
                <p><strong>Beispiel:</strong></p>
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.strategies.catalog import StrategyCatalog

catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>analyze_strategy_class(strategy_class: type) ‚Üí StrategyAnalysis</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Analysiert eine hardkodierte Strategieklasse.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>strategy_class</code> (type): Python-Klasse der Strategie (muss von BaseStrategy erben)</li>
                </ul>
                <p><strong>R√ºckgabe:</strong> <code>StrategyAnalysis</code> - Vollst√§ndige Analyse-Ergebnisse</p>
                <p><strong>Beispiel:</strong></p>
                <pre><code class="language-python">from src.core.tradingbot.strategies.trend_following import TrendFollowingConservative

analysis = analyzer.analyze_strategy_class(TrendFollowingConservative)
print(f"Name: {analysis.name}")
print(f"Type: {analysis.strategy_type}")
print(f"Entry Conditions: {len(analysis.entry_conditions)}")
print(f"Required Indicators: {[dep.name for dep in analysis.required_indicators]}")</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>analyze_strategy_definition(strategy_def: StrategyDefinition) ‚Üí StrategyAnalysis</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Analysiert eine StrategyDefinition aus dem Catalog.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>strategy_def</code> (StrategyDefinition): Strategy Definition Objekt</li>
                </ul>
                <p><strong>R√ºckgabe:</strong> <code>StrategyAnalysis</code> - Vollst√§ndige Analyse-Ergebnisse</p>
                <p><strong>Beispiel:</strong></p>
                <pre><code class="language-python">from src.core.tradingbot.strategies.catalog import StrategyCatalog

catalog = StrategyCatalog()
strategy_def = catalog.get_strategy("trend_following_conservative")

analysis = analyzer.analyze_strategy_definition(strategy_def)
print(f"Position Size: {analysis.position_size}")
print(f"Stop Loss: {analysis.stop_loss}")
print(f"Take Profit: {analysis.take_profit}")</code></pre>
            </div>

            <h3>Klasse: <code>StrategyAnalysis</code></h3>
            <p>Datenklasse mit allen Analyseergebnissen:</p>

            <pre><code class="language-python">@dataclass
class StrategyAnalysis:
    """Complete analysis result of a hardcoded strategy."""

    name: str                                  # Strategiename (z.B. "Trend Following Conservative")
    strategy_type: str                         # Typ (z.B. "trend_following")
    entry_conditions: list[ConditionInfo]      # Entry-Bedingungen
    exit_conditions: list[ConditionInfo]       # Exit-Bedingungen
    required_indicators: list[IndicatorDep]    # Ben√∂tigte Indikatoren
    position_size: float                       # Positionsgr√∂√üe (z.B. 0.02 = 2%)
    stop_loss: float                           # Stop Loss (z.B. 0.02 = 2%)
    take_profit: float                         # Take Profit (z.B. 0.06 = 6%)
    metadata: dict[str, Any]                   # Zus√§tzliche Metadaten</code></pre>

            <h3>Klasse: <code>ConditionInfo</code></h3>
            <p>Beschreibt eine einzelne Bedingung:</p>

            <pre><code class="language-python">@dataclass
class ConditionInfo:
    """Information about a single condition."""

    indicator: str                  # Indikatorname (z.B. "rsi", "adx")
    operator: str                   # Operator ("&gt;", "&lt;", "==", "between")
    value: float | None             # Vergleichswert (bei Konstanten)
    compare_indicator: str | None   # Vergleichsindikator (bei Indikator-Vergleich)
    min_value: float | None         # Minimum (bei "between")
    max_value: float | None         # Maximum (bei "between")</code></pre>

            <h3>Klasse: <code>IndicatorDep</code></h3>
            <p>Beschreibt eine Indikator-Abh√§ngigkeit:</p>

            <pre><code class="language-python">@dataclass
class IndicatorDep:
    """Indicator dependency information."""

    name: str                       # Indikatorname (z.B. "rsi", "sma_fast")
    parameters: dict[str, Any]      # Parameter (z.B. {"period": 14})</code></pre>
        </section>

        <!-- Examples Section -->
        <section id="examples">
            <h2>üí° Praktische Beispiele</h2>

            <h3>Beispiel 1: Einfache Strategieanalyse</h3>
            <div class="code-block">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.strategies.trend_following import TrendFollowingConservative

# Analyzer initialisieren
analyzer = StrategyAnalyzer()

# Strategie analysieren
analysis = analyzer.analyze_strategy_class(TrendFollowingConservative)

# Ergebnisse ausgeben
print(f"=== {analysis.name} ===")
print(f"Typ: {analysis.strategy_type}")
print(f"\nEntry Conditions ({len(analysis.entry_conditions)}):")
for cond in analysis.entry_conditions:
    if cond.compare_indicator:
        print(f"  - {cond.indicator} {cond.operator} {cond.compare_indicator}")
    elif cond.min_value and cond.max_value:
        print(f"  - {cond.indicator} between {cond.min_value} and {cond.max_value}")
    else:
        print(f"  - {cond.indicator} {cond.operator} {cond.value}")

print(f"\nRequired Indicators ({len(analysis.required_indicators)}):")
for dep in analysis.required_indicators:
    print(f"  - {dep.name}: {dep.parameters}")

print(f"\nRisk Parameters:")
print(f"  - Position Size: {analysis.position_size * 100}%")
print(f"  - Stop Loss: {analysis.stop_loss * 100}%")
print(f"  - Take Profit: {analysis.take_profit * 100}%")</code></pre>
            </div>

            <h3>Beispiel 2: Batch-Analyse aller Strategien</h3>
            <div class="code-block">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.strategies.catalog import StrategyCatalog

catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)

# Alle Strategien analysieren
all_strategies = catalog.list_strategies()

results = []
for strategy_name in all_strategies:
    strategy_def = catalog.get_strategy(strategy_name)
    analysis = analyzer.analyze_strategy_definition(strategy_def)
    results.append(analysis)
    print(f"‚úì Analyzed: {analysis.name}")

# Statistiken ausgeben
print(f"\n=== Analysis Summary ===")
print(f"Total Strategies: {len(results)}")
print(f"Strategy Types: {len(set(r.strategy_type for r in results))}")
print(f"Unique Indicators: {len(set(dep.name for r in results for dep in r.required_indicators))}")

# Komplexit√§t nach Anzahl der Bedingungen
print(f"\nComplexity Ranking:")
for analysis in sorted(results, key=lambda x: len(x.entry_conditions) + len(x.exit_conditions), reverse=True):
    total_conditions = len(analysis.entry_conditions) + len(analysis.exit_conditions)
    print(f"  {analysis.name}: {total_conditions} conditions")</code></pre>
            </div>

            <h3>Beispiel 3: Indikator-Nutzungsanalyse</h3>
            <div class="code-block">
                <pre><code class="language-python">from collections import Counter
from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.strategies.catalog import StrategyCatalog

catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)

# Alle Indikatoren sammeln
all_indicators = []
for strategy_name in catalog.list_strategies():
    strategy_def = catalog.get_strategy(strategy_name)
    analysis = analyzer.analyze_strategy_definition(strategy_def)
    all_indicators.extend([dep.name for dep in analysis.required_indicators])

# H√§ufigkeit z√§hlen
indicator_usage = Counter(all_indicators)

print("=== Indicator Usage Statistics ===")
for indicator, count in indicator_usage.most_common():
    percentage = (count / len(catalog.list_strategies())) * 100
    print(f"{indicator:20s}: {count} strategies ({percentage:.1f}%)")</code></pre>
            </div>

            <h3>Beispiel 4: Condition-Extraktion im Detail</h3>
            <div class="code-block">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.strategies.catalog import StrategyCatalog

catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)

# RSI-basierte Strategie analysieren
strategy_def = catalog.get_strategy("mean_reversion_rsi")
analysis = analyzer.analyze_strategy_definition(strategy_def)

print(f"=== {analysis.name} - Condition Details ===\n")

print("Entry Conditions:")
for i, cond in enumerate(analysis.entry_conditions, 1):
    print(f"\nCondition {i}:")
    print(f"  Indicator: {cond.indicator}")
    print(f"  Operator: {cond.operator}")
    if cond.compare_indicator:
        print(f"  Compare to: {cond.compare_indicator}")
    elif cond.min_value is not None and cond.max_value is not None:
        print(f"  Range: {cond.min_value} - {cond.max_value}")
    else:
        print(f"  Value: {cond.value}")

print("\n\nExit Conditions:")
for i, cond in enumerate(analysis.exit_conditions, 1):
    print(f"\nCondition {i}:")
    print(f"  Indicator: {cond.indicator}")
    print(f"  Operator: {cond.operator}")
    if cond.compare_indicator:
        print(f"  Compare to: {cond.compare_indicator}")
    elif cond.min_value is not None and cond.max_value is not None:
        print(f"  Range: {cond.min_value} - {cond.max_value}")
    else:
        print(f"  Value: {cond.value}")</code></pre>
            </div>
        </section>

        <!-- Best Practices Section -->
        <section id="best-practices">
            <h2>‚úÖ Best Practices</h2>

            <h3>1. Immer mit Catalog arbeiten</h3>
            <div class="alert info">
                <p>Nutzen Sie den StrategyCatalog, um konsistente Metadaten zu erhalten:</p>
                <pre><code class="language-python"># ‚úÖ RICHTIG - Mit Catalog
catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)
analysis = analyzer.analyze_strategy_definition(catalog.get_strategy("trend_following_conservative"))

# ‚ùå FALSCH - Ohne Catalog
analyzer = StrategyAnalyzer()
analysis = analyzer.analyze_strategy_class(TrendFollowingConservative)  # Metadaten fehlen!</code></pre>
            </div>

            <h3>2. Fehlerbehandlung implementieren</h3>
            <div class="alert warning">
                <p>AST-Parsing kann fehlschlagen bei ung√ºltigen Strategieklassen:</p>
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer, AnalysisError

analyzer = StrategyAnalyzer()

try:
    analysis = analyzer.analyze_strategy_class(MyCustomStrategy)
except AnalysisError as e:
    print(f"Analysis failed: {e}")
    # Fallback oder Logging</code></pre>
            </div>

            <h3>3. Validierung der Ergebnisse</h3>
            <div class="alert success">
                <p>Pr√ºfen Sie immer die Vollst√§ndigkeit der Analyse:</p>
                <pre><code class="language-python">analysis = analyzer.analyze_strategy_class(SomeStrategy)

# Validierung
assert analysis.entry_conditions, "No entry conditions found!"
assert analysis.required_indicators, "No indicators detected!"
assert analysis.position_size > 0, "Invalid position size!"
assert 0 < analysis.stop_loss < 1, "Stop loss out of range!"
assert 0 < analysis.take_profit < 1, "Take profit out of range!"

print("‚úì Analysis validation passed")</code></pre>
            </div>

            <h3>4. Performance-Optimierung bei Batch-Analysen</h3>
            <div class="alert info">
                <p>Nutzen Sie Caching f√ºr wiederholte Analysen:</p>
                <pre><code class="language-python">from functools import lru_cache

class CachedAnalyzer:
    def __init__(self, catalog):
        self.analyzer = StrategyAnalyzer(catalog)
        self.cache = {}

    def analyze_strategy(self, strategy_name: str) -> StrategyAnalysis:
        if strategy_name not in self.cache:
            strategy_def = catalog.get_strategy(strategy_name)
            self.cache[strategy_name] = self.analyzer.analyze_strategy_definition(strategy_def)
        return self.cache[strategy_name]

# Nutzung
cached_analyzer = CachedAnalyzer(catalog)
analysis1 = cached_analyzer.analyze_strategy("trend_following_conservative")  # Berechnet
analysis2 = cached_analyzer.analyze_strategy("trend_following_conservative")  # Aus Cache</code></pre>
            </div>

            <h3>5. Debugging-Tipps</h3>
            <div class="alert warning">
                <p>Bei unerwarteten Ergebnissen:</p>
                <ul>
                    <li><strong>Logging aktivieren:</strong> <code>logging.basicConfig(level=logging.DEBUG)</code></li>
                    <li><strong>AST-Dump pr√ºfen:</strong> Schauen Sie sich den generierten AST an</li>
                    <li><strong>Schrittweise testen:</strong> Analysieren Sie einzelne Methoden separat</li>
                    <li><strong>Referenzvergleich:</strong> Vergleichen Sie mit manuell extrahierten Werten</li>
                </ul>
                <pre><code class="language-python">import logging
logging.basicConfig(level=logging.DEBUG)

# Debug-Output
analyzer = StrategyAnalyzer()
analysis = analyzer.analyze_strategy_class(MyStrategy)

# AST-Struktur anzeigen
import ast
source = inspect.getsource(MyStrategy)
tree = ast.parse(source)
print(ast.dump(tree, indent=2))</code></pre>
            </div>

            <h3>6. Integration mit JSON Generator</h3>
            <div class="alert success">
                <p>Der StrategyAnalyzer ist f√ºr die Pipeline mit dem JSONConfigGenerator optimiert:</p>
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.migration.json_generator import JSONConfigGenerator
from src.core.tradingbot.strategies.catalog import StrategyCatalog

# Pipeline aufbauen
catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)
generator = JSONConfigGenerator()

# Strategie konvertieren
strategy_def = catalog.get_strategy("trend_following_conservative")
analysis = analyzer.analyze_strategy_definition(strategy_def)
json_config = generator.generate_from_analysis(analysis)

# Speichern
generator.save_config(json_config, "output/trend_following_conservative.json")
print("‚úì Strategy converted and saved")</code></pre>
            </div>
        </section>

        <!-- Common Errors Section -->
        <section id="errors">
            <h2>‚ö†Ô∏è H√§ufige Fehler und L√∂sungen</h2>

            <div class="accordion-header">
                <span><strong>Fehler: "No entry conditions found"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Die Strategie hat keine <code>should_enter()</code> Methode oder diese ist leer.</p>
                <p><strong>L√∂sung:</strong></p>
                <pre><code class="language-python"># Pr√ºfen Sie, ob die Methode existiert
import inspect
if hasattr(strategy_class, 'should_enter'):
    source = inspect.getsource(strategy_class.should_enter)
    print(source)  # Methode anzeigen</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>Fehler: "Unknown indicator: custom_indicator"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Custom Indicator ist nicht im JSONConfigGenerator registriert.</p>
                <p><strong>L√∂sung:</strong> Erweitern Sie die Indicator-Map im Generator:
                <pre><code class="language-python"># In json_generator.py
indicator_map = {
    # ... existing indicators ...
    "custom_indicator": {"type": "SMA", "params": {"period": 20}},
}</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>Fehler: "Invalid operator detected"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Die Strategie nutzt einen nicht unterst√ºtzten Vergleichsoperator.</p>
                <p><strong>Unterst√ºtzte Operatoren:</strong> <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>between</code></p>
                <p><strong>L√∂sung:</strong> Schreiben Sie die Bedingung um oder erweitern Sie den Analyzer.</p>
            </div>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Dokumentation</h3>
                <ul>
                    <li><a href="../index.html">Hauptseite</a></li>
                    <li><a href="json-generator.html">JSON Generator</a></li>
                    <li><a href="strategy-comparator.html">Strategy Comparator</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul>
                    <li><a href="#api">API Reference</a></li>
                    <li><a href="#examples">Code Examples</a></li>
                    <li><a href="#best-practices">Best Practices</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Support</h3>
                <ul>
                    <li><a href="https://github.com/OrderPilot-AI">GitHub</a></li>
                    <li><a href="#errors">Troubleshooting</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 OrderPilot-AI. Migration Framework Documentation.</p>
        </div>
    </footer>

    <script src="../assets/script.js"></script>
</body>
</html>