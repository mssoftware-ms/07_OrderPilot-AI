<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Config Generator - OrderPilot-AI Help</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>OrderPilot-AI Help <span class="version-badge">v1.0.0</span></h1>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="../index.html">‚Üê Zur√ºck zur √úbersicht</a></li>
            <li><a href="#overview">√úbersicht</a></li>
            <li><a href="#api">API</a></li>
            <li><a href="#examples">Beispiele</a></li>
            <li><a href="#best-practices">Best Practices</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Overview Section -->
        <section id="overview">
            <h2>üîß JSON Config Generator - √úbersicht</h2>

            <div class="alert info">
                <strong>Zweck:</strong> Der JSONConfigGenerator konvertiert StrategyAnalysis-Objekte in vollst√§ndige JSON-Konfigurationsdateien, die vom TradingBot-Core geladen und ausgef√ºhrt werden k√∂nnen.
            </div>

            <h3>Hauptfunktionen</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üìù</div>
                    <h3>JSON-Generierung</h3>
                    <p>Wandelt Python-Analysen in schema-konformes JSON um.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîÑ</div>
                    <h3>ID-Normalisierung</h3>
                    <p>56 Indicator-Mappings f√ºr konsistente ID-Vergabe.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Regime-Generierung</h3>
                    <p>Automatische Ableitung von Marktregimes aus Strategiebedingungen.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üì¶</div>
                    <h3>Batch-Konvertierung</h3>
                    <p>Mehrere Strategien in einer Datei kombinieren.</p>
                </div>
            </div>

            <h3>Schema-Version</h3>
            <p>Aktuelle Schema-Version: <span class="highlight">1.0.0</span></p>
            <p>Alle generierten Configs sind kompatibel mit:</p>
            <ul>
                <li>TradingBotConfig Pydantic Model</li>
                <li>ConfigLoader & Validator</li>
                <li>Trading Bot Core Engine</li>
            </ul>

            <h3>Generierte JSON-Struktur</h3>
            <pre><code class="language-json">{
  "schema_version": "1.0.0",
  "indicators": [...],      // Alle ben√∂tigten Indikatoren
  "regimes": [...],         // Marktregimes (optional)
  "strategies": [...],      // Strategiedefinitionen
  "strategy_sets": [...],   // Strategy Sets (optional)
  "routing": [...]          // Routing-Regeln (optional)
}</code></pre>
        </section>

        <!-- API Documentation -->
        <section id="api">
            <h2>üîß API Dokumentation</h2>

            <h3>Klasse: <code>JSONConfigGenerator</code></h3>

            <div class="accordion-header">
                <span><strong>__init__(schema_version: str = "1.0.0")</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Initialisiert den Generator mit optionaler Schema-Version.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>schema_version</code> (str): Schema-Version f√ºr generierte Configs (Standard: "1.0.0")</li>
                </ul>
                <pre><code class="language-python">from src.core.tradingbot.migration.json_generator import JSONConfigGenerator

generator = JSONConfigGenerator(schema_version="1.0.0")</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>generate_from_analysis(analysis, include_regime=True, include_strategy_set=True) ‚Üí dict</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Generiert JSON-Config aus einer einzelnen StrategyAnalysis.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>analysis</code> (StrategyAnalysis): Analyseergebnis vom StrategyAnalyzer</li>
                    <li><code>include_regime</code> (bool): Regime automatisch generieren (Standard: True)</li>
                    <li><code>include_strategy_set</code> (bool): Strategy Set & Routing generieren (Standard: True)</li>
                </ul>
                <p><strong>R√ºckgabe:</strong> dict - Vollst√§ndige JSON-Config</p>
                <pre><code class="language-python">analysis = analyzer.analyze_strategy_definition(strategy_def)
json_config = generator.generate_from_analysis(
    analysis,
    include_regime=True,
    include_strategy_set=True
)</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>generate_from_multiple_analyses(analyses: list[StrategyAnalysis]) ‚Üí dict</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Kombiniert mehrere Strategien in einer JSON-Config.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>analyses</code> (list[StrategyAnalysis]): Liste von Analyseergebnissen</li>
                </ul>
                <p><strong>R√ºckgabe:</strong> dict - Kombinierte JSON-Config</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Automatische Deduplizierung von Indikatoren</li>
                    <li>Ein Regime pro Strategy-Type</li>
                    <li>Ein Strategy Set pro Strategy-Type</li>
                    <li>Optimierte Routing-Regeln</li>
                </ul>
                <pre><code class="language-python">analyses = [
    analyzer.analyze_strategy_definition(catalog.get_strategy("trend_following_conservative")),
    analyzer.analyze_strategy_definition(catalog.get_strategy("trend_following_aggressive")),
    analyzer.analyze_strategy_definition(catalog.get_strategy("mean_reversion_rsi"))
]

combined_config = generator.generate_from_multiple_analyses(analyses)</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>save_config(config: dict, output_path: Path | str) ‚Üí None</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Speichert JSON-Config in Datei.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>config</code> (dict): JSON-Config Dict</li>
                    <li><code>output_path</code> (Path | str): Zieldatei (Verzeichnis wird automatisch erstellt)</li>
                </ul>
                <pre><code class="language-python">generator.save_config(json_config, "config/strategies/my_strategy.json")</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>generate_and_save(analysis, output_path, ...) ‚Üí None</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Beschreibung:</strong> Generiert und speichert in einem Schritt.</p>
                <p><strong>Parameter:</strong></p>
                <ul>
                    <li><code>analysis</code> (StrategyAnalysis): Analyseergebnis</li>
                    <li><code>output_path</code> (Path | str): Zieldatei</li>
                    <li><code>include_regime</code> (bool): Regime generieren (Standard: True)</li>
                    <li><code>include_strategy_set</code> (bool): Strategy Set generieren (Standard: True)</li>
                </ul>
                <pre><code class="language-python"># One-Liner: Analysieren & Speichern
generator.generate_and_save(
    analysis,
    "output/strategy.json",
    include_regime=True,
    include_strategy_set=True
)</code></pre>
            </div>

            <h3>Indicator ID Normalisierung</h3>
            <p>Der Generator mappt 56 verschiedene Indikator-Namen zu standardisierten IDs:</p>

            <table>
                <thead>
                    <tr>
                        <th>Hardcoded Name</th>
                        <th>JSON ID</th>
                        <th>Typ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><code>rsi</code>, <code>rsi_14</code></td><td><code>rsi14</code></td><td>RSI</td></tr>
                    <tr><td><code>adx</code>, <code>adx_14</code></td><td><code>adx14</code></td><td>ADX</td></tr>
                    <tr><td><code>sma_fast</code>, <code>sma_20</code></td><td><code>sma20</code></td><td>SMA</td></tr>
                    <tr><td><code>sma_slow</code>, <code>sma_50</code></td><td><code>sma50</code></td><td>SMA</td></tr>
                    <tr><td><code>ema_fast</code>, <code>ema_12</code></td><td><code>ema12</code></td><td>EMA</td></tr>
                    <tr><td><code>macd</code></td><td><code>macd12_26_9</code></td><td>MACD</td></tr>
                    <tr><td><code>bb_upper</code></td><td><code>bbands20_upper</code></td><td>BBANDS</td></tr>
                    <tr><td><code>atr</code>, <code>atr_14</code></td><td><code>atr14</code></td><td>ATR</td></tr>
                    <tr><td><code>stoch_k</code></td><td><code>stoch14_k</code></td><td>STOCH</td></tr>
                    <tr><td><code>volume</code></td><td><code>volume</code></td><td>Volume</td></tr>
                </tbody>
            </table>

            <h3>Custom/Derived Indicators</h3>
            <p>12 spezielle Indikatoren werden auf Basis-Typen gemapped:</p>

            <table>
                <thead>
                    <tr>
                        <th>Custom Name</th>
                        <th>Basis-Typ</th>
                        <th>JSON ID</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><code>sma_alignment</code></td><td>SMA</td><td><code>sma20</code></td></tr>
                    <tr><td><code>macd_hist</code></td><td>MACD</td><td><code>macd12_26_9</code></td></tr>
                    <tr><td><code>bb_pct</code></td><td>BBANDS</td><td><code>bbands20_middle</code></td></tr>
                    <tr><td><code>di_spread</code></td><td>ADX</td><td><code>adx14</code></td></tr>
                    <tr><td><code>rsi_momentum</code></td><td>RSI</td><td><code>rsi14</code></td></tr>
                    <tr><td><code>rsi_divergence</code></td><td>RSI</td><td><code>rsi14</code></td></tr>
                    <tr><td><code>price_vs_sma20</code></td><td>SMA</td><td><code>sma20</code></td></tr>
                    <tr><td><code>atr_ratio</code></td><td>ATR</td><td><code>atr14</code></td></tr>
                </tbody>
            </table>
        </section>

        <!-- Examples Section -->
        <section id="examples">
            <h2>üí° Praktische Beispiele</h2>

            <h3>Beispiel 1: Einzelne Strategie konvertieren</h3>
            <div class="code-block">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_analyzer import StrategyAnalyzer
from src.core.tradingbot.migration.json_generator import JSONConfigGenerator
from src.core.tradingbot.strategies.catalog import StrategyCatalog

# Setup
catalog = StrategyCatalog()
analyzer = StrategyAnalyzer(catalog)
generator = JSONConfigGenerator()

# Strategie analysieren
strategy_def = catalog.get_strategy("trend_following_conservative")
analysis = analyzer.analyze_strategy_definition(strategy_def)

# JSON generieren
json_config = generator.generate_from_analysis(analysis)

# Speichern
generator.save_config(json_config, "config/trend_following_conservative.json")
print("‚úì Strategy converted and saved")</code></pre>
            </div>

            <h3>Beispiel 2: Batch-Konvertierung aller Strategien</h3>
            <div class="code-block">
                <pre><code class="language-python">from pathlib import Path

# Output-Verzeichnis erstellen
output_dir = Path("config/bot_configs/migrated")
output_dir.mkdir(parents=True, exist_ok=True)

# Alle Strategien konvertieren
for strategy_name in catalog.list_strategies():
    print(f"Converting: {strategy_name}")

    # Analysieren
    strategy_def = catalog.get_strategy(strategy_name)
    analysis = analyzer.analyze_strategy_definition(strategy_def)

    # Konvertieren & Speichern
    output_path = output_dir / f"{strategy_name}.json"
    generator.generate_and_save(analysis, output_path)

    print(f"  ‚úì Saved to {output_path}")

print(f"\n‚úì Converted {len(catalog.list_strategies())} strategies")</code></pre>
            </div>

            <h3>Beispiel 3: Multi-Strategy JSON (Kombiniert)</h3>
            <div class="code-block">
                <pre><code class="language-python"># Mehrere Strategien in einer Datei
analyses = []

for strategy_name in ["trend_following_conservative",
                       "trend_following_aggressive",
                       "breakout_volatility"]:
    strategy_def = catalog.get_strategy(strategy_name)
    analysis = analyzer.analyze_strategy_definition(strategy_def)
    analyses.append(analysis)

# Kombinierte Config generieren
combined_config = generator.generate_from_multiple_analyses(analyses)

# Speichern
generator.save_config(combined_config, "config/trend_strategies.json")

print(f"‚úì Combined {len(analyses)} strategies into one config")
print(f"  - Indicators: {len(combined_config['indicators'])}")
print(f"  - Regimes: {len(combined_config['regimes'])}")
print(f"  - Strategies: {len(combined_config['strategies'])}")
print(f"  - Strategy Sets: {len(combined_config['strategy_sets'])}")</code></pre>
            </div>

            <h3>Beispiel 4: Minimale Config (ohne Regime & Set)</h3>
            <div class="code-block">
                <pre><code class="language-python"># Nur Strategie, keine Regimes oder Sets
strategy_def = catalog.get_strategy("mean_reversion_rsi")
analysis = analyzer.analyze_strategy_definition(strategy_def)

minimal_config = generator.generate_from_analysis(
    analysis,
    include_regime=False,
    include_strategy_set=False
)

# Resultierende Struktur:
# {
#   "schema_version": "1.0.0",
#   "indicators": [...],   # Nur ben√∂tigte Indikatoren
#   "regimes": [],         # Leer
#   "strategies": [...]    # Eine Strategie
#   "strategy_sets": [],   # Leer
#   "routing": []          # Leer
# }

generator.save_config(minimal_config, "config/minimal_strategy.json")</code></pre>
            </div>

            <h3>Beispiel 5: Custom Schema Version</h3>
            <div class="code-block">
                <pre><code class="language-python"># Generator mit eigener Schema-Version
generator_v2 = JSONConfigGenerator(schema_version="2.0.0-beta")

json_config = generator_v2.generate_from_analysis(analysis)

print(f"Schema Version: {json_config['schema_version']}")
# Output: "Schema Version: 2.0.0-beta"</code></pre>
            </div>

            <h3>Beispiel 6: JSON-Struktur inspizieren</h3>
            <div class="code-block">
                <pre><code class="language-python">import json

# Config generieren
json_config = generator.generate_from_analysis(analysis)

# Sch√∂ne Ausgabe
print(json.dumps(json_config, indent=2))

# Oder spezifische Teile inspizieren
print(f"\n=== Indicators ===")
for ind in json_config['indicators']:
    print(f"  {ind['id']:20s} - {ind['type']:10s} - {ind['params']}")

print(f"\n=== Strategy Entry Conditions ===")
strategy = json_config['strategies'][0]
for cond in strategy['entry']['all']:
    left = cond['left']['indicator_id']
    op = cond['op']
    right = cond['right']
    print(f"  {left} {op} {right}")</code></pre>
            </div>
        </section>

        <!-- Best Practices Section -->
        <section id="best-practices">
            <h2>‚úÖ Best Practices</h2>

            <h3>1. Immer Validierung durchf√ºhren</h3>
            <div class="alert warning">
                <p>Validieren Sie generierte Configs SOFORT mit dem ConfigLoader:</p>
                <pre><code class="language-python">from src.core.tradingbot.config.config_loader import ConfigLoader

# Generieren
json_config = generator.generate_from_analysis(analysis)
generator.save_config(json_config, "output.json")

# Validieren
loader = ConfigLoader()
try:
    validated_config = loader.load_config("output.json")
    print("‚úì Config is valid!")
except ValidationError as e:
    print(f"‚ùå Validation failed: {e}")</code></pre>
            </div>

            <h3>2. Deduplizierung bei Batch-Konvertierung</h3>
            <div class="alert info">
                <p>Nutzen Sie <code>generate_from_multiple_analyses()</code> statt einzelner Configs:</p>
                <pre><code class="language-python"># ‚úÖ RICHTIG - Deduplizierte Indikatoren
analyses = [analyzer.analyze(...) for s in strategies]
combined = generator.generate_from_multiple_analyses(analyses)
# ‚Üí 15 unique indicators statt 40 doppelte

# ‚ùå FALSCH - Doppelte Indikatoren
for analysis in analyses:
    config = generator.generate_from_analysis(analysis)
    # ‚Üí Jede Config hat alle Indikatoren separat</code></pre>
            </div>

            <h3>3. Output-Verzeichnisse organisieren</h3>
            <div class="alert success">
                <p>Strukturieren Sie Ihre Configs:</p>
                <pre><code class="language-python">from pathlib import Path

# Nach Strategy-Type organisieren
strategy_types = {
    "trend_following": [],
    "mean_reversion": [],
    "breakout": [],
    # ...
}

for strategy_name in catalog.list_strategies():
    strategy_def = catalog.get_strategy(strategy_name)
    analysis = analyzer.analyze_strategy_definition(strategy_def)

    # Nach Typ gruppieren
    strategy_type = analysis.strategy_type
    if strategy_type in strategy_types:
        strategy_types[strategy_type].append(analysis)

# Pro Typ eine kombinierte Config
for stype, analyses in strategy_types.items():
    if analyses:
        output_path = Path(f"config/{stype}_strategies.json")
        combined = generator.generate_from_multiple_analyses(analyses)
        generator.save_config(combined, output_path)
        print(f"‚úì {stype}: {len(analyses)} strategies ‚Üí {output_path}")</code></pre>
            </div>

            <h3>4. Pretty-Printing f√ºr Lesbarkeit</h3>
            <div class="alert info">
                <p>Die <code>save_config()</code> Methode nutzt bereits <code>indent=2</code>, aber f√ºr manuelle Saves:</p>
                <pre><code class="language-python">import json

# Manuelles Speichern mit Formatierung
with open("output.json", "w", encoding="utf-8") as f:
    json.dump(
        json_config,
        f,
        indent=2,              # 2 Leerzeichen
        ensure_ascii=False,    # UTF-8 Zeichen erlauben
        sort_keys=False        # Reihenfolge beibehalten
    )</code></pre>
            </div>

            <h3>5. Fehlerbehandlung bei Batch-Konvertierung</h3>
            <div class="alert warning">
                <p>Einzelne Fehler sollten nicht die ganze Batch stoppen:</p>
                <pre><code class="language-python">successful = []
failed = []

for strategy_name in catalog.list_strategies():
    try:
        strategy_def = catalog.get_strategy(strategy_name)
        analysis = analyzer.analyze_strategy_definition(strategy_def)
        json_config = generator.generate_from_analysis(analysis)

        output_path = f"config/{strategy_name}.json"
        generator.save_config(json_config, output_path)
        successful.append(strategy_name)

    except Exception as e:
        print(f"‚ùå Failed: {strategy_name} - {e}")
        failed.append((strategy_name, str(e)))

print(f"\n‚úì Success: {len(successful)}/{len(catalog.list_strategies())}")
if failed:
    print(f"‚ùå Failed: {len(failed)}")
    for name, error in failed:
        print(f"  - {name}: {error}")</code></pre>
            </div>

            <h3>6. Versionierung der Outputs</h3>
            <div class="alert success">
                <p>Speichern Sie Configs mit Timestamps f√ºr Nachverfolgbarkeit:</p>
                <pre><code class="language-python">from datetime import datetime

timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
output_dir = Path(f"config/generated/{timestamp}")
output_dir.mkdir(parents=True, exist_ok=True)

for strategy_name in catalog.list_strategies():
    # ... konvertieren ...
    output_path = output_dir / f"{strategy_name}.json"
    generator.save_config(json_config, output_path)

print(f"‚úì Configs saved to: {output_dir}")</code></pre>
            </div>
        </section>

        <!-- Common Errors Section -->
        <section id="errors">
            <h2>‚ö†Ô∏è H√§ufige Fehler und L√∂sungen</h2>

            <div class="accordion-header">
                <span><strong>Fehler: "Duplicate indicator IDs"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Mehrere Indikatoren normalisieren zum selben ID.</p>
                <p><strong>Beispiel:</strong> <code>sma_20</code> und <code>sma_alignment</code> ‚Üí beide zu <code>sma20</code></p>
                <p><strong>L√∂sung:</strong> Automatisch dedupliziert in v1.0.0 - kein Action n√∂tig!</p>
            </div>

            <div class="accordion-header">
                <span><strong>Fehler: "Unknown indicator type"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Indicator-Typ nicht in UPPERCASE oder nicht im IndicatorType enum.</p>
                <p><strong>L√∂sung:</strong> Pr√ºfen Sie die Typ-Schreibweise in <code>json_generator.py</code>:
                <pre><code class="language-python"># ‚úÖ RICHTIG
"rsi": {"type": "RSI", ...}

# ‚ùå FALSCH
"rsi": {"type": "rsi", ...}  # Kleinbuchstaben!</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>Fehler: "Empty indicator params"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Pydantic-Validierung erfordert nicht-leere Parameter.</p>
                <p><strong>L√∂sung:</strong> Immer Minimal-Parameter angeben:
                <pre><code class="language-python"># ‚úÖ RICHTIG
"volume": {"type": "Volume", "params": {"window": 1}}

# ‚ùå FALSCH
"volume": {"type": "Volume", "params": {}}</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>Fehler: "FileNotFoundError when saving"</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Ursache:</strong> Parent-Verzeichnis existiert nicht.</p>
                <p><strong>L√∂sung:</strong> <code>save_config()</code> erstellt Verzeichnisse automatisch - Bug melden falls nicht!</p>
            </div>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Dokumentation</h3>
                <ul>
                    <li><a href="../index.html">Hauptseite</a></li>
                    <li><a href="strategy-analyzer.html">Strategy Analyzer</a></li>
                    <li><a href="strategy-comparator.html">Strategy Comparator</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul>
                    <li><a href="#api">API Reference</a></li>
                    <li><a href="#examples">Code Examples</a></li>
                    <li><a href="#best-practices">Best Practices</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Support</h3>
                <ul>
                    <li><a href="https://github.com/OrderPilot-AI">GitHub</a></li>
                    <li><a href="#errors">Troubleshooting</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 OrderPilot-AI. Migration Framework Documentation.</p>
        </div>
    </footer>

    <script src="../assets/script.js"></script>
</body>
</html>