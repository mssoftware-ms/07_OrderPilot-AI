<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Testing - OrderPilot-AI Help</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>OrderPilot-AI Help <span class="version-badge">v1.0.0</span></h1>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="../index.html">‚Üê Zur√ºck zur √úbersicht</a></li>
            <li><a href="#overview">√úbersicht</a></li>
            <li><a href="#test-suite">Test Suite</a></li>
            <li><a href="#running">Tests ausf√ºhren</a></li>
            <li><a href="#results">Ergebnisse</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="overview">
            <h2>üß™ Migration Testing - √úbersicht</h2>

            <div class="alert success">
                <strong>Aktueller Status:</strong> 46/46 Tests PASSING (100%)<br>
                <strong>Migrierte Strategien:</strong> 9/9 (100%)<br>
                <strong>Equivalence Rate:</strong> 100%
            </div>

            <h3>Test-Pyramide</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">1Ô∏è‚É£</div>
                    <h3>Unit Tests</h3>
                    <p>36 Tests - Einzelne Komponenten (Analyze, Convert, Validate)</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">2Ô∏è‚É£</div>
                    <h3>Integration Tests</h3>
                    <p>7 Tests - Pipeline-Tests (Analyze ‚Üí Convert ‚Üí Compare)</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">3Ô∏è‚É£</div>
                    <h3>Equivalence Tests</h3>
                    <p>9 Tests - JSON vs. Hardcoded (Critical!)</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">4Ô∏è‚É£</div>
                    <h3>E2E Tests</h3>
                    <p>3 Tests - Batch Migration & Reporting</p>
                </div>
            </div>

            <h3>Test-Datei</h3>
            <p><code>tests/core/tradingbot/test_migration_suite.py</code> (514 LOC, 46 Tests)</p>
        </section>

        <section id="test-suite">
            <h2>üìã Test Suite Struktur</h2>

            <h3>5 Test-Klassen</h3>

            <div class="accordion-header">
                <span><strong>TestIndividualStrategyMigration (36 Tests)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Zweck:</strong> Testet alle 9 Strategien einzeln durch alle Pipeline-Schritte.</p>
                <p><strong>Tests pro Strategie (4x):</strong></p>
                <ul>
                    <li><code>test_analyze_strategy_{name}</code> - StrategyAnalyzer</li>
                    <li><code>test_convert_to_json_{name}</code> - JSONConfigGenerator</li>
                    <li><code>test_validate_json_{name}</code> - ConfigLoader & Pydantic</li>
                    <li><code>test_converted_strategy_is_equivalent_{name}</code> - StrategyComparator</li>
                </ul>
                <p><strong>Parametrization:</strong></p>
                <pre><code class="language-python">ALL_STRATEGIES = [
    "trend_following_conservative",
    "trend_following_aggressive",
    "mean_reversion_bb",
    "mean_reversion_rsi",
    "breakout_volatility",
    "breakout_momentum",
    "momentum_macd",
    "scalping_range",
    "sideways_range_bounce",
]

@pytest.mark.parametrize("strategy_name", ALL_STRATEGIES)
def test_analyze_strategy(self, catalog, analyzer, strategy_name):
    # Test implementation
    ...</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>TestBatchMigration (2 Tests)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Tests:</strong></p>
                <ul>
                    <li><code>test_batch_migration_all_strategies</code> - Alle 9 Strategien in einem Durchlauf</li>
                    <li><code>test_combined_json_generation</code> - Multi-Strategy JSON</li>
                </ul>
            </div>

            <div class="accordion-header">
                <span><strong>TestMigrationMetrics (3 Tests)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Tests:</strong></p>
                <ul>
                    <li><code>test_migration_success_rate</code> - 100% Success Rate</li>
                    <li><code>test_indicator_coverage</code> - Alle Indikatoren abgedeckt</li>
                    <li><code>test_equivalence_percentage</code> - 100% Equivalence</li>
                </ul>
            </div>

            <div class="accordion-header">
                <span><strong>TestMigrationOutputs (3 Tests)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Tests:</strong></p>
                <ul>
                    <li><code>test_generated_json_schema_compliance</code> - Schema Version 1.0.0</li>
                    <li><code>test_indicator_deduplication</code> - Keine doppelten Indikatoren</li>
                    <li><code>test_risk_parameter_preservation</code> - Risk Settings korrekt</li>
                </ul>
            </div>

            <div class="accordion-header">
                <span><strong>TestMigrationReports (2 Tests)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Tests:</strong></p>
                <ul>
                    <li><code>test_migration_summary_report</code> - Summary Report generieren</li>
                    <li><code>test_comparison_report_details</code> - Detailed Comparison Report</li>
                </ul>
            </div>
        </section>

        <section id="running">
            <h2>‚ñ∂Ô∏è Tests ausf√ºhren</h2>

            <h3>Alle Tests</h3>
            <div class="code-block">
                <pre><code class="language-bash"># Alle 46 Tests
pytest tests/core/tradingbot/test_migration_suite.py -v

# Mit Coverage
pytest tests/core/tradingbot/test_migration_suite.py --cov=src.core.tradingbot.migration

# Parallel (schneller)
pytest tests/core/tradingbot/test_migration_suite.py -n auto</code></pre>
            </div>

            <h3>Einzelne Test-Klassen</h3>
            <div class="code-block">
                <pre><code class="language-bash"># Nur Equivalence Tests (9 Tests - die wichtigsten!)
pytest tests/core/tradingbot/test_migration_suite.py::TestIndividualStrategyMigration::test_converted_strategy_is_equivalent -v

# Nur Batch Migration (2 Tests)
pytest tests/core/tradingbot/test_migration_suite.py::TestBatchMigration -v

# Nur Metrics (3 Tests)
pytest tests/core/tradingbot/test_migration_suite.py::TestMigrationMetrics -v</code></pre>
            </div>

            <h3>Einzelne Strategie</h3>
            <div class="code-block">
                <pre><code class="language-bash"># Nur Trend Following Conservative
pytest tests/core/tradingbot/test_migration_suite.py -k "trend_following_conservative" -v

# Alle Trend Strategien
pytest tests/core/tradingbot/test_migration_suite.py -k "trend_following" -v

# Alle Mean Reversion
pytest tests/core/tradingbot/test_migration_suite.py -k "mean_reversion" -v</code></pre>
            </div>

            <h3>Mit Detailed Output</h3>
            <div class="code-block">
                <pre><code class="language-bash"># Sehr verbose (zeigt alle Assertions)
pytest tests/core/tradingbot/test_migration_suite.py -vv

# Mit stdout (print statements)
pytest tests/core/tradingbot/test_migration_suite.py -v -s

# Bei Fehler: full traceback
pytest tests/core/tradingbot/test_migration_suite.py -v --tb=long</code></pre>
            </div>

            <h3>CI/CD Integration</h3>
            <div class="code-block">
                <pre><code class="language-bash"># .github/workflows/migration-tests.yml
name: Migration Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov
      - name: Run migration tests
        run: |
          pytest tests/core/tradingbot/test_migration_suite.py \
            --cov=src.core.tradingbot.migration \
            --cov-report=xml \
            --cov-report=term
      - name: Upload coverage
        uses: codecov/codecov-action@v3</code></pre>
            </div>
        </section>

        <section id="results">
            <h2>üìä Test-Ergebnisse</h2>

            <h3>Aktuelle Ergebnisse (Phase 5.4 Complete)</h3>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">46/46</div>
                    <div class="stat-label">Tests Passing</div>
                    <div class="stat-description">100% Success Rate</div>
                </div>

                <div class="stat-card">
                    <div class="stat-number">9/9</div>
                    <div class="stat-label">Strategies Migrated</div>
                    <div class="stat-description">100% Coverage</div>
                </div>

                <div class="stat-card">
                    <div class="stat-number">9/9</div>
                    <div class="stat-label">Equivalence Checks</div>
                    <div class="stat-description">100% Equivalent</div>
                </div>

                <div class="stat-card">
                    <div class="stat-number">0</div>
                    <div class="stat-label">Failures</div>
                    <div class="stat-description">Production Ready</div>
                </div>
            </div>

            <h3>Migration History</h3>
            <table>
                <thead>
                    <tr>
                        <th>Phase</th>
                        <th>Pass Rate</th>
                        <th>Failures</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Phase 5.3 (Initial)</td>
                        <td>63% (29/46)</td>
                        <td>17</td>
                        <td><span class="status warning">FAILED</span></td>
                    </tr>
                    <tr>
                        <td>Phase 5.4 (Bug Fixes)</td>
                        <td>100% (46/46)</td>
                        <td>0</td>
                        <td><span class="status success">PASSING</span></td>
                    </tr>
                </tbody>
            </table>

            <h3>Fixed Bugs (Phase 5.4)</h3>
            <div class="accordion-header">
                <span><strong>Bug #1: Indicator ID Mismatch (CRITICAL)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Impact:</strong> 9/9 Equivalence Tests FAILED</p>
                <p><strong>Root Cause:</strong> JSON-Generator normalisierte IDs (adx ‚Üí adx14), aber Comparator nicht</p>
                <p><strong>Fix:</strong> 56 ID-Mappings in beiden Modulen</p>
                <p><strong>Result:</strong> ‚úÖ 9/9 Tests PASSING</p>
            </div>

            <div class="accordion-header">
                <span><strong>Bug #2: Unknown Custom Indicators (CRITICAL)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Impact:</strong> 3/9 Validation Tests FAILED</p>
                <p><strong>Root Cause:</strong> Custom Indicators (sma_alignment, macd_hist, etc.) nicht supported</p>
                <p><strong>Fix:</strong> 12 Custom Indicators zu indicator_map hinzugef√ºgt</p>
                <p><strong>Result:</strong> ‚úÖ 9/9 Validation Tests PASSING</p>
            </div>

            <div class="accordion-header">
                <span><strong>Bug #3: Duplicate Indicator IDs</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Impact:</strong> 2/9 Validation Tests FAILED</p>
                <p><strong>Root Cause:</strong> Deduplication nach Name statt ID</p>
                <p><strong>Fix:</strong> Deduplication auf normalized IDs umgestellt</p>
                <p><strong>Result:</strong> ‚úÖ Alle Validation Tests PASSING</p>
            </div>

            <div class="accordion-header">
                <span><strong>Bug #4: Empty Volume Parameters</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Impact:</strong> 1/9 Validation Tests FAILED</p>
                <p><strong>Root Cause:</strong> Volume indicators hatten leere params {}</p>
                <p><strong>Fix:</strong> Minimal params hinzugef√ºgt ({"window": 1})</p>
                <p><strong>Result:</strong> ‚úÖ Validation PASSING</p>
            </div>

            <h3>Test Output Beispiel</h3>
            <div class="code-block">
                <pre><code class="language-bash">$ pytest tests/core/tradingbot/test_migration_suite.py -v

======================== test session starts =========================
platform linux -- Python 3.10.12
collected 46 items

test_migration_suite.py::TestIndividualStrategyMigration::test_analyze_strategy[trend_following_conservative] PASSED [ 2%]
test_migration_suite.py::TestIndividualStrategyMigration::test_analyze_strategy[trend_following_aggressive] PASSED [ 4%]
test_migration_suite.py::TestIndividualStrategyMigration::test_analyze_strategy[mean_reversion_bb] PASSED [ 6%]
...
test_migration_suite.py::TestIndividualStrategyMigration::test_converted_strategy_is_equivalent[trend_following_conservative] PASSED [76%]
test_migration_suite.py::TestIndividualStrategyMigration::test_converted_strategy_is_equivalent[trend_following_aggressive] PASSED [78%]
...
test_migration_suite.py::TestBatchMigration::test_batch_migration_all_strategies PASSED [93%]
test_migration_suite.py::TestBatchMigration::test_combined_json_generation PASSED [95%]
test_migration_suite.py::TestMigrationMetrics::test_migration_success_rate PASSED [97%]
test_migration_suite.py::TestMigrationMetrics::test_indicator_coverage PASSED [98%]
test_migration_suite.py::TestMigrationMetrics::test_equivalence_percentage PASSED [100%]

========================= 46 passed in 2.34s =========================</code></pre>
            </div>
        </section>

        <section id="best-practices">
            <h2>‚úÖ Testing Best Practices</h2>

            <div class="alert success">
                <strong>Regel 1:</strong> Immer ALLE Tests vor einem Commit ausf√ºhren.<br>
                <code>pytest tests/core/tradingbot/test_migration_suite.py</code>
            </div>

            <div class="alert success">
                <strong>Regel 2:</strong> Bei √Ñnderungen am Generator/Comparator: Equivalence Tests zuerst!<br>
                <code>pytest -k "test_converted_strategy_is_equivalent" -v</code>
            </div>

            <div class="alert warning">
                <strong>Regel 3:</strong> Neue Strategien? ‚Üí Neue Tests hinzuf√ºgen!<br>
                Strategie-Name zu <code>ALL_STRATEGIES</code> Liste hinzuf√ºgen ‚Üí 4 Tests automatisch generiert
            </div>

            <div class="alert info">
                <strong>Regel 4:</strong> Vor Production Deployment: Full Suite + Coverage!<br>
                <code>pytest tests/core/tradingbot/ --cov=src.core.tradingbot --cov-report=html</code>
            </div>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Dokumentation</h3>
                <ul>
                    <li><a href="../index.html">Hauptseite</a></li>
                    <li><a href="cli-tools.html">CLI Tools</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 OrderPilot-AI. Migration Framework Documentation.</p>
        </div>
    </footer>

    <script src="../assets/script.js"></script>
</body>
</html>