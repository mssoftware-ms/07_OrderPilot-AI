<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Comparator - OrderPilot-AI Help</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>OrderPilot-AI Help <span class="version-badge">v1.0.0</span></h1>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="../index.html">‚Üê Zur√ºck zur √úbersicht</a></li>
            <li><a href="#overview">√úbersicht</a></li>
            <li><a href="#api">API</a></li>
            <li><a href="#examples">Beispiele</a></li>
            <li><a href="#metrics">Metriken</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="overview">
            <h2>‚öñÔ∏è Strategy Comparator - √úbersicht</h2>

            <div class="alert info">
                <strong>Zweck:</strong> Der StrategyComparator vergleicht JSON-Konfigurationen mit hardkodierten Python-Strategien und stellt Equivalence sicher - die Kernkomponente f√ºr Migrationvalidierung.
            </div>

            <h3>Equivalence-Kriterien</h3>
            <table>
                <thead>
                    <tr>
                        <th>Komponente</th>
                        <th>Gewichtung</th>
                        <th>Threshold</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Entry Conditions</td><td>30%</td><td>95%</td></tr>
                    <tr><td>Exit Conditions</td><td>30%</td><td>95%</td></tr>
                    <tr><td>Risk Parameters</td><td>25%</td><td>95%</td></tr>
                    <tr><td>Indicators</td><td>10%</td><td>100%</td></tr>
                    <tr><td>Regimes</td><td>5%</td><td>80%</td></tr>
                </tbody>
            </table>

            <div class="alert success">
                <strong>Overall Threshold:</strong> 85% Similarity = Equivalent
            </div>

            <h3>Hauptfunktionen</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">‚úì</div>
                    <h3>Equivalence Check</h3>
                    <p>Pr√ºft ob JSON & Hardcoded identisch sind (>85% Similarity).</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Detailed Diffs</h3>
                    <p>Zeigt exakte Unterschiede in Conditions, Parameters, Indicators.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">üîç</div>
                    <h3>ID Normalization</h3>
                    <p>Vergleicht Indikatoren nach normalisierten IDs (56 Mappings).</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Weighted Scoring</h3>
                    <p>Intelligente Gewichtung: Entry/Exit wichtiger als Regimes.</p>
                </div>
            </div>
        </section>

        <section id="api">
            <h2>üîß API Dokumentation</h2>

            <h3>Klasse: <code>StrategyComparator</code></h3>

            <div class="accordion-header">
                <span><strong>__init__(analyzer, catalog)</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_comparator import StrategyComparator

comparator = StrategyComparator(
    analyzer=analyzer,
    catalog=catalog
)</code></pre>
            </div>

            <div class="accordion-header">
                <span><strong>compare_json_to_hardcoded(json_config, strategy_id, hardcoded_strategy_name) ‚Üí ComparisonResult</strong></span>
            </div>
            <div class="accordion-content" style="display: none;">
                <p><strong>Hauptmethode:</strong> Vollst√§ndiger Vergleich mit gewichtetem Scoring.</p>
                <pre><code class="language-python">result = comparator.compare_json_to_hardcoded(
    json_config=loaded_config,
    strategy_id="trend_following_conservative",
    hardcoded_strategy_name="trend_following_conservative"
)

print(f"Equivalent: {result.is_equivalent}")
print(f"Similarity: {result.overall_similarity:.1%}")

if not result.is_equivalent:
    print("Differences:")
    for diff in result.condition_diffs:
        print(f"  - {diff}")
    for warning in result.warnings:
        print(f"  ‚ö† {warning}")</code></pre>
            </div>

            <h3>Klasse: <code>ComparisonResult</code></h3>
            <pre><code class="language-python">@dataclass
class ComparisonResult:
    strategy_name: str
    is_equivalent: bool              # Overall: Similarity >= 85%
    overall_similarity: float        # Weighted score (0.0 - 1.0)

    # Component matches
    entry_conditions_match: bool
    exit_conditions_match: bool
    risk_parameters_match: bool
    indicators_match: bool
    regimes_match: bool

    # Detailed diffs
    condition_diffs: list[ConditionDiff]
    parameter_diffs: list[ParameterDiff]
    missing_indicators: list[str]
    extra_indicators: list[str]
    regime_diffs: list[str]

    warnings: list[str]
    notes: list[str]</code></pre>
        </section>

        <section id="examples">
            <h2>üí° Praktische Beispiele</h2>

            <h3>Beispiel 1: Einzelner Vergleich</h3>
            <div class="code-block">
                <pre><code class="language-python">from src.core.tradingbot.migration.strategy_comparator import StrategyComparator
from src.core.tradingbot.config.config_loader import ConfigLoader

# Setup
comparator = StrategyComparator(analyzer, catalog)
loader = ConfigLoader()

# JSON laden
json_config = loader.load_config("config/trend_following_conservative.json")

# Vergleichen
result = comparator.compare_json_to_hardcoded(
    json_config=json_config,
    strategy_id="trend_following_conservative",
    hardcoded_strategy_name="trend_following_conservative"
)

# Ergebnis
if result.is_equivalent:
    print(f"‚úÖ EQUIVALENT ({result.overall_similarity:.1%} similarity)")
else:
    print(f"‚ùå NOT EQUIVALENT ({result.overall_similarity:.1%})")
    print(f"\nComponent Scores:")
    print(f"  Entry: {'‚úì' if result.entry_conditions_match else '‚úó'}")
    print(f"  Exit: {'‚úì' if result.exit_conditions_match else '‚úó'}")
    print(f"  Risk: {'‚úì' if result.risk_parameters_match else '‚úó'}")
    print(f"  Indicators: {'‚úì' if result.indicators_match else '‚úó'}")
    print(f"  Regimes: {'‚úì' if result.regimes_match else '‚úó'}")</code></pre>
            </div>

            <h3>Beispiel 2: Batch-Vergleich aller Strategien</h3>
            <div class="code-block">
                <pre><code class="language-python">from pathlib import Path

config_dir = Path("config/migrated")
results = {}

for strategy_name in catalog.list_strategies():
    config_path = config_dir / f"{strategy_name}.json"

    if not config_path.exists():
        print(f"‚ö† Config not found: {strategy_name}")
        continue

    # JSON laden
    json_config = loader.load_config(config_path)

    # Vergleichen
    result = comparator.compare_json_to_hardcoded(
        json_config=json_config,
        strategy_id=strategy_name,
        hardcoded_strategy_name=strategy_name
    )

    results[strategy_name] = result

    status = "‚úÖ" if result.is_equivalent else "‚ùå"
    print(f"{status} {strategy_name}: {result.overall_similarity:.1%}")

# Summary
total = len(results)
equivalent = sum(1 for r in results.values() if r.is_equivalent)
print(f"\n{'='*50}")
print(f"Equivalent: {equivalent}/{total} ({equivalent/total*100:.1f}%)")</code></pre>
            </div>

            <h3>Beispiel 3: Detaillierte Diff-Analyse</h3>
            <div class="code-block">
                <pre><code class="language-python">result = comparator.compare_json_to_hardcoded(...)

if not result.is_equivalent:
    print("=== DETAILED ANALYSIS ===\n")

    # Condition Diffs
    if result.condition_diffs:
        print("Condition Differences:")
        for diff in result.condition_diffs:
            print(f"  {diff.difference_type}:")
            print(f"    JSON: {diff.json_condition}")
            print(f"    Hardcoded: {diff.hardcoded_condition}\n")

    # Parameter Diffs
    if result.parameter_diffs:
        print("Parameter Differences:")
        for diff in result.parameter_diffs:
            print(f"  {diff.parameter}:")
            print(f"    JSON: {diff.json_value}")
            print(f"    Hardcoded: {diff.hardcoded_value}\n")

    # Indicator Diffs
    if result.missing_indicators:
        print(f"Missing Indicators: {result.missing_indicators}")
    if result.extra_indicators:
        print(f"Extra Indicators: {result.extra_indicators}")

    # Warnings
    if result.warnings:
        print("\nWarnings:")
        for warning in result.warnings:
            print(f"  ‚ö† {warning}")</code></pre>
            </div>
        </section>

        <section id="metrics">
            <h2>üìä Similarity Metriken</h2>

            <h3>Gewichtetes Scoring</h3>
            <pre><code class="language-python">overall_similarity = (
    entry_similarity * 0.30 +
    exit_similarity * 0.30 +
    risk_similarity * 0.25 +
    indicator_similarity * 0.10 +
    regime_similarity * 0.05
)</code></pre>

            <h3>Component Thresholds</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Match Criterion</th>
                        <th>Beispiel</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Entry Conditions</td>
                        <td>95% Similarity</td>
                        <td>4/5 Conditions match = 80% ‚Üí FAIL</td>
                    </tr>
                    <tr>
                        <td>Exit Conditions</td>
                        <td>95% Similarity</td>
                        <td>3/3 Conditions match = 100% ‚Üí PASS</td>
                    </tr>
                    <tr>
                        <td>Risk Parameters</td>
                        <td>95% Similarity</td>
                        <td>All 3 params exact = 100% ‚Üí PASS</td>
                    </tr>
                    <tr>
                        <td>Indicators</td>
                        <td>100% Match</td>
                        <td>7/8 indicators = 87.5% ‚Üí FAIL</td>
                    </tr>
                    <tr>
                        <td>Regimes</td>
                        <td>80% Similarity</td>
                        <td>2/3 conditions match = 67% ‚Üí FAIL</td>
                    </tr>
                </tbody>
            </table>

            <h3>Beispiel-Berechnung</h3>
            <div class="code-block">
                <pre><code class="language-python"># Angenommene Component Scores:
entry_sim = 1.00    # 100% - alle Conditions match
exit_sim = 1.00     # 100% - alle Conditions match
risk_sim = 1.00     # 100% - alle Parameters exact
indicator_sim = 1.00  # 100% - alle Indicators present
regime_sim = 0.67   # 67% - 2/3 Conditions match

# Overall Similarity
overall = (
    1.00 * 0.30 +  # Entry: 0.30
    1.00 * 0.30 +  # Exit: 0.30
    1.00 * 0.25 +  # Risk: 0.25
    1.00 * 0.10 +  # Indicators: 0.10
    0.67 * 0.05    # Regimes: 0.0335
) = 0.9835 = 98.35%

# Is Equivalent?
98.35% >= 85% ‚Üí TRUE ‚úÖ</code></pre>
            </div>
        </section>

        <section id="normalization">
            <h2>üîÑ ID Normalization</h2>

            <p>Der Comparator normalisiert BEIDE Seiten vor dem Vergleich:</p>

            <div class="alert info">
                <strong>Warum Normalisierung?</strong><br>
                Hardcoded Code nutzt Namen wie <code>rsi</code>, <code>adx</code>, <code>sma_fast</code>.<br>
                JSON nutzt standardisierte IDs wie <code>rsi14</code>, <code>adx14</code>, <code>sma20</code>.
            </div>

            <h3>Normalisierungs-Beispiele</h3>
            <table>
                <thead>
                    <tr>
                        <th>Hardcoded</th>
                        <th>‚Üí</th>
                        <th>Normalized</th>
                        <th>JSON</th>
                        <th>Match</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><code>rsi</code></td><td>‚Üí</td><td><code>rsi14</code></td><td><code>rsi14</code></td><td>‚úÖ</td></tr>
                    <tr><td><code>adx_14</code></td><td>‚Üí</td><td><code>adx14</code></td><td><code>adx14</code></td><td>‚úÖ</td></tr>
                    <tr><td><code>sma_fast</code></td><td>‚Üí</td><td><code>sma20</code></td><td><code>sma20</code></td><td>‚úÖ</td></tr>
                    <tr><td><code>bb_upper</code></td><td>‚Üí</td><td><code>bbands20_upper</code></td><td><code>bbands20_upper</code></td><td>‚úÖ</td></tr>
                    <tr><td><code>macd_hist</code></td><td>‚Üí</td><td><code>macd12_26_9</code></td><td><code>macd12_26_9</code></td><td>‚úÖ</td></tr>
                </tbody>
            </table>

            <p class="mt-lg">Ohne Normalisierung w√ºrden alle Vergleiche fehlschlagen!</p>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Dokumentation</h3>
                <ul>
                    <li><a href="../index.html">Hauptseite</a></li>
                    <li><a href="strategy-analyzer.html">Strategy Analyzer</a></li>
                    <li><a href="json-generator.html">JSON Generator</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 OrderPilot-AI. Migration Framework Documentation.</p>
        </div>
    </footer>

    <script src="../assets/script.js"></script>
</body>
</html>