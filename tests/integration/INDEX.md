# E2E Integration Test Suite - Documentation Index

## ðŸš€ Start Here

**New to this test suite?** Start with one of these:

1. **[QUICK_START.md](QUICK_START.md)** - Get tests running in 2 minutes
2. **[README_E2E_TESTS.md](README_E2E_TESTS.md)** - Complete user guide
3. **[TEST_SUITE_SUMMARY.md](TEST_SUITE_SUMMARY.md)** - Project summary

## ðŸ“‹ Main Files

### Test Implementation
- **[test_regime_optimization_e2e.py](test_regime_optimization_e2e.py)** (1,100+ lines)
  - Main test file with 9 test classes
  - 15 test methods covering all workflow stages
  - Fully documented with docstrings

### Configuration
- **[conftest.py](conftest.py)** - Pytest fixtures and markers
- **[pytest.ini](pytest.ini)** - Pytest settings and coverage config

### Test Runners
- **[run_e2e_tests.sh](run_e2e_tests.sh)** - Bash script (Linux/macOS)
- **[run_e2e_tests.ps1](run_e2e_tests.ps1)** - PowerShell script (Windows)

### Documentation
- **[README_E2E_TESTS.md](README_E2E_TESTS.md)** - Complete documentation
- **[TEST_ARCHITECTURE.md](TEST_ARCHITECTURE.md)** - Technical architecture
- **[QUICK_START.md](QUICK_START.md)** - Quick setup guide
- **[TEST_SUITE_SUMMARY.md](TEST_SUITE_SUMMARY.md)** - Project summary
- **[INDEX.md](INDEX.md)** - This file

## ðŸ§ª Test Overview

### Test 1: Stage 1 Regime Optimization
**File:** test_regime_optimization_e2e.py::TestStage1RegimeOptimization

Complete workflow test covering:
- Data loading (1000 bars BTCUSDT 5m)
- Optuna TPE optimization (50 trials)
- Indicator calculation & regime classification
- JSON export with bar_indices
- Performance: ~3 minutes

**Key Assertion:** bar_indices present and correct

### Test 2: Stage 2 Indicator Optimization
**File:** test_regime_optimization_e2e.py::TestStage2IndicatorOptimization

Complete workflow test covering:
- Stage 1 output loading
- Regime-specific data filtering (using bar_indices)
- Signal optimization (40 trials per indicator)
- Signal backtest with metrics
- JSON export

**Key Assertion:** Indicators optimize on correct regime bars

### Test 3: Stage 1â†’2 Handoff
**File:** test_regime_optimization_e2e.py::TestStage1ToStage2Handoff

Validation of data flow between stages:
- bar_indices extraction & usage
- Data filtering correctness
- Minimum data requirements

**Key Assertion:** Stage 1 output is valid Stage 2 input

### Test 4: JSON Schema Validation
**File:** test_regime_optimization_e2e.py::TestJSONSchemaCompliance

4 sub-tests validating JSON formats:
- regime_optimization_results.json
- optimized_regime.json
- indicator_optimization_results.json
- indicator_sets.json

### Test 5: Performance Benchmark
**File:** test_regime_optimization_e2e.py::TestPerformanceBenchmark

Verifies TPE speedup:
- Grid Search combinations: 303,750
- TPE trials: 50
- Expected: <180s, >100x speedup

### Test 6: UI Integration
**File:** test_regime_optimization_e2e.py::TestEntryAnalyzerUIIntegration

3 sub-tests (optional, skip if PyQt6 not available):
- 6 Entry Analyzer tabs verification
- RegimeOptimizationThread initialization
- IndicatorOptimizationThread initialization

## ðŸ“Š Test Fixtures

### Auto-Generated
Located in `tests/fixtures/` and regenerated by:
```bash
python tests/fixtures/generate_test_data.py
```

**Fixture Files:**
- `regime_optimization_results_BTCUSDT_5m.json` - 50 trials
- `optimized_regime_BTCUSDT_5m.json` - Best result with bar_indices
- `indicator_optimization_results_{REGIME}_BTCUSDT_5m.json` - 3 files (per regime)
- `indicator_sets_{REGIME}_BTCUSDT_5m.json` - 3 files (per regime)

## ðŸŽ¯ Quick Commands

### Run All Tests
```bash
pytest tests/integration/test_regime_optimization_e2e.py -v
```

### Run Specific Test Class
```bash
pytest tests/integration/test_regime_optimization_e2e.py::TestStage1RegimeOptimization -v
```

### Run with Coverage
```bash
pytest tests/integration/test_regime_optimization_e2e.py -v --cov=src --cov-report=html
```

### Run with Test Runner Script
```bash
# Linux/macOS
./tests/integration/run_e2e_tests.sh all

# Windows
.\tests\integration\run_e2e_tests.ps1 -Mode all
```

### Quick Tests (2 minutes)
```bash
pytest tests/integration/test_regime_optimization_e2e.py -v -m "not slow and not ui"
```

## ðŸ“– Documentation Map

```
ðŸ“ tests/integration/
â”œâ”€â”€ ðŸ“„ INDEX.md â† You are here
â”‚
â”œâ”€â”€ ðŸš€ QUICK_START.md
â”‚   â””â”€â”€ Get running in 2 minutes
â”‚
â”œâ”€â”€ ðŸ“˜ README_E2E_TESTS.md
â”‚   â”œâ”€â”€ Complete test guide
â”‚   â”œâ”€â”€ Running tests
â”‚   â”œâ”€â”€ Test descriptions
â”‚   â”œâ”€â”€ JSON formats
â”‚   â””â”€â”€ Troubleshooting
â”‚
â”œâ”€â”€ ðŸ—ï¸ TEST_ARCHITECTURE.md
â”‚   â”œâ”€â”€ Test structure
â”‚   â”œâ”€â”€ Data flow diagrams
â”‚   â”œâ”€â”€ Fixture architecture
â”‚   â”œâ”€â”€ Execution modes
â”‚   â””â”€â”€ Test patterns
â”‚
â””â”€â”€ ðŸ“Š TEST_SUITE_SUMMARY.md
    â”œâ”€â”€ Deliverables
    â”œâ”€â”€ Coverage details
    â”œâ”€â”€ Fixture structure
    â”œâ”€â”€ Running tests
    â””â”€â”€ Success criteria
```

## ðŸ” Key Concepts

### bar_indices
**Critical field** in optimized_regime.json:
- Array of integers from start_idx to end_idx
- Used by Stage 2 to filter data to regime-specific bars
- Must be present for Stage 1â†’2 handoff to work
- Validated by TestStage1ToStage2Handoff

### Composite Score
Stage 1 optimization metric:
- F1-Bull: 25%
- F1-Bear: 30%
- F1-Sideways: 20%
- Stability: 25%
- **Range:** 0-100

### Signal Metrics
Stage 2 backtest metrics:
- Win Rate: [0, 1]
- Profit Factor: â‰¥0
- Sharpe Ratio: Risk-adjusted returns
- Expectancy: Average return per trade
- Drawdown: Maximum loss

## âœ¨ Features

âœ… **Complete Coverage**
- All workflow stages tested
- 9 test classes, 15 test methods
- 95%+ code coverage target

âœ… **Realistic Data**
- 1000 bars sample BTCUSDT 5m
- Proper OHLCV relationships
- DatetimeIndex

âœ… **Auto-Generated Fixtures**
- All JSON fixtures auto-generated
- Easy to regenerate
- Safe to delete/recreate

âœ… **Multiple Running Options**
- Direct pytest
- Bash script (with 8 modes)
- PowerShell script
- CI/CD ready

âœ… **Comprehensive Documentation**
- 4 documentation files (2,700+ lines)
- Architecture guides
- Quick start guide
- This index

âœ… **Performance Testing**
- TPE vs Grid Search benchmark
- >100x speedup verification
- <180s execution target

## ðŸ› Troubleshooting

| Issue | Solution |
|-------|----------|
| No fixtures found | Run `python tests/fixtures/generate_test_data.py` |
| Import errors | Set `export PYTHONPATH="${PYTHONPATH}:$(pwd)"` |
| Timeout | Increase with `--timeout=600` |
| PyQt6 tests skip | Install with `pip install PyQt6` |
| Coverage not shown | Use `--cov=src --cov-report=html` |

## ðŸ“ž Support

For detailed information on any topic:
1. Check [README_E2E_TESTS.md](README_E2E_TESTS.md) for feature descriptions
2. Review [TEST_ARCHITECTURE.md](TEST_ARCHITECTURE.md) for technical details
3. See [QUICK_START.md](QUICK_START.md) for running tests
4. Check [test_regime_optimization_e2e.py](test_regime_optimization_e2e.py) docstrings

## ðŸ“ˆ Metrics

- **Total Tests:** 9 classes, 15 methods
- **Lines of Code:** 1,100+ (main test file)
- **Documentation:** 2,700+ lines
- **Test Fixtures:** 10 JSON files
- **Estimated Runtime:** 5-10 minutes
- **Coverage Target:** 95%+

## âœ… Status

- âœ“ All test files created and documented
- âœ“ Fixtures auto-generated
- âœ“ Test runners for Linux/macOS/Windows
- âœ“ Complete documentation
- âœ“ Ready for production use

---

**Last Updated:** 2026-01-24
**Framework:** pytest 7.x+ | Python 3.10+
**Status:** Complete & Ready
